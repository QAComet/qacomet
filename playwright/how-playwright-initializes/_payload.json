[{"data":1,"prerenderedAt":4050},["Reactive",2],{"blog-post-playwright/how-playwright-initializes":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"breadcrumbs":10,"image":16,"shortDescription":17,"created":18,"link":4,"body":24,"_type":4045,"_id":4046,"_source":4047,"_file":4048,"_extension":4049},"/playwright/how-playwright-initializes","playwright",false,"","How importing from Playwright works","In this post we dive into how Playwright initializes itself when you import anything from the library. If you look under the hood there is some complex machinery generating the API making it difficult for someone unfamiliar to get started with Playwright's internals.",[11,14],{"name":12,"path":13},"Playwright","/playwright",{"name":15,"path":4},"How Playwright Initializes","img","Importing from playwright is a complex process with many interacting components. Let's look under the hood to discover how playwright-core is structured.",{"string":19,"number":20,"month":21,"day":22,"year":23},"March 13, 2024",1710309600000,"Mar",13,2024,{"type":25,"children":26,"toc":4039},"root",[27,37,97,118,179,247,284,290,302,1205,1212,1269,1348,1367,1422,1427,1457,1484,1549,1586,1790,1856,1979,2020,2230,2278,2320,2339,2629,2680,2865,2885,3331,3417,3496,3574,3639,3645,3658,3761,3796,3820,3833,4021,4033],{"type":28,"tag":29,"props":30,"children":31},"element","p",{},[32],{"type":28,"tag":16,"props":33,"children":36},{"alt":34,"src":35},"Diagram of playwright-core initialization process","/img/playwright/playwright-core_initialization_diagram.jpg",[],{"type":28,"tag":29,"props":38,"children":39},{},[40,43,50,52,58,60,66,68,73,75,81,83,88,90,95],{"type":41,"value":42},"text","Whenever you import playwright, there's a lot happening under the hood because of how the project is structured. When you import from ",{"type":28,"tag":44,"props":45,"children":47},"code",{"className":46},[],[48],{"type":41,"value":49},"@playwright/test",{"type":41,"value":51}," this actually merges two separate packages in the playwright project. They are ",{"type":28,"tag":44,"props":53,"children":55},{"className":54},[],[56],{"type":41,"value":57},"packages/playwright-core",{"type":41,"value":59}," and ",{"type":28,"tag":44,"props":61,"children":63},{"className":62},[],[64],{"type":41,"value":65},"packages/playwright",{"type":41,"value":67},". When you import ",{"type":28,"tag":44,"props":69,"children":71},{"className":70},[],[72],{"type":41,"value":49},{"type":41,"value":74}," you are importing the export ",{"type":28,"tag":44,"props":76,"children":78},{"className":77},[],[79],{"type":41,"value":80},"require('playwright/test')",{"type":41,"value":82},", which contains the merging code. Here is where the wrapper code in ",{"type":28,"tag":44,"props":84,"children":86},{"className":85},[],[87],{"type":41,"value":65},{"type":41,"value":89}," is combined with the browser automation code in ",{"type":28,"tag":44,"props":91,"children":93},{"className":92},[],[94],{"type":41,"value":57},{"type":41,"value":96},".",{"type":28,"tag":29,"props":98,"children":99},{},[100,102,108,110,116],{"type":41,"value":101},"The import from ",{"type":28,"tag":44,"props":103,"children":105},{"className":104},[],[106],{"type":41,"value":107},"playwright-core",{"type":41,"value":109}," is much more complex because the export is dynamically generated from a function. Looking at the ",{"type":28,"tag":44,"props":111,"children":113},{"className":112},[],[114],{"type":41,"value":115},"index.js",{"type":41,"value":117}," file gives an export",{"type":28,"tag":119,"props":120,"children":125},"pre",{"className":121,"code":122,"filename":123,"language":124,"meta":7,"style":7},"language-js shiki shiki-themes github-dark","module.exports = require('./lib/inprocess');\n","packages/playwright-core/index.js","js",[126],{"type":28,"tag":44,"props":127,"children":128},{"__ignoreMap":7},[129],{"type":28,"tag":130,"props":131,"children":134},"span",{"class":132,"line":133},"line",1,[135,141,146,151,157,163,168,174],{"type":28,"tag":130,"props":136,"children":138},{"style":137},"--shiki-default:#79B8FF",[139],{"type":41,"value":140},"module",{"type":28,"tag":130,"props":142,"children":144},{"style":143},"--shiki-default:#E1E4E8",[145],{"type":41,"value":96},{"type":28,"tag":130,"props":147,"children":148},{"style":137},[149],{"type":41,"value":150},"exports",{"type":28,"tag":130,"props":152,"children":154},{"style":153},"--shiki-default:#F97583",[155],{"type":41,"value":156}," =",{"type":28,"tag":130,"props":158,"children":160},{"style":159},"--shiki-default:#B392F0",[161],{"type":41,"value":162}," require",{"type":28,"tag":130,"props":164,"children":165},{"style":143},[166],{"type":41,"value":167},"(",{"type":28,"tag":130,"props":169,"children":171},{"style":170},"--shiki-default:#9ECBFF",[172],{"type":41,"value":173},"'./lib/inprocess'",{"type":28,"tag":130,"props":175,"children":176},{"style":143},[177],{"type":41,"value":178},");\n",{"type":28,"tag":29,"props":180,"children":181},{},[182,184,190,192,198,200,206,208,214,216,222,224,229,231,237,239,245],{"type":41,"value":183},"Note the ",{"type":28,"tag":44,"props":185,"children":187},{"className":186},[],[188],{"type":41,"value":189},"lib",{"type":41,"value":191}," directory is just the ",{"type":28,"tag":44,"props":193,"children":195},{"className":194},[],[196],{"type":41,"value":197},"src",{"type":41,"value":199}," directory after playwright runs its build script, and is what's found in the npm package. The ",{"type":28,"tag":44,"props":201,"children":203},{"className":202},[],[204],{"type":41,"value":205},"inprocess.ts",{"type":41,"value":207}," file just imports from the adjacent ",{"type":28,"tag":44,"props":209,"children":211},{"className":210},[],[212],{"type":41,"value":213},"inProcessFactory.ts",{"type":41,"value":215}," and executes the function from there, called ",{"type":28,"tag":44,"props":217,"children":219},{"className":218},[],[220],{"type":41,"value":221},"createInProcessPlaywright",{"type":41,"value":223},". We include the source below in its own section, but note ",{"type":28,"tag":44,"props":225,"children":227},{"className":226},[],[228],{"type":41,"value":221},{"type":41,"value":230}," is required to be called because it dynamically intiailizes the interface between the client library, defined in ",{"type":28,"tag":44,"props":232,"children":234},{"className":233},[],[235],{"type":41,"value":236},"src/client",{"type":41,"value":238},", and the server library, defined in ",{"type":28,"tag":44,"props":240,"children":242},{"className":241},[],[243],{"type":41,"value":244},"src/server",{"type":41,"value":246},". The server library is responsible for dispatching browser automation actions over a browser automation protocol, such as the Chrome Devtools Protocol, abbreviated as CDP, while the client library gives a public API for playwright users to interact with the server library.",{"type":28,"tag":29,"props":248,"children":249},{},[250,252,261,263,268,270,275,277,282],{"type":41,"value":251},"There is the separation of logic here, between client and server, because it allows for implementations of the client library in multiple languages. For example, if you look in the ",{"type":28,"tag":253,"props":254,"children":258},"a",{"href":255,"rel":256},"https://github.com/microsoft/playwright-python",[257],"nofollow",[259],{"type":41,"value":260},"playwright-python",{"type":41,"value":262}," source code, you will find a very similar library to the ",{"type":28,"tag":44,"props":264,"children":266},{"className":265},[],[267],{"type":41,"value":236},{"type":41,"value":269}," library found in the ",{"type":28,"tag":44,"props":271,"children":273},{"className":272},[],[274],{"type":41,"value":107},{"type":41,"value":276}," package. We will mention some of the common design patterns used in the playwright client libraries which are also used in the ",{"type":28,"tag":44,"props":278,"children":280},{"className":279},[],[281],{"type":41,"value":107},{"type":41,"value":283}," client library below.",{"type":28,"tag":285,"props":286,"children":288},"h2",{"id":287},"inprocessfactoryts",[289],{"type":41,"value":213},{"type":28,"tag":29,"props":291,"children":292},{},[293,295,300],{"type":41,"value":294},"This file contains only one function, the ",{"type":28,"tag":44,"props":296,"children":298},{"className":297},[],[299],{"type":41,"value":221},{"type":41,"value":301}," function, which we include here:",{"type":28,"tag":119,"props":303,"children":307},{"className":304,"code":305,"language":306,"meta":7,"style":7},"language-ts shiki shiki-themes github-dark","export function createInProcessPlaywright(): PlaywrightAPI {\n  const playwright = createPlaywright({\n    sdkLanguage: (process.env.PW_LANG_NAME as Language | undefined) || 'javascript'\n  });\n\n  const clientConnection = new Connection(undefined, undefined);\n  clientConnection.useRawBuffers();\n  const dispatcherConnection = new DispatcherConnection(true /* local */);\n\n  // Dispatch synchronously at first.\n  dispatcherConnection.onmessage = message => clientConnection.dispatch(message);\n  clientConnection.onmessage = message => dispatcherConnection.dispatch(message);\n\n  const rootScope = new RootDispatcher(dispatcherConnection);\n\n  // Initialize Playwright channel.\n  new PlaywrightDispatcher(rootScope, playwright);\n  const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright') as PlaywrightAPI;\n  playwrightAPI.chromium._serverLauncher = new BrowserServerLauncherImpl('chromium');\n  playwrightAPI.firefox._serverLauncher = new BrowserServerLauncherImpl('firefox');\n  playwrightAPI.webkit._serverLauncher = new BrowserServerLauncherImpl('webkit');\n  playwrightAPI._android._serverLauncher = new AndroidServerLauncherImpl();\n\n  // Switch to async dispatch after we got Playwright object.\n  dispatcherConnection.onmessage = message => setImmediate(() => clientConnection.dispatch(message));\n  clientConnection.onmessage = message => setImmediate(() => dispatcherConnection.dispatch(message));\n\n  clientConnection.toImpl = (x: any) => x\n    ? dispatcherConnection._dispatchers.get(x._guid)!._object\n    : dispatcherConnection._dispatchers.get('');\n  (playwrightAPI as any)._toImpl = clientConnection.toImpl;\n  return playwrightAPI;\n}\n","ts",[308],{"type":28,"tag":44,"props":309,"children":310},{"__ignoreMap":7},[311,349,377,426,435,445,494,513,558,566,575,619,656,663,694,702,711,730,783,819,853,887,913,921,930,982,1030,1038,1087,1121,1151,1182,1196],{"type":28,"tag":130,"props":312,"children":313},{"class":132,"line":133},[314,319,324,329,334,339,344],{"type":28,"tag":130,"props":315,"children":316},{"style":153},[317],{"type":41,"value":318},"export",{"type":28,"tag":130,"props":320,"children":321},{"style":153},[322],{"type":41,"value":323}," function",{"type":28,"tag":130,"props":325,"children":326},{"style":159},[327],{"type":41,"value":328}," createInProcessPlaywright",{"type":28,"tag":130,"props":330,"children":331},{"style":143},[332],{"type":41,"value":333},"()",{"type":28,"tag":130,"props":335,"children":336},{"style":153},[337],{"type":41,"value":338},":",{"type":28,"tag":130,"props":340,"children":341},{"style":159},[342],{"type":41,"value":343}," PlaywrightAPI",{"type":28,"tag":130,"props":345,"children":346},{"style":143},[347],{"type":41,"value":348}," {\n",{"type":28,"tag":130,"props":350,"children":352},{"class":132,"line":351},2,[353,358,363,367,372],{"type":28,"tag":130,"props":354,"children":355},{"style":153},[356],{"type":41,"value":357},"  const",{"type":28,"tag":130,"props":359,"children":360},{"style":137},[361],{"type":41,"value":362}," playwright",{"type":28,"tag":130,"props":364,"children":365},{"style":153},[366],{"type":41,"value":156},{"type":28,"tag":130,"props":368,"children":369},{"style":159},[370],{"type":41,"value":371}," createPlaywright",{"type":28,"tag":130,"props":373,"children":374},{"style":143},[375],{"type":41,"value":376},"({\n",{"type":28,"tag":130,"props":378,"children":380},{"class":132,"line":379},3,[381,386,391,396,401,406,411,416,421],{"type":28,"tag":130,"props":382,"children":383},{"style":143},[384],{"type":41,"value":385},"    sdkLanguage: (process.env.",{"type":28,"tag":130,"props":387,"children":388},{"style":137},[389],{"type":41,"value":390},"PW_LANG_NAME",{"type":28,"tag":130,"props":392,"children":393},{"style":153},[394],{"type":41,"value":395}," as",{"type":28,"tag":130,"props":397,"children":398},{"style":159},[399],{"type":41,"value":400}," Language",{"type":28,"tag":130,"props":402,"children":403},{"style":153},[404],{"type":41,"value":405}," |",{"type":28,"tag":130,"props":407,"children":408},{"style":137},[409],{"type":41,"value":410}," undefined",{"type":28,"tag":130,"props":412,"children":413},{"style":143},[414],{"type":41,"value":415},") ",{"type":28,"tag":130,"props":417,"children":418},{"style":153},[419],{"type":41,"value":420},"||",{"type":28,"tag":130,"props":422,"children":423},{"style":170},[424],{"type":41,"value":425}," 'javascript'\n",{"type":28,"tag":130,"props":427,"children":429},{"class":132,"line":428},4,[430],{"type":28,"tag":130,"props":431,"children":432},{"style":143},[433],{"type":41,"value":434},"  });\n",{"type":28,"tag":130,"props":436,"children":438},{"class":132,"line":437},5,[439],{"type":28,"tag":130,"props":440,"children":442},{"emptyLinePlaceholder":441},true,[443],{"type":41,"value":444},"\n",{"type":28,"tag":130,"props":446,"children":448},{"class":132,"line":447},6,[449,453,458,462,467,472,476,481,486,490],{"type":28,"tag":130,"props":450,"children":451},{"style":153},[452],{"type":41,"value":357},{"type":28,"tag":130,"props":454,"children":455},{"style":137},[456],{"type":41,"value":457}," clientConnection",{"type":28,"tag":130,"props":459,"children":460},{"style":153},[461],{"type":41,"value":156},{"type":28,"tag":130,"props":463,"children":464},{"style":153},[465],{"type":41,"value":466}," new",{"type":28,"tag":130,"props":468,"children":469},{"style":159},[470],{"type":41,"value":471}," Connection",{"type":28,"tag":130,"props":473,"children":474},{"style":143},[475],{"type":41,"value":167},{"type":28,"tag":130,"props":477,"children":478},{"style":137},[479],{"type":41,"value":480},"undefined",{"type":28,"tag":130,"props":482,"children":483},{"style":143},[484],{"type":41,"value":485},", ",{"type":28,"tag":130,"props":487,"children":488},{"style":137},[489],{"type":41,"value":480},{"type":28,"tag":130,"props":491,"children":492},{"style":143},[493],{"type":41,"value":178},{"type":28,"tag":130,"props":495,"children":497},{"class":132,"line":496},7,[498,503,508],{"type":28,"tag":130,"props":499,"children":500},{"style":143},[501],{"type":41,"value":502},"  clientConnection.",{"type":28,"tag":130,"props":504,"children":505},{"style":159},[506],{"type":41,"value":507},"useRawBuffers",{"type":28,"tag":130,"props":509,"children":510},{"style":143},[511],{"type":41,"value":512},"();\n",{"type":28,"tag":130,"props":514,"children":516},{"class":132,"line":515},8,[517,521,526,530,534,539,543,548,554],{"type":28,"tag":130,"props":518,"children":519},{"style":153},[520],{"type":41,"value":357},{"type":28,"tag":130,"props":522,"children":523},{"style":137},[524],{"type":41,"value":525}," dispatcherConnection",{"type":28,"tag":130,"props":527,"children":528},{"style":153},[529],{"type":41,"value":156},{"type":28,"tag":130,"props":531,"children":532},{"style":153},[533],{"type":41,"value":466},{"type":28,"tag":130,"props":535,"children":536},{"style":159},[537],{"type":41,"value":538}," DispatcherConnection",{"type":28,"tag":130,"props":540,"children":541},{"style":143},[542],{"type":41,"value":167},{"type":28,"tag":130,"props":544,"children":545},{"style":137},[546],{"type":41,"value":547},"true",{"type":28,"tag":130,"props":549,"children":551},{"style":550},"--shiki-default:#6A737D",[552],{"type":41,"value":553}," /* local */",{"type":28,"tag":130,"props":555,"children":556},{"style":143},[557],{"type":41,"value":178},{"type":28,"tag":130,"props":559,"children":561},{"class":132,"line":560},9,[562],{"type":28,"tag":130,"props":563,"children":564},{"emptyLinePlaceholder":441},[565],{"type":41,"value":444},{"type":28,"tag":130,"props":567,"children":569},{"class":132,"line":568},10,[570],{"type":28,"tag":130,"props":571,"children":572},{"style":550},[573],{"type":41,"value":574},"  // Dispatch synchronously at first.\n",{"type":28,"tag":130,"props":576,"children":578},{"class":132,"line":577},11,[579,584,589,593,599,604,609,614],{"type":28,"tag":130,"props":580,"children":581},{"style":143},[582],{"type":41,"value":583},"  dispatcherConnection.",{"type":28,"tag":130,"props":585,"children":586},{"style":159},[587],{"type":41,"value":588},"onmessage",{"type":28,"tag":130,"props":590,"children":591},{"style":153},[592],{"type":41,"value":156},{"type":28,"tag":130,"props":594,"children":596},{"style":595},"--shiki-default:#FFAB70",[597],{"type":41,"value":598}," message",{"type":28,"tag":130,"props":600,"children":601},{"style":153},[602],{"type":41,"value":603}," =>",{"type":28,"tag":130,"props":605,"children":606},{"style":143},[607],{"type":41,"value":608}," clientConnection.",{"type":28,"tag":130,"props":610,"children":611},{"style":159},[612],{"type":41,"value":613},"dispatch",{"type":28,"tag":130,"props":615,"children":616},{"style":143},[617],{"type":41,"value":618},"(message);\n",{"type":28,"tag":130,"props":620,"children":622},{"class":132,"line":621},12,[623,627,631,635,639,643,648,652],{"type":28,"tag":130,"props":624,"children":625},{"style":143},[626],{"type":41,"value":502},{"type":28,"tag":130,"props":628,"children":629},{"style":159},[630],{"type":41,"value":588},{"type":28,"tag":130,"props":632,"children":633},{"style":153},[634],{"type":41,"value":156},{"type":28,"tag":130,"props":636,"children":637},{"style":595},[638],{"type":41,"value":598},{"type":28,"tag":130,"props":640,"children":641},{"style":153},[642],{"type":41,"value":603},{"type":28,"tag":130,"props":644,"children":645},{"style":143},[646],{"type":41,"value":647}," dispatcherConnection.",{"type":28,"tag":130,"props":649,"children":650},{"style":159},[651],{"type":41,"value":613},{"type":28,"tag":130,"props":653,"children":654},{"style":143},[655],{"type":41,"value":618},{"type":28,"tag":130,"props":657,"children":658},{"class":132,"line":22},[659],{"type":28,"tag":130,"props":660,"children":661},{"emptyLinePlaceholder":441},[662],{"type":41,"value":444},{"type":28,"tag":130,"props":664,"children":666},{"class":132,"line":665},14,[667,671,676,680,684,689],{"type":28,"tag":130,"props":668,"children":669},{"style":153},[670],{"type":41,"value":357},{"type":28,"tag":130,"props":672,"children":673},{"style":137},[674],{"type":41,"value":675}," rootScope",{"type":28,"tag":130,"props":677,"children":678},{"style":153},[679],{"type":41,"value":156},{"type":28,"tag":130,"props":681,"children":682},{"style":153},[683],{"type":41,"value":466},{"type":28,"tag":130,"props":685,"children":686},{"style":159},[687],{"type":41,"value":688}," RootDispatcher",{"type":28,"tag":130,"props":690,"children":691},{"style":143},[692],{"type":41,"value":693},"(dispatcherConnection);\n",{"type":28,"tag":130,"props":695,"children":697},{"class":132,"line":696},15,[698],{"type":28,"tag":130,"props":699,"children":700},{"emptyLinePlaceholder":441},[701],{"type":41,"value":444},{"type":28,"tag":130,"props":703,"children":705},{"class":132,"line":704},16,[706],{"type":28,"tag":130,"props":707,"children":708},{"style":550},[709],{"type":41,"value":710},"  // Initialize Playwright channel.\n",{"type":28,"tag":130,"props":712,"children":714},{"class":132,"line":713},17,[715,720,725],{"type":28,"tag":130,"props":716,"children":717},{"style":153},[718],{"type":41,"value":719},"  new",{"type":28,"tag":130,"props":721,"children":722},{"style":159},[723],{"type":41,"value":724}," PlaywrightDispatcher",{"type":28,"tag":130,"props":726,"children":727},{"style":143},[728],{"type":41,"value":729},"(rootScope, playwright);\n",{"type":28,"tag":130,"props":731,"children":733},{"class":132,"line":732},18,[734,738,743,747,751,756,760,765,769,774,778],{"type":28,"tag":130,"props":735,"children":736},{"style":153},[737],{"type":41,"value":357},{"type":28,"tag":130,"props":739,"children":740},{"style":137},[741],{"type":41,"value":742}," playwrightAPI",{"type":28,"tag":130,"props":744,"children":745},{"style":153},[746],{"type":41,"value":156},{"type":28,"tag":130,"props":748,"children":749},{"style":143},[750],{"type":41,"value":608},{"type":28,"tag":130,"props":752,"children":753},{"style":159},[754],{"type":41,"value":755},"getObjectWithKnownName",{"type":28,"tag":130,"props":757,"children":758},{"style":143},[759],{"type":41,"value":167},{"type":28,"tag":130,"props":761,"children":762},{"style":170},[763],{"type":41,"value":764},"'Playwright'",{"type":28,"tag":130,"props":766,"children":767},{"style":143},[768],{"type":41,"value":415},{"type":28,"tag":130,"props":770,"children":771},{"style":153},[772],{"type":41,"value":773},"as",{"type":28,"tag":130,"props":775,"children":776},{"style":159},[777],{"type":41,"value":343},{"type":28,"tag":130,"props":779,"children":780},{"style":143},[781],{"type":41,"value":782},";\n",{"type":28,"tag":130,"props":784,"children":786},{"class":132,"line":785},19,[787,792,797,801,806,810,815],{"type":28,"tag":130,"props":788,"children":789},{"style":143},[790],{"type":41,"value":791},"  playwrightAPI.chromium._serverLauncher ",{"type":28,"tag":130,"props":793,"children":794},{"style":153},[795],{"type":41,"value":796},"=",{"type":28,"tag":130,"props":798,"children":799},{"style":153},[800],{"type":41,"value":466},{"type":28,"tag":130,"props":802,"children":803},{"style":159},[804],{"type":41,"value":805}," BrowserServerLauncherImpl",{"type":28,"tag":130,"props":807,"children":808},{"style":143},[809],{"type":41,"value":167},{"type":28,"tag":130,"props":811,"children":812},{"style":170},[813],{"type":41,"value":814},"'chromium'",{"type":28,"tag":130,"props":816,"children":817},{"style":143},[818],{"type":41,"value":178},{"type":28,"tag":130,"props":820,"children":822},{"class":132,"line":821},20,[823,828,832,836,840,844,849],{"type":28,"tag":130,"props":824,"children":825},{"style":143},[826],{"type":41,"value":827},"  playwrightAPI.firefox._serverLauncher ",{"type":28,"tag":130,"props":829,"children":830},{"style":153},[831],{"type":41,"value":796},{"type":28,"tag":130,"props":833,"children":834},{"style":153},[835],{"type":41,"value":466},{"type":28,"tag":130,"props":837,"children":838},{"style":159},[839],{"type":41,"value":805},{"type":28,"tag":130,"props":841,"children":842},{"style":143},[843],{"type":41,"value":167},{"type":28,"tag":130,"props":845,"children":846},{"style":170},[847],{"type":41,"value":848},"'firefox'",{"type":28,"tag":130,"props":850,"children":851},{"style":143},[852],{"type":41,"value":178},{"type":28,"tag":130,"props":854,"children":856},{"class":132,"line":855},21,[857,862,866,870,874,878,883],{"type":28,"tag":130,"props":858,"children":859},{"style":143},[860],{"type":41,"value":861},"  playwrightAPI.webkit._serverLauncher ",{"type":28,"tag":130,"props":863,"children":864},{"style":153},[865],{"type":41,"value":796},{"type":28,"tag":130,"props":867,"children":868},{"style":153},[869],{"type":41,"value":466},{"type":28,"tag":130,"props":871,"children":872},{"style":159},[873],{"type":41,"value":805},{"type":28,"tag":130,"props":875,"children":876},{"style":143},[877],{"type":41,"value":167},{"type":28,"tag":130,"props":879,"children":880},{"style":170},[881],{"type":41,"value":882},"'webkit'",{"type":28,"tag":130,"props":884,"children":885},{"style":143},[886],{"type":41,"value":178},{"type":28,"tag":130,"props":888,"children":890},{"class":132,"line":889},22,[891,896,900,904,909],{"type":28,"tag":130,"props":892,"children":893},{"style":143},[894],{"type":41,"value":895},"  playwrightAPI._android._serverLauncher ",{"type":28,"tag":130,"props":897,"children":898},{"style":153},[899],{"type":41,"value":796},{"type":28,"tag":130,"props":901,"children":902},{"style":153},[903],{"type":41,"value":466},{"type":28,"tag":130,"props":905,"children":906},{"style":159},[907],{"type":41,"value":908}," AndroidServerLauncherImpl",{"type":28,"tag":130,"props":910,"children":911},{"style":143},[912],{"type":41,"value":512},{"type":28,"tag":130,"props":914,"children":916},{"class":132,"line":915},23,[917],{"type":28,"tag":130,"props":918,"children":919},{"emptyLinePlaceholder":441},[920],{"type":41,"value":444},{"type":28,"tag":130,"props":922,"children":924},{"class":132,"line":923},24,[925],{"type":28,"tag":130,"props":926,"children":927},{"style":550},[928],{"type":41,"value":929},"  // Switch to async dispatch after we got Playwright object.\n",{"type":28,"tag":130,"props":931,"children":933},{"class":132,"line":932},25,[934,938,942,946,950,954,959,964,969,973,977],{"type":28,"tag":130,"props":935,"children":936},{"style":143},[937],{"type":41,"value":583},{"type":28,"tag":130,"props":939,"children":940},{"style":159},[941],{"type":41,"value":588},{"type":28,"tag":130,"props":943,"children":944},{"style":153},[945],{"type":41,"value":156},{"type":28,"tag":130,"props":947,"children":948},{"style":595},[949],{"type":41,"value":598},{"type":28,"tag":130,"props":951,"children":952},{"style":153},[953],{"type":41,"value":603},{"type":28,"tag":130,"props":955,"children":956},{"style":159},[957],{"type":41,"value":958}," setImmediate",{"type":28,"tag":130,"props":960,"children":961},{"style":143},[962],{"type":41,"value":963},"(() ",{"type":28,"tag":130,"props":965,"children":966},{"style":153},[967],{"type":41,"value":968},"=>",{"type":28,"tag":130,"props":970,"children":971},{"style":143},[972],{"type":41,"value":608},{"type":28,"tag":130,"props":974,"children":975},{"style":159},[976],{"type":41,"value":613},{"type":28,"tag":130,"props":978,"children":979},{"style":143},[980],{"type":41,"value":981},"(message));\n",{"type":28,"tag":130,"props":983,"children":985},{"class":132,"line":984},26,[986,990,994,998,1002,1006,1010,1014,1018,1022,1026],{"type":28,"tag":130,"props":987,"children":988},{"style":143},[989],{"type":41,"value":502},{"type":28,"tag":130,"props":991,"children":992},{"style":159},[993],{"type":41,"value":588},{"type":28,"tag":130,"props":995,"children":996},{"style":153},[997],{"type":41,"value":156},{"type":28,"tag":130,"props":999,"children":1000},{"style":595},[1001],{"type":41,"value":598},{"type":28,"tag":130,"props":1003,"children":1004},{"style":153},[1005],{"type":41,"value":603},{"type":28,"tag":130,"props":1007,"children":1008},{"style":159},[1009],{"type":41,"value":958},{"type":28,"tag":130,"props":1011,"children":1012},{"style":143},[1013],{"type":41,"value":963},{"type":28,"tag":130,"props":1015,"children":1016},{"style":153},[1017],{"type":41,"value":968},{"type":28,"tag":130,"props":1019,"children":1020},{"style":143},[1021],{"type":41,"value":647},{"type":28,"tag":130,"props":1023,"children":1024},{"style":159},[1025],{"type":41,"value":613},{"type":28,"tag":130,"props":1027,"children":1028},{"style":143},[1029],{"type":41,"value":981},{"type":28,"tag":130,"props":1031,"children":1033},{"class":132,"line":1032},27,[1034],{"type":28,"tag":130,"props":1035,"children":1036},{"emptyLinePlaceholder":441},[1037],{"type":41,"value":444},{"type":28,"tag":130,"props":1039,"children":1041},{"class":132,"line":1040},28,[1042,1046,1051,1055,1060,1065,1069,1074,1078,1082],{"type":28,"tag":130,"props":1043,"children":1044},{"style":143},[1045],{"type":41,"value":502},{"type":28,"tag":130,"props":1047,"children":1048},{"style":159},[1049],{"type":41,"value":1050},"toImpl",{"type":28,"tag":130,"props":1052,"children":1053},{"style":153},[1054],{"type":41,"value":156},{"type":28,"tag":130,"props":1056,"children":1057},{"style":143},[1058],{"type":41,"value":1059}," (",{"type":28,"tag":130,"props":1061,"children":1062},{"style":595},[1063],{"type":41,"value":1064},"x",{"type":28,"tag":130,"props":1066,"children":1067},{"style":153},[1068],{"type":41,"value":338},{"type":28,"tag":130,"props":1070,"children":1071},{"style":137},[1072],{"type":41,"value":1073}," any",{"type":28,"tag":130,"props":1075,"children":1076},{"style":143},[1077],{"type":41,"value":415},{"type":28,"tag":130,"props":1079,"children":1080},{"style":153},[1081],{"type":41,"value":968},{"type":28,"tag":130,"props":1083,"children":1084},{"style":143},[1085],{"type":41,"value":1086}," x\n",{"type":28,"tag":130,"props":1088,"children":1090},{"class":132,"line":1089},29,[1091,1096,1101,1106,1111,1116],{"type":28,"tag":130,"props":1092,"children":1093},{"style":153},[1094],{"type":41,"value":1095},"    ?",{"type":28,"tag":130,"props":1097,"children":1098},{"style":143},[1099],{"type":41,"value":1100}," dispatcherConnection._dispatchers.",{"type":28,"tag":130,"props":1102,"children":1103},{"style":159},[1104],{"type":41,"value":1105},"get",{"type":28,"tag":130,"props":1107,"children":1108},{"style":143},[1109],{"type":41,"value":1110},"(x._guid)",{"type":28,"tag":130,"props":1112,"children":1113},{"style":153},[1114],{"type":41,"value":1115},"!",{"type":28,"tag":130,"props":1117,"children":1118},{"style":143},[1119],{"type":41,"value":1120},"._object\n",{"type":28,"tag":130,"props":1122,"children":1124},{"class":132,"line":1123},30,[1125,1130,1134,1138,1142,1147],{"type":28,"tag":130,"props":1126,"children":1127},{"style":153},[1128],{"type":41,"value":1129},"    :",{"type":28,"tag":130,"props":1131,"children":1132},{"style":143},[1133],{"type":41,"value":1100},{"type":28,"tag":130,"props":1135,"children":1136},{"style":159},[1137],{"type":41,"value":1105},{"type":28,"tag":130,"props":1139,"children":1140},{"style":143},[1141],{"type":41,"value":167},{"type":28,"tag":130,"props":1143,"children":1144},{"style":170},[1145],{"type":41,"value":1146},"''",{"type":28,"tag":130,"props":1148,"children":1149},{"style":143},[1150],{"type":41,"value":178},{"type":28,"tag":130,"props":1152,"children":1154},{"class":132,"line":1153},31,[1155,1160,1164,1168,1173,1177],{"type":28,"tag":130,"props":1156,"children":1157},{"style":143},[1158],{"type":41,"value":1159},"  (playwrightAPI ",{"type":28,"tag":130,"props":1161,"children":1162},{"style":153},[1163],{"type":41,"value":773},{"type":28,"tag":130,"props":1165,"children":1166},{"style":137},[1167],{"type":41,"value":1073},{"type":28,"tag":130,"props":1169,"children":1170},{"style":143},[1171],{"type":41,"value":1172},")._toImpl ",{"type":28,"tag":130,"props":1174,"children":1175},{"style":153},[1176],{"type":41,"value":796},{"type":28,"tag":130,"props":1178,"children":1179},{"style":143},[1180],{"type":41,"value":1181}," clientConnection.toImpl;\n",{"type":28,"tag":130,"props":1183,"children":1185},{"class":132,"line":1184},32,[1186,1191],{"type":28,"tag":130,"props":1187,"children":1188},{"style":153},[1189],{"type":41,"value":1190},"  return",{"type":28,"tag":130,"props":1192,"children":1193},{"style":143},[1194],{"type":41,"value":1195}," playwrightAPI;\n",{"type":28,"tag":130,"props":1197,"children":1199},{"class":132,"line":1198},33,[1200],{"type":28,"tag":130,"props":1201,"children":1202},{"style":143},[1203],{"type":41,"value":1204},"}\n",{"type":28,"tag":1206,"props":1207,"children":1209},"h3",{"id":1208},"cross-communication-between-client-and-server",[1210],{"type":41,"value":1211},"Cross communication between client and server",{"type":28,"tag":29,"props":1213,"children":1214},{},[1215,1217,1223,1225,1231,1233,1238,1240,1246,1247,1253,1255,1260,1262,1267],{"type":41,"value":1216},"If you scan through the script, noting the imports for anything with ",{"type":28,"tag":44,"props":1218,"children":1220},{"className":1219},[],[1221],{"type":41,"value":1222},"Dispatcher",{"type":41,"value":1224}," in its name, and ",{"type":28,"tag":44,"props":1226,"children":1228},{"className":1227},[],[1229],{"type":41,"value":1230},"createPlaywright",{"type":41,"value":1232},", comes from the ",{"type":28,"tag":44,"props":1234,"children":1236},{"className":1235},[],[1237],{"type":41,"value":244},{"type":41,"value":1239}," directory, but the imports for ",{"type":28,"tag":44,"props":1241,"children":1243},{"className":1242},[],[1244],{"type":41,"value":1245},"Connection",{"type":41,"value":59},{"type":28,"tag":44,"props":1248,"children":1250},{"className":1249},[],[1251],{"type":41,"value":1252},"PlaywrightAPI",{"type":41,"value":1254}," come from the ",{"type":28,"tag":44,"props":1256,"children":1258},{"className":1257},[],[1259],{"type":41,"value":236},{"type":41,"value":1261}," directory, you'll find there's cross-communication between these two packages. The interface between these two parts of the core library is through the ",{"type":28,"tag":44,"props":1263,"children":1265},{"className":1264},[],[1266],{"type":41,"value":588},{"type":41,"value":1268}," property for each connection, set as",{"type":28,"tag":119,"props":1270,"children":1272},{"className":304,"code":1271,"language":306,"meta":7,"style":7},"dispatcherConnection.onmessage = message => clientConnection.dispatch(message);\nclientConnection.onmessage = message => dispatcherConnection.dispatch(message);\n",[1273],{"type":28,"tag":44,"props":1274,"children":1275},{"__ignoreMap":7},[1276,1312],{"type":28,"tag":130,"props":1277,"children":1278},{"class":132,"line":133},[1279,1284,1288,1292,1296,1300,1304,1308],{"type":28,"tag":130,"props":1280,"children":1281},{"style":143},[1282],{"type":41,"value":1283},"dispatcherConnection.",{"type":28,"tag":130,"props":1285,"children":1286},{"style":159},[1287],{"type":41,"value":588},{"type":28,"tag":130,"props":1289,"children":1290},{"style":153},[1291],{"type":41,"value":156},{"type":28,"tag":130,"props":1293,"children":1294},{"style":595},[1295],{"type":41,"value":598},{"type":28,"tag":130,"props":1297,"children":1298},{"style":153},[1299],{"type":41,"value":603},{"type":28,"tag":130,"props":1301,"children":1302},{"style":143},[1303],{"type":41,"value":608},{"type":28,"tag":130,"props":1305,"children":1306},{"style":159},[1307],{"type":41,"value":613},{"type":28,"tag":130,"props":1309,"children":1310},{"style":143},[1311],{"type":41,"value":618},{"type":28,"tag":130,"props":1313,"children":1314},{"class":132,"line":351},[1315,1320,1324,1328,1332,1336,1340,1344],{"type":28,"tag":130,"props":1316,"children":1317},{"style":143},[1318],{"type":41,"value":1319},"clientConnection.",{"type":28,"tag":130,"props":1321,"children":1322},{"style":159},[1323],{"type":41,"value":588},{"type":28,"tag":130,"props":1325,"children":1326},{"style":153},[1327],{"type":41,"value":156},{"type":28,"tag":130,"props":1329,"children":1330},{"style":595},[1331],{"type":41,"value":598},{"type":28,"tag":130,"props":1333,"children":1334},{"style":153},[1335],{"type":41,"value":603},{"type":28,"tag":130,"props":1337,"children":1338},{"style":143},[1339],{"type":41,"value":647},{"type":28,"tag":130,"props":1341,"children":1342},{"style":159},[1343],{"type":41,"value":613},{"type":28,"tag":130,"props":1345,"children":1346},{"style":143},[1347],{"type":41,"value":618},{"type":28,"tag":29,"props":1349,"children":1350},{},[1351,1353,1358,1360,1366],{"type":41,"value":1352},"Also, the ",{"type":28,"tag":44,"props":1354,"children":1356},{"className":1355},[],[1357],{"type":41,"value":1252},{"type":41,"value":1359}," instance is creating dynamically from the ",{"type":28,"tag":44,"props":1361,"children":1363},{"className":1362},[],[1364],{"type":41,"value":1365},"clientConection",{"type":41,"value":395},{"type":28,"tag":119,"props":1368,"children":1370},{"className":304,"code":1369,"language":306,"meta":7,"style":7},"const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright') as PlaywrightAPI;\n",[1371],{"type":28,"tag":44,"props":1372,"children":1373},{"__ignoreMap":7},[1374],{"type":28,"tag":130,"props":1375,"children":1376},{"class":132,"line":133},[1377,1382,1386,1390,1394,1398,1402,1406,1410,1414,1418],{"type":28,"tag":130,"props":1378,"children":1379},{"style":153},[1380],{"type":41,"value":1381},"const",{"type":28,"tag":130,"props":1383,"children":1384},{"style":137},[1385],{"type":41,"value":742},{"type":28,"tag":130,"props":1387,"children":1388},{"style":153},[1389],{"type":41,"value":156},{"type":28,"tag":130,"props":1391,"children":1392},{"style":143},[1393],{"type":41,"value":608},{"type":28,"tag":130,"props":1395,"children":1396},{"style":159},[1397],{"type":41,"value":755},{"type":28,"tag":130,"props":1399,"children":1400},{"style":143},[1401],{"type":41,"value":167},{"type":28,"tag":130,"props":1403,"children":1404},{"style":170},[1405],{"type":41,"value":764},{"type":28,"tag":130,"props":1407,"children":1408},{"style":143},[1409],{"type":41,"value":415},{"type":28,"tag":130,"props":1411,"children":1412},{"style":153},[1413],{"type":41,"value":773},{"type":28,"tag":130,"props":1415,"children":1416},{"style":159},[1417],{"type":41,"value":343},{"type":28,"tag":130,"props":1419,"children":1420},{"style":143},[1421],{"type":41,"value":782},{"type":28,"tag":29,"props":1423,"children":1424},{},[1425],{"type":41,"value":1426},"which is the client API you will use if importing a browser, e.g.",{"type":28,"tag":119,"props":1428,"children":1430},{"className":304,"code":1429,"language":306,"meta":7,"style":7},"import { chromium } from 'playwright-core'\n",[1431],{"type":28,"tag":44,"props":1432,"children":1433},{"__ignoreMap":7},[1434],{"type":28,"tag":130,"props":1435,"children":1436},{"class":132,"line":133},[1437,1442,1447,1452],{"type":28,"tag":130,"props":1438,"children":1439},{"style":153},[1440],{"type":41,"value":1441},"import",{"type":28,"tag":130,"props":1443,"children":1444},{"style":143},[1445],{"type":41,"value":1446}," { chromium } ",{"type":28,"tag":130,"props":1448,"children":1449},{"style":153},[1450],{"type":41,"value":1451},"from",{"type":28,"tag":130,"props":1453,"children":1454},{"style":170},[1455],{"type":41,"value":1456}," 'playwright-core'\n",{"type":28,"tag":29,"props":1458,"children":1459},{},[1460,1462,1468,1470,1475,1477,1483],{"type":41,"value":1461},"so on first site is not clear what kind of code execution is actually happening here since you might expect to just be importing from the ",{"type":28,"tag":44,"props":1463,"children":1465},{"className":1464},[],[1466],{"type":41,"value":1467},"client",{"type":41,"value":1469}," library in ",{"type":28,"tag":44,"props":1471,"children":1473},{"className":1472},[],[1474],{"type":41,"value":107},{"type":41,"value":1476},". This mystery is answered by tracing the logic of the two lines of code between the onmessage variables being set, and the creation of the ",{"type":28,"tag":44,"props":1478,"children":1480},{"className":1479},[],[1481],{"type":41,"value":1482},"playwrightAPI",{"type":41,"value":338},{"type":28,"tag":119,"props":1485,"children":1487},{"className":304,"code":1486,"language":306,"meta":7,"style":7},"const rootScope = new RootDispatcher(dispatcherConnection);\n\n// Initialize Playwright channel.\nnew PlaywrightDispatcher(rootScope, playwright);\n",[1488],{"type":28,"tag":44,"props":1489,"children":1490},{"__ignoreMap":7},[1491,1518,1525,1533],{"type":28,"tag":130,"props":1492,"children":1493},{"class":132,"line":133},[1494,1498,1502,1506,1510,1514],{"type":28,"tag":130,"props":1495,"children":1496},{"style":153},[1497],{"type":41,"value":1381},{"type":28,"tag":130,"props":1499,"children":1500},{"style":137},[1501],{"type":41,"value":675},{"type":28,"tag":130,"props":1503,"children":1504},{"style":153},[1505],{"type":41,"value":156},{"type":28,"tag":130,"props":1507,"children":1508},{"style":153},[1509],{"type":41,"value":466},{"type":28,"tag":130,"props":1511,"children":1512},{"style":159},[1513],{"type":41,"value":688},{"type":28,"tag":130,"props":1515,"children":1516},{"style":143},[1517],{"type":41,"value":693},{"type":28,"tag":130,"props":1519,"children":1520},{"class":132,"line":351},[1521],{"type":28,"tag":130,"props":1522,"children":1523},{"emptyLinePlaceholder":441},[1524],{"type":41,"value":444},{"type":28,"tag":130,"props":1526,"children":1527},{"class":132,"line":379},[1528],{"type":28,"tag":130,"props":1529,"children":1530},{"style":550},[1531],{"type":41,"value":1532},"// Initialize Playwright channel.\n",{"type":28,"tag":130,"props":1534,"children":1535},{"class":132,"line":428},[1536,1541,1545],{"type":28,"tag":130,"props":1537,"children":1538},{"style":153},[1539],{"type":41,"value":1540},"new",{"type":28,"tag":130,"props":1542,"children":1543},{"style":159},[1544],{"type":41,"value":724},{"type":28,"tag":130,"props":1546,"children":1547},{"style":143},[1548],{"type":41,"value":729},{"type":28,"tag":29,"props":1550,"children":1551},{},[1552,1554,1560,1562,1568,1570,1576,1578,1584],{"type":41,"value":1553},"Here the rootScope acts as a wrapper around the dispatcherConnection which every subsequent dispatcher uses under the hood. This is because the ",{"type":28,"tag":44,"props":1555,"children":1557},{"className":1556},[],[1558],{"type":41,"value":1559},"PlaywrightDispatcher",{"type":41,"value":1561}," passes in the ",{"type":28,"tag":44,"props":1563,"children":1565},{"className":1564},[],[1566],{"type":41,"value":1567},"rootScope",{"type":41,"value":1569}," as ",{"type":28,"tag":44,"props":1571,"children":1573},{"className":1572},[],[1574],{"type":41,"value":1575},"scope",{"type":41,"value":1577}," in its constructor when calling ",{"type":28,"tag":44,"props":1579,"children":1581},{"className":1580},[],[1582],{"type":41,"value":1583},"super",{"type":41,"value":1585},". Here I include a simplified version of the constructor:",{"type":28,"tag":119,"props":1587,"children":1589},{"className":304,"code":1588,"language":306,"meta":7,"style":7},"// server/dispatchers/playwrightDispatcher.ts\nconstructor(scope: RootDispatcher, playwright: Playwright) {\n  const android = new AndroidDispatcher(scope, playwright.android);\n  // parameter names in the base Dispatcher class are\n  // parent, object, type, initializer\n  super(scope, playwright, 'Playwright', {\n    chromium: new BrowserTypeDispatcher(scope, playwright.chromium),\n    firefox: new BrowserTypeDispatcher(scope, playwright.firefox),\n    webkit: new BrowserTypeDispatcher(scope, playwright.webkit),\n    android,\n    electron: new ElectronDispatcher(scope, playwright.electron),\n  });\n}\n",[1590],{"type":28,"tag":44,"props":1591,"children":1592},{"__ignoreMap":7},[1593,1601,1614,1644,1652,1660,1682,1704,1725,1746,1754,1776,1783],{"type":28,"tag":130,"props":1594,"children":1595},{"class":132,"line":133},[1596],{"type":28,"tag":130,"props":1597,"children":1598},{"style":550},[1599],{"type":41,"value":1600},"// server/dispatchers/playwrightDispatcher.ts\n",{"type":28,"tag":130,"props":1602,"children":1603},{"class":132,"line":351},[1604,1609],{"type":28,"tag":130,"props":1605,"children":1606},{"style":159},[1607],{"type":41,"value":1608},"constructor",{"type":28,"tag":130,"props":1610,"children":1611},{"style":143},[1612],{"type":41,"value":1613},"(scope: RootDispatcher, playwright: Playwright) {\n",{"type":28,"tag":130,"props":1615,"children":1616},{"class":132,"line":379},[1617,1621,1626,1630,1634,1639],{"type":28,"tag":130,"props":1618,"children":1619},{"style":153},[1620],{"type":41,"value":357},{"type":28,"tag":130,"props":1622,"children":1623},{"style":137},[1624],{"type":41,"value":1625}," android",{"type":28,"tag":130,"props":1627,"children":1628},{"style":153},[1629],{"type":41,"value":156},{"type":28,"tag":130,"props":1631,"children":1632},{"style":153},[1633],{"type":41,"value":466},{"type":28,"tag":130,"props":1635,"children":1636},{"style":159},[1637],{"type":41,"value":1638}," AndroidDispatcher",{"type":28,"tag":130,"props":1640,"children":1641},{"style":143},[1642],{"type":41,"value":1643},"(scope, playwright.android);\n",{"type":28,"tag":130,"props":1645,"children":1646},{"class":132,"line":428},[1647],{"type":28,"tag":130,"props":1648,"children":1649},{"style":550},[1650],{"type":41,"value":1651},"  // parameter names in the base Dispatcher class are\n",{"type":28,"tag":130,"props":1653,"children":1654},{"class":132,"line":437},[1655],{"type":28,"tag":130,"props":1656,"children":1657},{"style":550},[1658],{"type":41,"value":1659},"  // parent, object, type, initializer\n",{"type":28,"tag":130,"props":1661,"children":1662},{"class":132,"line":447},[1663,1668,1673,1677],{"type":28,"tag":130,"props":1664,"children":1665},{"style":137},[1666],{"type":41,"value":1667},"  super",{"type":28,"tag":130,"props":1669,"children":1670},{"style":143},[1671],{"type":41,"value":1672},"(scope, playwright, ",{"type":28,"tag":130,"props":1674,"children":1675},{"style":170},[1676],{"type":41,"value":764},{"type":28,"tag":130,"props":1678,"children":1679},{"style":143},[1680],{"type":41,"value":1681},", {\n",{"type":28,"tag":130,"props":1683,"children":1684},{"class":132,"line":496},[1685,1690,1694,1699],{"type":28,"tag":130,"props":1686,"children":1687},{"style":143},[1688],{"type":41,"value":1689},"    chromium: ",{"type":28,"tag":130,"props":1691,"children":1692},{"style":153},[1693],{"type":41,"value":1540},{"type":28,"tag":130,"props":1695,"children":1696},{"style":159},[1697],{"type":41,"value":1698}," BrowserTypeDispatcher",{"type":28,"tag":130,"props":1700,"children":1701},{"style":143},[1702],{"type":41,"value":1703},"(scope, playwright.chromium),\n",{"type":28,"tag":130,"props":1705,"children":1706},{"class":132,"line":515},[1707,1712,1716,1720],{"type":28,"tag":130,"props":1708,"children":1709},{"style":143},[1710],{"type":41,"value":1711},"    firefox: ",{"type":28,"tag":130,"props":1713,"children":1714},{"style":153},[1715],{"type":41,"value":1540},{"type":28,"tag":130,"props":1717,"children":1718},{"style":159},[1719],{"type":41,"value":1698},{"type":28,"tag":130,"props":1721,"children":1722},{"style":143},[1723],{"type":41,"value":1724},"(scope, playwright.firefox),\n",{"type":28,"tag":130,"props":1726,"children":1727},{"class":132,"line":560},[1728,1733,1737,1741],{"type":28,"tag":130,"props":1729,"children":1730},{"style":143},[1731],{"type":41,"value":1732},"    webkit: ",{"type":28,"tag":130,"props":1734,"children":1735},{"style":153},[1736],{"type":41,"value":1540},{"type":28,"tag":130,"props":1738,"children":1739},{"style":159},[1740],{"type":41,"value":1698},{"type":28,"tag":130,"props":1742,"children":1743},{"style":143},[1744],{"type":41,"value":1745},"(scope, playwright.webkit),\n",{"type":28,"tag":130,"props":1747,"children":1748},{"class":132,"line":568},[1749],{"type":28,"tag":130,"props":1750,"children":1751},{"style":143},[1752],{"type":41,"value":1753},"    android,\n",{"type":28,"tag":130,"props":1755,"children":1756},{"class":132,"line":577},[1757,1762,1766,1771],{"type":28,"tag":130,"props":1758,"children":1759},{"style":143},[1760],{"type":41,"value":1761},"    electron: ",{"type":28,"tag":130,"props":1763,"children":1764},{"style":153},[1765],{"type":41,"value":1540},{"type":28,"tag":130,"props":1767,"children":1768},{"style":159},[1769],{"type":41,"value":1770}," ElectronDispatcher",{"type":28,"tag":130,"props":1772,"children":1773},{"style":143},[1774],{"type":41,"value":1775},"(scope, playwright.electron),\n",{"type":28,"tag":130,"props":1777,"children":1778},{"class":132,"line":621},[1779],{"type":28,"tag":130,"props":1780,"children":1781},{"style":143},[1782],{"type":41,"value":434},{"type":28,"tag":130,"props":1784,"children":1785},{"class":132,"line":22},[1786],{"type":28,"tag":130,"props":1787,"children":1788},{"style":143},[1789],{"type":41,"value":1204},{"type":28,"tag":29,"props":1791,"children":1792},{},[1793,1795,1800,1802,1807,1809,1814,1816,1822,1824,1830,1832,1838,1840,1846,1848,1854],{"type":41,"value":1794},"Notice the ",{"type":28,"tag":44,"props":1796,"children":1798},{"className":1797},[],[1799],{"type":41,"value":1583},{"type":41,"value":1801}," call has parameters for each of the driver types (chromium, firefox, etc.), in its initializers object. And each of the values have the scope the ",{"type":28,"tag":44,"props":1803,"children":1805},{"className":1804},[],[1806],{"type":41,"value":1567},{"type":41,"value":1808},". Every call to the server will run through the connection in the ",{"type":28,"tag":44,"props":1810,"children":1812},{"className":1811},[],[1813],{"type":41,"value":1567},{"type":41,"value":1815},", which then can be traced through calls in each of the dispatcher classes. For example, ",{"type":28,"tag":44,"props":1817,"children":1819},{"className":1818},[],[1820],{"type":41,"value":1821},"BrowserTypeDispatcher",{"type":41,"value":1823}," will launch a ",{"type":28,"tag":44,"props":1825,"children":1827},{"className":1826},[],[1828],{"type":41,"value":1829},"BrowserDispatcher",{"type":41,"value":1831},", which is responsible for creating a ",{"type":28,"tag":44,"props":1833,"children":1835},{"className":1834},[],[1836],{"type":41,"value":1837},"BrowserContextDispatcher",{"type":41,"value":1839},", which can create a ",{"type":28,"tag":44,"props":1841,"children":1843},{"className":1842},[],[1844],{"type":41,"value":1845},"PageDispatcher",{"type":41,"value":1847},", etc. The whole hierarchy of dispatchers directly interacting with the automated browser is contained within these few dispatcher initializations. So now we can trace all calls back to the original ",{"type":28,"tag":44,"props":1849,"children":1851},{"className":1850},[],[1852],{"type":41,"value":1853},"dispatcherConnection",{"type":41,"value":1855}," defined in the factory method with confidence!",{"type":28,"tag":29,"props":1857,"children":1858},{},[1859,1861,1866,1868,1873,1875,1880,1881,1887,1889,1895,1897,1902,1904,1910,1912,1917,1919,1925,1927,1932,1934,1940,1941,1947,1948,1954,1956,1962,1964,1969,1971,1977],{"type":41,"value":1860},"The other important bit to note is where ",{"type":28,"tag":44,"props":1862,"children":1864},{"className":1863},[],[1865],{"type":41,"value":588},{"type":41,"value":1867}," is called within the ",{"type":28,"tag":44,"props":1869,"children":1871},{"className":1870},[],[1872],{"type":41,"value":1853},{"type":41,"value":1874},". The two main wrappers around this method are ",{"type":28,"tag":44,"props":1876,"children":1878},{"className":1877},[],[1879],{"type":41,"value":613},{"type":41,"value":59},{"type":28,"tag":44,"props":1882,"children":1884},{"className":1883},[],[1885],{"type":41,"value":1886},"_sendMessageToClient",{"type":41,"value":1888}," in ",{"type":28,"tag":44,"props":1890,"children":1892},{"className":1891},[],[1893],{"type":41,"value":1894},"DispatcherConnection",{"type":41,"value":1896},". The ",{"type":28,"tag":44,"props":1898,"children":1900},{"className":1899},[],[1901],{"type":41,"value":613},{"type":41,"value":1903}," function is called on the client side, from the ",{"type":28,"tag":44,"props":1905,"children":1907},{"className":1906},[],[1908],{"type":41,"value":1909},"clientConnection.onmessage",{"type":41,"value":1911}," function, so you can interpret this as the main interface the client interacts with the server, where the dispatcher finds the corresponding dispatcher, calls the action, and responds back to the listener connected via ",{"type":28,"tag":44,"props":1913,"children":1915},{"className":1914},[],[1916],{"type":41,"value":588},{"type":41,"value":1918},", which here is the ",{"type":28,"tag":44,"props":1920,"children":1922},{"className":1921},[],[1923],{"type":41,"value":1924},"clientConnection",{"type":41,"value":1926},". The other wrapper, ",{"type":28,"tag":44,"props":1928,"children":1930},{"className":1929},[],[1931],{"type":41,"value":1886},{"type":41,"value":1933},", is called from the ",{"type":28,"tag":44,"props":1935,"children":1937},{"className":1936},[],[1938],{"type":41,"value":1939},"sendEvent",{"type":41,"value":485},{"type":28,"tag":44,"props":1942,"children":1944},{"className":1943},[],[1945],{"type":41,"value":1946},"sendCreate",{"type":41,"value":485},{"type":28,"tag":44,"props":1949,"children":1951},{"className":1950},[],[1952],{"type":41,"value":1953},"sendAdopt",{"type":41,"value":1955},", and ",{"type":28,"tag":44,"props":1957,"children":1959},{"className":1958},[],[1960],{"type":41,"value":1961},"sendDestroy",{"type":41,"value":1963}," methods defined within the dispatcher. Calls to these functions are spread throughout the ",{"type":28,"tag":44,"props":1965,"children":1967},{"className":1966},[],[1968],{"type":41,"value":1222},{"type":41,"value":1970}," subclasses, which call these functions from their internal ",{"type":28,"tag":44,"props":1972,"children":1974},{"className":1973},[],[1975],{"type":41,"value":1976},"_connection",{"type":41,"value":1978}," variable.",{"type":28,"tag":29,"props":1980,"children":1981},{},[1982,1984,1989,1991,1996,1998,2003,2005,2010,2012,2018],{"type":41,"value":1983},"The ",{"type":28,"tag":44,"props":1985,"children":1987},{"className":1986},[],[1988],{"type":41,"value":1946},{"type":41,"value":1990}," function is special because it is only called from within the ",{"type":28,"tag":44,"props":1992,"children":1994},{"className":1993},[],[1995],{"type":41,"value":1222},{"type":41,"value":1997}," constructor, hence the constructor of every subclass. This tells the client connection to create a corresponding client-side class which handles messaging to this dispatcher. Moreover, looking into the ",{"type":28,"tag":44,"props":1999,"children":2001},{"className":2000},[],[2002],{"type":41,"value":1946},{"type":41,"value":2004}," implementation, internally it calls ",{"type":28,"tag":44,"props":2006,"children":2008},{"className":2007},[],[2009],{"type":41,"value":1886},{"type":41,"value":2011}," with the ",{"type":28,"tag":44,"props":2013,"children":2015},{"className":2014},[],[2016],{"type":41,"value":2017},"__create__",{"type":41,"value":2019}," parameter:",{"type":28,"tag":119,"props":2021,"children":2023},{"className":304,"code":2022,"language":306,"meta":7,"style":7},"// server/dispatchers/dispatcher.ts\nsendCreate(parent: DispatcherScope, type: string, guid: string, initializer: any, sdkObject?: SdkObject) {\n  const validator = findValidator(type, '', 'Initializer');\n  initializer = validator(initializer, '', { tChannelImpl: this._tChannelImplToWire.bind(this), binary: this._isLocal ? 'buffer' : 'toBase64' });\n  this._sendMessageToClient(parent._guid, type, '__create__', { type, initializer, guid }, sdkObject);\n}\n",[2024],{"type":28,"tag":44,"props":2025,"children":2026},{"__ignoreMap":7},[2027,2035,2057,2100,2192,2223],{"type":28,"tag":130,"props":2028,"children":2029},{"class":132,"line":133},[2030],{"type":28,"tag":130,"props":2031,"children":2032},{"style":550},[2033],{"type":41,"value":2034},"// server/dispatchers/dispatcher.ts\n",{"type":28,"tag":130,"props":2036,"children":2037},{"class":132,"line":351},[2038,2042,2047,2052],{"type":28,"tag":130,"props":2039,"children":2040},{"style":159},[2041],{"type":41,"value":1946},{"type":28,"tag":130,"props":2043,"children":2044},{"style":143},[2045],{"type":41,"value":2046},"(parent: DispatcherScope, type: string, guid: string, initializer: any, sdkObject",{"type":28,"tag":130,"props":2048,"children":2049},{"style":153},[2050],{"type":41,"value":2051},"?:",{"type":28,"tag":130,"props":2053,"children":2054},{"style":143},[2055],{"type":41,"value":2056}," SdkObject) {\n",{"type":28,"tag":130,"props":2058,"children":2059},{"class":132,"line":379},[2060,2064,2069,2073,2078,2083,2087,2091,2096],{"type":28,"tag":130,"props":2061,"children":2062},{"style":153},[2063],{"type":41,"value":357},{"type":28,"tag":130,"props":2065,"children":2066},{"style":137},[2067],{"type":41,"value":2068}," validator",{"type":28,"tag":130,"props":2070,"children":2071},{"style":153},[2072],{"type":41,"value":156},{"type":28,"tag":130,"props":2074,"children":2075},{"style":159},[2076],{"type":41,"value":2077}," findValidator",{"type":28,"tag":130,"props":2079,"children":2080},{"style":143},[2081],{"type":41,"value":2082},"(type, ",{"type":28,"tag":130,"props":2084,"children":2085},{"style":170},[2086],{"type":41,"value":1146},{"type":28,"tag":130,"props":2088,"children":2089},{"style":143},[2090],{"type":41,"value":485},{"type":28,"tag":130,"props":2092,"children":2093},{"style":170},[2094],{"type":41,"value":2095},"'Initializer'",{"type":28,"tag":130,"props":2097,"children":2098},{"style":143},[2099],{"type":41,"value":178},{"type":28,"tag":130,"props":2101,"children":2102},{"class":132,"line":428},[2103,2108,2112,2116,2121,2125,2130,2135,2140,2145,2149,2153,2158,2162,2167,2172,2177,2182,2187],{"type":28,"tag":130,"props":2104,"children":2105},{"style":143},[2106],{"type":41,"value":2107},"  initializer ",{"type":28,"tag":130,"props":2109,"children":2110},{"style":153},[2111],{"type":41,"value":796},{"type":28,"tag":130,"props":2113,"children":2114},{"style":159},[2115],{"type":41,"value":2068},{"type":28,"tag":130,"props":2117,"children":2118},{"style":143},[2119],{"type":41,"value":2120},"(initializer, ",{"type":28,"tag":130,"props":2122,"children":2123},{"style":170},[2124],{"type":41,"value":1146},{"type":28,"tag":130,"props":2126,"children":2127},{"style":143},[2128],{"type":41,"value":2129},", { tChannelImpl: ",{"type":28,"tag":130,"props":2131,"children":2132},{"style":137},[2133],{"type":41,"value":2134},"this",{"type":28,"tag":130,"props":2136,"children":2137},{"style":143},[2138],{"type":41,"value":2139},"._tChannelImplToWire.",{"type":28,"tag":130,"props":2141,"children":2142},{"style":159},[2143],{"type":41,"value":2144},"bind",{"type":28,"tag":130,"props":2146,"children":2147},{"style":143},[2148],{"type":41,"value":167},{"type":28,"tag":130,"props":2150,"children":2151},{"style":137},[2152],{"type":41,"value":2134},{"type":28,"tag":130,"props":2154,"children":2155},{"style":143},[2156],{"type":41,"value":2157},"), binary: ",{"type":28,"tag":130,"props":2159,"children":2160},{"style":137},[2161],{"type":41,"value":2134},{"type":28,"tag":130,"props":2163,"children":2164},{"style":143},[2165],{"type":41,"value":2166},"._isLocal ",{"type":28,"tag":130,"props":2168,"children":2169},{"style":153},[2170],{"type":41,"value":2171},"?",{"type":28,"tag":130,"props":2173,"children":2174},{"style":170},[2175],{"type":41,"value":2176}," 'buffer'",{"type":28,"tag":130,"props":2178,"children":2179},{"style":153},[2180],{"type":41,"value":2181}," :",{"type":28,"tag":130,"props":2183,"children":2184},{"style":170},[2185],{"type":41,"value":2186}," 'toBase64'",{"type":28,"tag":130,"props":2188,"children":2189},{"style":143},[2190],{"type":41,"value":2191}," });\n",{"type":28,"tag":130,"props":2193,"children":2194},{"class":132,"line":437},[2195,2200,2204,2208,2213,2218],{"type":28,"tag":130,"props":2196,"children":2197},{"style":137},[2198],{"type":41,"value":2199},"  this",{"type":28,"tag":130,"props":2201,"children":2202},{"style":143},[2203],{"type":41,"value":96},{"type":28,"tag":130,"props":2205,"children":2206},{"style":159},[2207],{"type":41,"value":1886},{"type":28,"tag":130,"props":2209,"children":2210},{"style":143},[2211],{"type":41,"value":2212},"(parent._guid, type, ",{"type":28,"tag":130,"props":2214,"children":2215},{"style":170},[2216],{"type":41,"value":2217},"'__create__'",{"type":28,"tag":130,"props":2219,"children":2220},{"style":143},[2221],{"type":41,"value":2222},", { type, initializer, guid }, sdkObject);\n",{"type":28,"tag":130,"props":2224,"children":2225},{"class":132,"line":447},[2226],{"type":28,"tag":130,"props":2227,"children":2228},{"style":143},[2229],{"type":41,"value":1204},{"type":28,"tag":29,"props":2231,"children":2232},{},[2233,2235,2240,2242,2247,2249,2255,2257,2262,2264,2269,2271,2276],{"type":41,"value":2234},"so if we search through the ",{"type":28,"tag":44,"props":2236,"children":2238},{"className":2237},[],[2239],{"type":41,"value":1245},{"type":41,"value":2241}," class on the client side, sure enough in its ",{"type":28,"tag":44,"props":2243,"children":2245},{"className":2244},[],[2246],{"type":41,"value":613},{"type":41,"value":2248}," function it has a call to ",{"type":28,"tag":44,"props":2250,"children":2252},{"className":2251},[],[2253],{"type":41,"value":2254},"_createRemoteObject",{"type":41,"value":2256}," for the associated method ",{"type":28,"tag":44,"props":2258,"children":2260},{"className":2259},[],[2261],{"type":41,"value":2017},{"type":41,"value":2263},". This ",{"type":28,"tag":44,"props":2265,"children":2267},{"className":2266},[],[2268],{"type":41,"value":2254},{"type":41,"value":2270}," is what initializes the client-side ",{"type":28,"tag":44,"props":2272,"children":2274},{"className":2273},[],[2275],{"type":41,"value":12},{"type":41,"value":2277}," instance, and is why we call",{"type":28,"tag":119,"props":2279,"children":2281},{"className":304,"code":2280,"language":306,"meta":7,"style":7},"const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright');\n",[2282],{"type":28,"tag":44,"props":2283,"children":2284},{"__ignoreMap":7},[2285],{"type":28,"tag":130,"props":2286,"children":2287},{"class":132,"line":133},[2288,2292,2296,2300,2304,2308,2312,2316],{"type":28,"tag":130,"props":2289,"children":2290},{"style":153},[2291],{"type":41,"value":1381},{"type":28,"tag":130,"props":2293,"children":2294},{"style":137},[2295],{"type":41,"value":742},{"type":28,"tag":130,"props":2297,"children":2298},{"style":153},[2299],{"type":41,"value":156},{"type":28,"tag":130,"props":2301,"children":2302},{"style":143},[2303],{"type":41,"value":608},{"type":28,"tag":130,"props":2305,"children":2306},{"style":159},[2307],{"type":41,"value":755},{"type":28,"tag":130,"props":2309,"children":2310},{"style":143},[2311],{"type":41,"value":167},{"type":28,"tag":130,"props":2313,"children":2314},{"style":170},[2315],{"type":41,"value":764},{"type":28,"tag":130,"props":2317,"children":2318},{"style":143},[2319],{"type":41,"value":178},{"type":28,"tag":29,"props":2321,"children":2322},{},[2323,2325,2330,2332,2337],{"type":41,"value":2324},"to set the playwright API. But let's dive a little deeper as to what's happening with the message from the ",{"type":28,"tag":44,"props":2326,"children":2328},{"className":2327},[],[2329],{"type":41,"value":1853},{"type":41,"value":2331}," over to the ",{"type":28,"tag":44,"props":2333,"children":2335},{"className":2334},[],[2336],{"type":41,"value":1924},{"type":41,"value":2338},". For the Playwright create message, it looks like",{"type":28,"tag":119,"props":2340,"children":2342},{"className":304,"code":2341,"language":306,"meta":7,"style":7},"{\n  guid: '',\n  method: '__create__',\n  params: {\n    type: 'Playwright',\n    initializer: {\n      chromium: { guid: 'browser-type@024d5a494527ece580841844a9a933a6' },\n      firefox: { guid: 'browser-type@fae8f48651c02682ad3b276f0a046d63' },\n      webkit: { guid: 'browser-type@ed1c30ab794ec863fe5b9b208c3635e1' },\n      android: { guid: 'android@832582c466c24c6933d3a5587059e1be' },\n      electron: { guid: 'electron@3829a7608477101154e15c1e25bca9ca' },\n    },\n    guid: 'Playwright'\n  }\n}\n",[2343],{"type":28,"tag":44,"props":2344,"children":2345},{"__ignoreMap":7},[2346,2354,2376,2396,2409,2429,2441,2473,2502,2531,2560,2589,2597,2614,2622],{"type":28,"tag":130,"props":2347,"children":2348},{"class":132,"line":133},[2349],{"type":28,"tag":130,"props":2350,"children":2351},{"style":143},[2352],{"type":41,"value":2353},"{\n",{"type":28,"tag":130,"props":2355,"children":2356},{"class":132,"line":351},[2357,2362,2367,2371],{"type":28,"tag":130,"props":2358,"children":2359},{"style":159},[2360],{"type":41,"value":2361},"  guid",{"type":28,"tag":130,"props":2363,"children":2364},{"style":143},[2365],{"type":41,"value":2366},": ",{"type":28,"tag":130,"props":2368,"children":2369},{"style":170},[2370],{"type":41,"value":1146},{"type":28,"tag":130,"props":2372,"children":2373},{"style":143},[2374],{"type":41,"value":2375},",\n",{"type":28,"tag":130,"props":2377,"children":2378},{"class":132,"line":379},[2379,2384,2388,2392],{"type":28,"tag":130,"props":2380,"children":2381},{"style":159},[2382],{"type":41,"value":2383},"  method",{"type":28,"tag":130,"props":2385,"children":2386},{"style":143},[2387],{"type":41,"value":2366},{"type":28,"tag":130,"props":2389,"children":2390},{"style":170},[2391],{"type":41,"value":2217},{"type":28,"tag":130,"props":2393,"children":2394},{"style":143},[2395],{"type":41,"value":2375},{"type":28,"tag":130,"props":2397,"children":2398},{"class":132,"line":428},[2399,2404],{"type":28,"tag":130,"props":2400,"children":2401},{"style":159},[2402],{"type":41,"value":2403},"  params",{"type":28,"tag":130,"props":2405,"children":2406},{"style":143},[2407],{"type":41,"value":2408},": {\n",{"type":28,"tag":130,"props":2410,"children":2411},{"class":132,"line":437},[2412,2417,2421,2425],{"type":28,"tag":130,"props":2413,"children":2414},{"style":159},[2415],{"type":41,"value":2416},"    type",{"type":28,"tag":130,"props":2418,"children":2419},{"style":143},[2420],{"type":41,"value":2366},{"type":28,"tag":130,"props":2422,"children":2423},{"style":170},[2424],{"type":41,"value":764},{"type":28,"tag":130,"props":2426,"children":2427},{"style":143},[2428],{"type":41,"value":2375},{"type":28,"tag":130,"props":2430,"children":2431},{"class":132,"line":447},[2432,2437],{"type":28,"tag":130,"props":2433,"children":2434},{"style":159},[2435],{"type":41,"value":2436},"    initializer",{"type":28,"tag":130,"props":2438,"children":2439},{"style":143},[2440],{"type":41,"value":2408},{"type":28,"tag":130,"props":2442,"children":2443},{"class":132,"line":496},[2444,2449,2454,2459,2463,2468],{"type":28,"tag":130,"props":2445,"children":2446},{"style":159},[2447],{"type":41,"value":2448},"      chromium",{"type":28,"tag":130,"props":2450,"children":2451},{"style":143},[2452],{"type":41,"value":2453},": { ",{"type":28,"tag":130,"props":2455,"children":2456},{"style":159},[2457],{"type":41,"value":2458},"guid",{"type":28,"tag":130,"props":2460,"children":2461},{"style":143},[2462],{"type":41,"value":2366},{"type":28,"tag":130,"props":2464,"children":2465},{"style":170},[2466],{"type":41,"value":2467},"'browser-type@024d5a494527ece580841844a9a933a6'",{"type":28,"tag":130,"props":2469,"children":2470},{"style":143},[2471],{"type":41,"value":2472}," },\n",{"type":28,"tag":130,"props":2474,"children":2475},{"class":132,"line":515},[2476,2481,2485,2489,2493,2498],{"type":28,"tag":130,"props":2477,"children":2478},{"style":159},[2479],{"type":41,"value":2480},"      firefox",{"type":28,"tag":130,"props":2482,"children":2483},{"style":143},[2484],{"type":41,"value":2453},{"type":28,"tag":130,"props":2486,"children":2487},{"style":159},[2488],{"type":41,"value":2458},{"type":28,"tag":130,"props":2490,"children":2491},{"style":143},[2492],{"type":41,"value":2366},{"type":28,"tag":130,"props":2494,"children":2495},{"style":170},[2496],{"type":41,"value":2497},"'browser-type@fae8f48651c02682ad3b276f0a046d63'",{"type":28,"tag":130,"props":2499,"children":2500},{"style":143},[2501],{"type":41,"value":2472},{"type":28,"tag":130,"props":2503,"children":2504},{"class":132,"line":560},[2505,2510,2514,2518,2522,2527],{"type":28,"tag":130,"props":2506,"children":2507},{"style":159},[2508],{"type":41,"value":2509},"      webkit",{"type":28,"tag":130,"props":2511,"children":2512},{"style":143},[2513],{"type":41,"value":2453},{"type":28,"tag":130,"props":2515,"children":2516},{"style":159},[2517],{"type":41,"value":2458},{"type":28,"tag":130,"props":2519,"children":2520},{"style":143},[2521],{"type":41,"value":2366},{"type":28,"tag":130,"props":2523,"children":2524},{"style":170},[2525],{"type":41,"value":2526},"'browser-type@ed1c30ab794ec863fe5b9b208c3635e1'",{"type":28,"tag":130,"props":2528,"children":2529},{"style":143},[2530],{"type":41,"value":2472},{"type":28,"tag":130,"props":2532,"children":2533},{"class":132,"line":568},[2534,2539,2543,2547,2551,2556],{"type":28,"tag":130,"props":2535,"children":2536},{"style":159},[2537],{"type":41,"value":2538},"      android",{"type":28,"tag":130,"props":2540,"children":2541},{"style":143},[2542],{"type":41,"value":2453},{"type":28,"tag":130,"props":2544,"children":2545},{"style":159},[2546],{"type":41,"value":2458},{"type":28,"tag":130,"props":2548,"children":2549},{"style":143},[2550],{"type":41,"value":2366},{"type":28,"tag":130,"props":2552,"children":2553},{"style":170},[2554],{"type":41,"value":2555},"'android@832582c466c24c6933d3a5587059e1be'",{"type":28,"tag":130,"props":2557,"children":2558},{"style":143},[2559],{"type":41,"value":2472},{"type":28,"tag":130,"props":2561,"children":2562},{"class":132,"line":577},[2563,2568,2572,2576,2580,2585],{"type":28,"tag":130,"props":2564,"children":2565},{"style":159},[2566],{"type":41,"value":2567},"      electron",{"type":28,"tag":130,"props":2569,"children":2570},{"style":143},[2571],{"type":41,"value":2453},{"type":28,"tag":130,"props":2573,"children":2574},{"style":159},[2575],{"type":41,"value":2458},{"type":28,"tag":130,"props":2577,"children":2578},{"style":143},[2579],{"type":41,"value":2366},{"type":28,"tag":130,"props":2581,"children":2582},{"style":170},[2583],{"type":41,"value":2584},"'electron@3829a7608477101154e15c1e25bca9ca'",{"type":28,"tag":130,"props":2586,"children":2587},{"style":143},[2588],{"type":41,"value":2472},{"type":28,"tag":130,"props":2590,"children":2591},{"class":132,"line":621},[2592],{"type":28,"tag":130,"props":2593,"children":2594},{"style":143},[2595],{"type":41,"value":2596},"    },\n",{"type":28,"tag":130,"props":2598,"children":2599},{"class":132,"line":22},[2600,2605,2609],{"type":28,"tag":130,"props":2601,"children":2602},{"style":159},[2603],{"type":41,"value":2604},"    guid",{"type":28,"tag":130,"props":2606,"children":2607},{"style":143},[2608],{"type":41,"value":2366},{"type":28,"tag":130,"props":2610,"children":2611},{"style":170},[2612],{"type":41,"value":2613},"'Playwright'\n",{"type":28,"tag":130,"props":2615,"children":2616},{"class":132,"line":665},[2617],{"type":28,"tag":130,"props":2618,"children":2619},{"style":143},[2620],{"type":41,"value":2621},"  }\n",{"type":28,"tag":130,"props":2623,"children":2624},{"class":132,"line":696},[2625],{"type":28,"tag":130,"props":2626,"children":2627},{"style":143},[2628],{"type":41,"value":1204},{"type":28,"tag":29,"props":2630,"children":2631},{},[2632,2634,2639,2641,2647,2649,2654,2656,2662,2664,2670,2672,2678],{"type":41,"value":2633},"note before this there are messages for each of the device types, and the ",{"type":28,"tag":44,"props":2635,"children":2637},{"className":2636},[],[2638],{"type":41,"value":1924},{"type":41,"value":2640}," constructs corresponding objects which provide a public API for these dispatchers within the server. These API's are provided by subclasses of the ",{"type":28,"tag":44,"props":2642,"children":2644},{"className":2643},[],[2645],{"type":41,"value":2646},"ChannelOwner",{"type":41,"value":2648}," class, which is a concept for a later section. For now, let's trace what happens in the ",{"type":28,"tag":44,"props":2650,"children":2652},{"className":2651},[],[2653],{"type":41,"value":1924},{"type":41,"value":2655}," for the ",{"type":28,"tag":44,"props":2657,"children":2659},{"className":2658},[],[2660],{"type":41,"value":2661},"type: 'Playwright'",{"type":41,"value":2663}," message. As mentioned before, the message is put through the ",{"type":28,"tag":44,"props":2665,"children":2667},{"className":2666},[],[2668],{"type":41,"value":2669},"clientConnection.dispatch",{"type":41,"value":2671}," function which then calls the ",{"type":28,"tag":44,"props":2673,"children":2675},{"className":2674},[],[2676],{"type":41,"value":2677},"clientConnection._createRemoteObject",{"type":41,"value":2679}," function with the following parameters",{"type":28,"tag":119,"props":2681,"children":2683},{"className":304,"code":2682,"language":306,"meta":7,"style":7},"this._createRemoteObject(\n  '', // parentGuid - corresponds to Root, the root ChannelOwner\n  'Playwright', // type\n  'Playwright', // guid\n  { // initializer\n    chromium: { guid: 'browser-type@024d5a494527ece580841844a9a933a6' },\n    firefox: { guid: 'browser-type@fae8f48651c02682ad3b276f0a046d63' },\n    webkit: { guid: 'browser-type@ed1c30ab794ec863fe5b9b208c3635e1' },\n    android: { guid: 'android@832582c466c24c6933d3a5587059e1be' },\n    electron: { guid: 'electron@3829a7608477101154e15c1e25bca9ca' },\n  }\n)\n",[2684],{"type":28,"tag":44,"props":2685,"children":2686},{"__ignoreMap":7},[2687,2707,2724,2741,2757,2770,2786,2802,2818,2834,2850,2857],{"type":28,"tag":130,"props":2688,"children":2689},{"class":132,"line":133},[2690,2694,2698,2702],{"type":28,"tag":130,"props":2691,"children":2692},{"style":137},[2693],{"type":41,"value":2134},{"type":28,"tag":130,"props":2695,"children":2696},{"style":143},[2697],{"type":41,"value":96},{"type":28,"tag":130,"props":2699,"children":2700},{"style":159},[2701],{"type":41,"value":2254},{"type":28,"tag":130,"props":2703,"children":2704},{"style":143},[2705],{"type":41,"value":2706},"(\n",{"type":28,"tag":130,"props":2708,"children":2709},{"class":132,"line":351},[2710,2715,2719],{"type":28,"tag":130,"props":2711,"children":2712},{"style":170},[2713],{"type":41,"value":2714},"  ''",{"type":28,"tag":130,"props":2716,"children":2717},{"style":143},[2718],{"type":41,"value":485},{"type":28,"tag":130,"props":2720,"children":2721},{"style":550},[2722],{"type":41,"value":2723},"// parentGuid - corresponds to Root, the root ChannelOwner\n",{"type":28,"tag":130,"props":2725,"children":2726},{"class":132,"line":379},[2727,2732,2736],{"type":28,"tag":130,"props":2728,"children":2729},{"style":170},[2730],{"type":41,"value":2731},"  'Playwright'",{"type":28,"tag":130,"props":2733,"children":2734},{"style":143},[2735],{"type":41,"value":485},{"type":28,"tag":130,"props":2737,"children":2738},{"style":550},[2739],{"type":41,"value":2740},"// type\n",{"type":28,"tag":130,"props":2742,"children":2743},{"class":132,"line":428},[2744,2748,2752],{"type":28,"tag":130,"props":2745,"children":2746},{"style":170},[2747],{"type":41,"value":2731},{"type":28,"tag":130,"props":2749,"children":2750},{"style":143},[2751],{"type":41,"value":485},{"type":28,"tag":130,"props":2753,"children":2754},{"style":550},[2755],{"type":41,"value":2756},"// guid\n",{"type":28,"tag":130,"props":2758,"children":2759},{"class":132,"line":437},[2760,2765],{"type":28,"tag":130,"props":2761,"children":2762},{"style":143},[2763],{"type":41,"value":2764},"  { ",{"type":28,"tag":130,"props":2766,"children":2767},{"style":550},[2768],{"type":41,"value":2769},"// initializer\n",{"type":28,"tag":130,"props":2771,"children":2772},{"class":132,"line":447},[2773,2778,2782],{"type":28,"tag":130,"props":2774,"children":2775},{"style":143},[2776],{"type":41,"value":2777},"    chromium: { guid: ",{"type":28,"tag":130,"props":2779,"children":2780},{"style":170},[2781],{"type":41,"value":2467},{"type":28,"tag":130,"props":2783,"children":2784},{"style":143},[2785],{"type":41,"value":2472},{"type":28,"tag":130,"props":2787,"children":2788},{"class":132,"line":496},[2789,2794,2798],{"type":28,"tag":130,"props":2790,"children":2791},{"style":143},[2792],{"type":41,"value":2793},"    firefox: { guid: ",{"type":28,"tag":130,"props":2795,"children":2796},{"style":170},[2797],{"type":41,"value":2497},{"type":28,"tag":130,"props":2799,"children":2800},{"style":143},[2801],{"type":41,"value":2472},{"type":28,"tag":130,"props":2803,"children":2804},{"class":132,"line":515},[2805,2810,2814],{"type":28,"tag":130,"props":2806,"children":2807},{"style":143},[2808],{"type":41,"value":2809},"    webkit: { guid: ",{"type":28,"tag":130,"props":2811,"children":2812},{"style":170},[2813],{"type":41,"value":2526},{"type":28,"tag":130,"props":2815,"children":2816},{"style":143},[2817],{"type":41,"value":2472},{"type":28,"tag":130,"props":2819,"children":2820},{"class":132,"line":560},[2821,2826,2830],{"type":28,"tag":130,"props":2822,"children":2823},{"style":143},[2824],{"type":41,"value":2825},"    android: { guid: ",{"type":28,"tag":130,"props":2827,"children":2828},{"style":170},[2829],{"type":41,"value":2555},{"type":28,"tag":130,"props":2831,"children":2832},{"style":143},[2833],{"type":41,"value":2472},{"type":28,"tag":130,"props":2835,"children":2836},{"class":132,"line":568},[2837,2842,2846],{"type":28,"tag":130,"props":2838,"children":2839},{"style":143},[2840],{"type":41,"value":2841},"    electron: { guid: ",{"type":28,"tag":130,"props":2843,"children":2844},{"style":170},[2845],{"type":41,"value":2584},{"type":28,"tag":130,"props":2847,"children":2848},{"style":143},[2849],{"type":41,"value":2472},{"type":28,"tag":130,"props":2851,"children":2852},{"class":132,"line":577},[2853],{"type":28,"tag":130,"props":2854,"children":2855},{"style":143},[2856],{"type":41,"value":2621},{"type":28,"tag":130,"props":2858,"children":2859},{"class":132,"line":621},[2860],{"type":28,"tag":130,"props":2861,"children":2862},{"style":143},[2863],{"type":41,"value":2864},")\n",{"type":28,"tag":29,"props":2866,"children":2867},{},[2868,2870,2875,2877,2883],{"type":41,"value":2869},"in the ",{"type":28,"tag":44,"props":2871,"children":2873},{"className":2872},[],[2874],{"type":41,"value":2677},{"type":41,"value":2876}," function, there is a transformation of the data and then a large ",{"type":28,"tag":44,"props":2878,"children":2880},{"className":2879},[],[2881],{"type":41,"value":2882},"switch-case",{"type":41,"value":2884}," function instantiating the corresponding client class.",{"type":28,"tag":119,"props":2886,"children":2888},{"className":304,"code":2887,"language":306,"meta":7,"style":7},"_createRemoteObject(parentGuid: string, type: string, guid: string, initializer: any) {\n  const parent = this._objects.get(parentGuid); // here the parentGuid is ''\n  if (!parent)\n    throw new Error(`Cannot find parent object ${parentGuid} to create ${guid}`);\n  let result: ChannelOwner\u003Cany>;\n  const validator = findValidator(type, '', 'Initializer');\n  initializer = validator(\n    initializer,\n    '',\n    {\n      tChannelImpl: this._tChannelImplFromWire.bind(this),\n      binary: this._rawBuffers ? 'buffer' : 'fromBase64'\n    }\n  );\n  switch (type) {\n    // ...\n    case 'Playwright':\n      result = new Playwright(parent, type, guid, initializer);\n      break;\n    // ...\n  }\n  return result;\n}\n",[2889],{"type":28,"tag":44,"props":2890,"children":2891},{"__ignoreMap":7},[2892,2904,2944,2965,3014,3051,3090,3109,3117,3129,3137,3171,3205,3213,3221,3234,3242,3260,3286,3298,3305,3312,3324],{"type":28,"tag":130,"props":2893,"children":2894},{"class":132,"line":133},[2895,2899],{"type":28,"tag":130,"props":2896,"children":2897},{"style":159},[2898],{"type":41,"value":2254},{"type":28,"tag":130,"props":2900,"children":2901},{"style":143},[2902],{"type":41,"value":2903},"(parentGuid: string, type: string, guid: string, initializer: any) {\n",{"type":28,"tag":130,"props":2905,"children":2906},{"class":132,"line":351},[2907,2911,2916,2920,2925,2930,2934,2939],{"type":28,"tag":130,"props":2908,"children":2909},{"style":153},[2910],{"type":41,"value":357},{"type":28,"tag":130,"props":2912,"children":2913},{"style":137},[2914],{"type":41,"value":2915}," parent",{"type":28,"tag":130,"props":2917,"children":2918},{"style":153},[2919],{"type":41,"value":156},{"type":28,"tag":130,"props":2921,"children":2922},{"style":137},[2923],{"type":41,"value":2924}," this",{"type":28,"tag":130,"props":2926,"children":2927},{"style":143},[2928],{"type":41,"value":2929},"._objects.",{"type":28,"tag":130,"props":2931,"children":2932},{"style":159},[2933],{"type":41,"value":1105},{"type":28,"tag":130,"props":2935,"children":2936},{"style":143},[2937],{"type":41,"value":2938},"(parentGuid); ",{"type":28,"tag":130,"props":2940,"children":2941},{"style":550},[2942],{"type":41,"value":2943},"// here the parentGuid is ''\n",{"type":28,"tag":130,"props":2945,"children":2946},{"class":132,"line":379},[2947,2952,2956,2960],{"type":28,"tag":130,"props":2948,"children":2949},{"style":153},[2950],{"type":41,"value":2951},"  if",{"type":28,"tag":130,"props":2953,"children":2954},{"style":143},[2955],{"type":41,"value":1059},{"type":28,"tag":130,"props":2957,"children":2958},{"style":153},[2959],{"type":41,"value":1115},{"type":28,"tag":130,"props":2961,"children":2962},{"style":143},[2963],{"type":41,"value":2964},"parent)\n",{"type":28,"tag":130,"props":2966,"children":2967},{"class":132,"line":428},[2968,2973,2977,2982,2986,2991,2996,3001,3005,3010],{"type":28,"tag":130,"props":2969,"children":2970},{"style":153},[2971],{"type":41,"value":2972},"    throw",{"type":28,"tag":130,"props":2974,"children":2975},{"style":153},[2976],{"type":41,"value":466},{"type":28,"tag":130,"props":2978,"children":2979},{"style":159},[2980],{"type":41,"value":2981}," Error",{"type":28,"tag":130,"props":2983,"children":2984},{"style":143},[2985],{"type":41,"value":167},{"type":28,"tag":130,"props":2987,"children":2988},{"style":170},[2989],{"type":41,"value":2990},"`Cannot find parent object ${",{"type":28,"tag":130,"props":2992,"children":2993},{"style":143},[2994],{"type":41,"value":2995},"parentGuid",{"type":28,"tag":130,"props":2997,"children":2998},{"style":170},[2999],{"type":41,"value":3000},"} to create ${",{"type":28,"tag":130,"props":3002,"children":3003},{"style":143},[3004],{"type":41,"value":2458},{"type":28,"tag":130,"props":3006,"children":3007},{"style":170},[3008],{"type":41,"value":3009},"}`",{"type":28,"tag":130,"props":3011,"children":3012},{"style":143},[3013],{"type":41,"value":178},{"type":28,"tag":130,"props":3015,"children":3016},{"class":132,"line":437},[3017,3022,3027,3031,3036,3041,3046],{"type":28,"tag":130,"props":3018,"children":3019},{"style":153},[3020],{"type":41,"value":3021},"  let",{"type":28,"tag":130,"props":3023,"children":3024},{"style":143},[3025],{"type":41,"value":3026}," result",{"type":28,"tag":130,"props":3028,"children":3029},{"style":153},[3030],{"type":41,"value":338},{"type":28,"tag":130,"props":3032,"children":3033},{"style":159},[3034],{"type":41,"value":3035}," ChannelOwner",{"type":28,"tag":130,"props":3037,"children":3038},{"style":143},[3039],{"type":41,"value":3040},"\u003C",{"type":28,"tag":130,"props":3042,"children":3043},{"style":137},[3044],{"type":41,"value":3045},"any",{"type":28,"tag":130,"props":3047,"children":3048},{"style":143},[3049],{"type":41,"value":3050},">;\n",{"type":28,"tag":130,"props":3052,"children":3053},{"class":132,"line":447},[3054,3058,3062,3066,3070,3074,3078,3082,3086],{"type":28,"tag":130,"props":3055,"children":3056},{"style":153},[3057],{"type":41,"value":357},{"type":28,"tag":130,"props":3059,"children":3060},{"style":137},[3061],{"type":41,"value":2068},{"type":28,"tag":130,"props":3063,"children":3064},{"style":153},[3065],{"type":41,"value":156},{"type":28,"tag":130,"props":3067,"children":3068},{"style":159},[3069],{"type":41,"value":2077},{"type":28,"tag":130,"props":3071,"children":3072},{"style":143},[3073],{"type":41,"value":2082},{"type":28,"tag":130,"props":3075,"children":3076},{"style":170},[3077],{"type":41,"value":1146},{"type":28,"tag":130,"props":3079,"children":3080},{"style":143},[3081],{"type":41,"value":485},{"type":28,"tag":130,"props":3083,"children":3084},{"style":170},[3085],{"type":41,"value":2095},{"type":28,"tag":130,"props":3087,"children":3088},{"style":143},[3089],{"type":41,"value":178},{"type":28,"tag":130,"props":3091,"children":3092},{"class":132,"line":496},[3093,3097,3101,3105],{"type":28,"tag":130,"props":3094,"children":3095},{"style":143},[3096],{"type":41,"value":2107},{"type":28,"tag":130,"props":3098,"children":3099},{"style":153},[3100],{"type":41,"value":796},{"type":28,"tag":130,"props":3102,"children":3103},{"style":159},[3104],{"type":41,"value":2068},{"type":28,"tag":130,"props":3106,"children":3107},{"style":143},[3108],{"type":41,"value":2706},{"type":28,"tag":130,"props":3110,"children":3111},{"class":132,"line":515},[3112],{"type":28,"tag":130,"props":3113,"children":3114},{"style":143},[3115],{"type":41,"value":3116},"    initializer,\n",{"type":28,"tag":130,"props":3118,"children":3119},{"class":132,"line":560},[3120,3125],{"type":28,"tag":130,"props":3121,"children":3122},{"style":170},[3123],{"type":41,"value":3124},"    ''",{"type":28,"tag":130,"props":3126,"children":3127},{"style":143},[3128],{"type":41,"value":2375},{"type":28,"tag":130,"props":3130,"children":3131},{"class":132,"line":568},[3132],{"type":28,"tag":130,"props":3133,"children":3134},{"style":143},[3135],{"type":41,"value":3136},"    {\n",{"type":28,"tag":130,"props":3138,"children":3139},{"class":132,"line":577},[3140,3145,3149,3154,3158,3162,3166],{"type":28,"tag":130,"props":3141,"children":3142},{"style":143},[3143],{"type":41,"value":3144},"      tChannelImpl: ",{"type":28,"tag":130,"props":3146,"children":3147},{"style":137},[3148],{"type":41,"value":2134},{"type":28,"tag":130,"props":3150,"children":3151},{"style":143},[3152],{"type":41,"value":3153},"._tChannelImplFromWire.",{"type":28,"tag":130,"props":3155,"children":3156},{"style":159},[3157],{"type":41,"value":2144},{"type":28,"tag":130,"props":3159,"children":3160},{"style":143},[3161],{"type":41,"value":167},{"type":28,"tag":130,"props":3163,"children":3164},{"style":137},[3165],{"type":41,"value":2134},{"type":28,"tag":130,"props":3167,"children":3168},{"style":143},[3169],{"type":41,"value":3170},"),\n",{"type":28,"tag":130,"props":3172,"children":3173},{"class":132,"line":621},[3174,3179,3183,3188,3192,3196,3200],{"type":28,"tag":130,"props":3175,"children":3176},{"style":143},[3177],{"type":41,"value":3178},"      binary: ",{"type":28,"tag":130,"props":3180,"children":3181},{"style":137},[3182],{"type":41,"value":2134},{"type":28,"tag":130,"props":3184,"children":3185},{"style":143},[3186],{"type":41,"value":3187},"._rawBuffers ",{"type":28,"tag":130,"props":3189,"children":3190},{"style":153},[3191],{"type":41,"value":2171},{"type":28,"tag":130,"props":3193,"children":3194},{"style":170},[3195],{"type":41,"value":2176},{"type":28,"tag":130,"props":3197,"children":3198},{"style":153},[3199],{"type":41,"value":2181},{"type":28,"tag":130,"props":3201,"children":3202},{"style":170},[3203],{"type":41,"value":3204}," 'fromBase64'\n",{"type":28,"tag":130,"props":3206,"children":3207},{"class":132,"line":22},[3208],{"type":28,"tag":130,"props":3209,"children":3210},{"style":143},[3211],{"type":41,"value":3212},"    }\n",{"type":28,"tag":130,"props":3214,"children":3215},{"class":132,"line":665},[3216],{"type":28,"tag":130,"props":3217,"children":3218},{"style":143},[3219],{"type":41,"value":3220},"  );\n",{"type":28,"tag":130,"props":3222,"children":3223},{"class":132,"line":696},[3224,3229],{"type":28,"tag":130,"props":3225,"children":3226},{"style":153},[3227],{"type":41,"value":3228},"  switch",{"type":28,"tag":130,"props":3230,"children":3231},{"style":143},[3232],{"type":41,"value":3233}," (type) {\n",{"type":28,"tag":130,"props":3235,"children":3236},{"class":132,"line":704},[3237],{"type":28,"tag":130,"props":3238,"children":3239},{"style":550},[3240],{"type":41,"value":3241},"    // ...\n",{"type":28,"tag":130,"props":3243,"children":3244},{"class":132,"line":713},[3245,3250,3255],{"type":28,"tag":130,"props":3246,"children":3247},{"style":153},[3248],{"type":41,"value":3249},"    case",{"type":28,"tag":130,"props":3251,"children":3252},{"style":170},[3253],{"type":41,"value":3254}," 'Playwright'",{"type":28,"tag":130,"props":3256,"children":3257},{"style":143},[3258],{"type":41,"value":3259},":\n",{"type":28,"tag":130,"props":3261,"children":3262},{"class":132,"line":732},[3263,3268,3272,3276,3281],{"type":28,"tag":130,"props":3264,"children":3265},{"style":143},[3266],{"type":41,"value":3267},"      result ",{"type":28,"tag":130,"props":3269,"children":3270},{"style":153},[3271],{"type":41,"value":796},{"type":28,"tag":130,"props":3273,"children":3274},{"style":153},[3275],{"type":41,"value":466},{"type":28,"tag":130,"props":3277,"children":3278},{"style":159},[3279],{"type":41,"value":3280}," Playwright",{"type":28,"tag":130,"props":3282,"children":3283},{"style":143},[3284],{"type":41,"value":3285},"(parent, type, guid, initializer);\n",{"type":28,"tag":130,"props":3287,"children":3288},{"class":132,"line":785},[3289,3294],{"type":28,"tag":130,"props":3290,"children":3291},{"style":153},[3292],{"type":41,"value":3293},"      break",{"type":28,"tag":130,"props":3295,"children":3296},{"style":143},[3297],{"type":41,"value":782},{"type":28,"tag":130,"props":3299,"children":3300},{"class":132,"line":821},[3301],{"type":28,"tag":130,"props":3302,"children":3303},{"style":550},[3304],{"type":41,"value":3241},{"type":28,"tag":130,"props":3306,"children":3307},{"class":132,"line":855},[3308],{"type":28,"tag":130,"props":3309,"children":3310},{"style":143},[3311],{"type":41,"value":2621},{"type":28,"tag":130,"props":3313,"children":3314},{"class":132,"line":889},[3315,3319],{"type":28,"tag":130,"props":3316,"children":3317},{"style":153},[3318],{"type":41,"value":1190},{"type":28,"tag":130,"props":3320,"children":3321},{"style":143},[3322],{"type":41,"value":3323}," result;\n",{"type":28,"tag":130,"props":3325,"children":3326},{"class":132,"line":915},[3327],{"type":28,"tag":130,"props":3328,"children":3329},{"style":143},[3330],{"type":41,"value":1204},{"type":28,"tag":29,"props":3332,"children":3333},{},[3334,3336,3342,3344,3350,3352,3358,3360,3365,3367,3372,3374,3379,3381,3386,3388,3394,3396,3401,3403,3408,3410,3416],{"type":41,"value":3335},"The parameter ",{"type":28,"tag":44,"props":3337,"children":3339},{"className":3338},[],[3340],{"type":41,"value":3341},"tChannelImpl: _tChannelImplFromWire",{"type":41,"value":3343}," in the ",{"type":28,"tag":44,"props":3345,"children":3347},{"className":3346},[],[3348],{"type":41,"value":3349},"validator",{"type":41,"value":3351}," function is responsible for taking the initializer object above, which contains a guid for each browser, and convert it to the corresponding object stored in the ",{"type":28,"tag":44,"props":3353,"children":3355},{"className":3354},[],[3356],{"type":41,"value":3357},"_objects",{"type":41,"value":3359}," variable in the ",{"type":28,"tag":44,"props":3361,"children":3363},{"className":3362},[],[3364],{"type":41,"value":1245},{"type":41,"value":3366}," class. If you look at the type definition in ",{"type":28,"tag":44,"props":3368,"children":3370},{"className":3369},[],[3371],{"type":41,"value":1245},{"type":41,"value":3373}," the ",{"type":28,"tag":44,"props":3375,"children":3377},{"className":3376},[],[3378],{"type":41,"value":3357},{"type":41,"value":3380}," variable is a map returning one of the ",{"type":28,"tag":44,"props":3382,"children":3384},{"className":3383},[],[3385],{"type":41,"value":2646},{"type":41,"value":3387}," subclasses. So in the result above for the ",{"type":28,"tag":44,"props":3389,"children":3391},{"className":3390},[],[3392],{"type":41,"value":3393},"case: 'Playwright'",{"type":41,"value":3395},", it returns a ",{"type":28,"tag":44,"props":3397,"children":3399},{"className":3398},[],[3400],{"type":41,"value":12},{"type":41,"value":3402}," instance, which is a subclass of ",{"type":28,"tag":44,"props":3404,"children":3406},{"className":3405},[],[3407],{"type":41,"value":2646},{"type":41,"value":3409},", defined in ",{"type":28,"tag":44,"props":3411,"children":3413},{"className":3412},[],[3414],{"type":41,"value":3415},"client/playwright.ts",{"type":41,"value":96},{"type":28,"tag":119,"props":3418,"children":3420},{"className":304,"code":3419,"language":306,"meta":7,"style":7},"class Connection extends EventEmitter {\n  _objects: Map\u003CString, ChannelOwner>\n}\n",[3421],{"type":28,"tag":44,"props":3422,"children":3423},{"__ignoreMap":7},[3424,3450,3489],{"type":28,"tag":130,"props":3425,"children":3426},{"class":132,"line":133},[3427,3432,3436,3441,3446],{"type":28,"tag":130,"props":3428,"children":3429},{"style":153},[3430],{"type":41,"value":3431},"class",{"type":28,"tag":130,"props":3433,"children":3434},{"style":159},[3435],{"type":41,"value":471},{"type":28,"tag":130,"props":3437,"children":3438},{"style":153},[3439],{"type":41,"value":3440}," extends",{"type":28,"tag":130,"props":3442,"children":3443},{"style":159},[3444],{"type":41,"value":3445}," EventEmitter",{"type":28,"tag":130,"props":3447,"children":3448},{"style":143},[3449],{"type":41,"value":348},{"type":28,"tag":130,"props":3451,"children":3452},{"class":132,"line":351},[3453,3458,3462,3467,3471,3476,3480,3484],{"type":28,"tag":130,"props":3454,"children":3455},{"style":595},[3456],{"type":41,"value":3457},"  _objects",{"type":28,"tag":130,"props":3459,"children":3460},{"style":153},[3461],{"type":41,"value":338},{"type":28,"tag":130,"props":3463,"children":3464},{"style":159},[3465],{"type":41,"value":3466}," Map",{"type":28,"tag":130,"props":3468,"children":3469},{"style":143},[3470],{"type":41,"value":3040},{"type":28,"tag":130,"props":3472,"children":3473},{"style":159},[3474],{"type":41,"value":3475},"String",{"type":28,"tag":130,"props":3477,"children":3478},{"style":143},[3479],{"type":41,"value":485},{"type":28,"tag":130,"props":3481,"children":3482},{"style":159},[3483],{"type":41,"value":2646},{"type":28,"tag":130,"props":3485,"children":3486},{"style":143},[3487],{"type":41,"value":3488},">\n",{"type":28,"tag":130,"props":3490,"children":3491},{"class":132,"line":379},[3492],{"type":28,"tag":130,"props":3493,"children":3494},{"style":143},[3495],{"type":41,"value":1204},{"type":28,"tag":29,"props":3497,"children":3498},{},[3499,3500,3506,3508,3514,3516,3521,3523,3528,3530,3535,3537,3543,3545,3551,3552,3557,3559,3565,3567,3572],{"type":41,"value":1983},{"type":28,"tag":44,"props":3501,"children":3503},{"className":3502},[],[3504],{"type":41,"value":3505},"_tChannelImplFromWire",{"type":41,"value":3507}," function is responsible for turning the ",{"type":28,"tag":44,"props":3509,"children":3511},{"className":3510},[],[3512],{"type":41,"value":3513},"initializer",{"type":41,"value":3515}," parameter in the constructor for ",{"type":28,"tag":44,"props":3517,"children":3519},{"className":3518},[],[3520],{"type":41,"value":12},{"type":41,"value":3522}," into the ",{"type":28,"tag":44,"props":3524,"children":3526},{"className":3525},[],[3527],{"type":41,"value":2646},{"type":41,"value":3529}," subclasses for each of the drivers (chrome, firefox, etc.). Note before the ",{"type":28,"tag":44,"props":3531,"children":3533},{"className":3532},[],[3534],{"type":41,"value":12},{"type":41,"value":3536}," message was sent over to the client, there were messages for each of the ",{"type":28,"tag":44,"props":3538,"children":3540},{"className":3539},[],[3541],{"type":41,"value":3542},"BrowserType",{"type":41,"value":3544}," objects with name ",{"type":28,"tag":44,"props":3546,"children":3548},{"className":3547},[],[3549],{"type":41,"value":3550},"'chrome'",{"type":41,"value":485},{"type":28,"tag":44,"props":3553,"children":3555},{"className":3554},[],[3556],{"type":41,"value":848},{"type":41,"value":3558},", etc. If you inspect this object manually, you will find many ",{"type":28,"tag":44,"props":3560,"children":3562},{"className":3561},[],[3563],{"type":41,"value":3564},"EventEmitter",{"type":41,"value":3566}," objects in the ",{"type":28,"tag":44,"props":3568,"children":3570},{"className":3569},[],[3571],{"type":41,"value":3513},{"type":41,"value":3573}," object.",{"type":28,"tag":29,"props":3575,"children":3576},{},[3577,3579,3585,3587,3593,3595,3601,3603,3608,3610,3616,3618,3623,3625,3630,3632,3637],{"type":41,"value":3578},"The other main point to note is the ",{"type":28,"tag":44,"props":3580,"children":3582},{"className":3581},[],[3583],{"type":41,"value":3584},"Root",{"type":41,"value":3586}," design pattern is used on the client side as well. The ",{"type":28,"tag":44,"props":3588,"children":3590},{"className":3589},[],[3591],{"type":41,"value":3592},"parent",{"type":41,"value":3594}," corresponding to the ",{"type":28,"tag":44,"props":3596,"children":3598},{"className":3597},[],[3599],{"type":41,"value":3600},"guid=''",{"type":41,"value":3602}," is an instance of the ",{"type":28,"tag":44,"props":3604,"children":3606},{"className":3605},[],[3607],{"type":41,"value":3584},{"type":41,"value":3609}," class, defined in ",{"type":28,"tag":44,"props":3611,"children":3613},{"className":3612},[],[3614],{"type":41,"value":3615},"client/connection.ts",{"type":41,"value":3617},". All this class acts as is a wrapper around the ",{"type":28,"tag":44,"props":3619,"children":3621},{"className":3620},[],[3622],{"type":41,"value":1924},{"type":41,"value":3624},", giving every subclass of ",{"type":28,"tag":44,"props":3626,"children":3628},{"className":3627},[],[3629],{"type":41,"value":2646},{"type":41,"value":3631}," access to the ",{"type":28,"tag":44,"props":3633,"children":3635},{"className":3634},[],[3636],{"type":41,"value":1924},{"type":41,"value":3638}," to send messages over to the Playwright server.",{"type":28,"tag":1206,"props":3640,"children":3642},{"id":3641},"launching-the-browser-instance",[3643],{"type":41,"value":3644},"Launching the browser instance",{"type":28,"tag":29,"props":3646,"children":3647},{},[3648,3650,3656],{"type":41,"value":3649},"The final bit of code to consider is the ",{"type":28,"tag":44,"props":3651,"children":3653},{"className":3652},[],[3654],{"type":41,"value":3655},"_serverLauncher",{"type":41,"value":3657}," variables being set in each of the drivers. This is written as",{"type":28,"tag":119,"props":3659,"children":3661},{"className":304,"code":3660,"language":306,"meta":7,"style":7},"playwrightAPI.chromium._serverLauncher = new BrowserServerLauncherImpl('chromium');\nplaywrightAPI.firefox._serverLauncher = new BrowserServerLauncherImpl('firefox');\nplaywrightAPI.webkit._serverLauncher = new BrowserServerLauncherImpl('webkit');\n",[3662],{"type":28,"tag":44,"props":3663,"children":3664},{"__ignoreMap":7},[3665,3697,3729],{"type":28,"tag":130,"props":3666,"children":3667},{"class":132,"line":133},[3668,3673,3677,3681,3685,3689,3693],{"type":28,"tag":130,"props":3669,"children":3670},{"style":143},[3671],{"type":41,"value":3672},"playwrightAPI.chromium._serverLauncher ",{"type":28,"tag":130,"props":3674,"children":3675},{"style":153},[3676],{"type":41,"value":796},{"type":28,"tag":130,"props":3678,"children":3679},{"style":153},[3680],{"type":41,"value":466},{"type":28,"tag":130,"props":3682,"children":3683},{"style":159},[3684],{"type":41,"value":805},{"type":28,"tag":130,"props":3686,"children":3687},{"style":143},[3688],{"type":41,"value":167},{"type":28,"tag":130,"props":3690,"children":3691},{"style":170},[3692],{"type":41,"value":814},{"type":28,"tag":130,"props":3694,"children":3695},{"style":143},[3696],{"type":41,"value":178},{"type":28,"tag":130,"props":3698,"children":3699},{"class":132,"line":351},[3700,3705,3709,3713,3717,3721,3725],{"type":28,"tag":130,"props":3701,"children":3702},{"style":143},[3703],{"type":41,"value":3704},"playwrightAPI.firefox._serverLauncher ",{"type":28,"tag":130,"props":3706,"children":3707},{"style":153},[3708],{"type":41,"value":796},{"type":28,"tag":130,"props":3710,"children":3711},{"style":153},[3712],{"type":41,"value":466},{"type":28,"tag":130,"props":3714,"children":3715},{"style":159},[3716],{"type":41,"value":805},{"type":28,"tag":130,"props":3718,"children":3719},{"style":143},[3720],{"type":41,"value":167},{"type":28,"tag":130,"props":3722,"children":3723},{"style":170},[3724],{"type":41,"value":848},{"type":28,"tag":130,"props":3726,"children":3727},{"style":143},[3728],{"type":41,"value":178},{"type":28,"tag":130,"props":3730,"children":3731},{"class":132,"line":379},[3732,3737,3741,3745,3749,3753,3757],{"type":28,"tag":130,"props":3733,"children":3734},{"style":143},[3735],{"type":41,"value":3736},"playwrightAPI.webkit._serverLauncher ",{"type":28,"tag":130,"props":3738,"children":3739},{"style":153},[3740],{"type":41,"value":796},{"type":28,"tag":130,"props":3742,"children":3743},{"style":153},[3744],{"type":41,"value":466},{"type":28,"tag":130,"props":3746,"children":3747},{"style":159},[3748],{"type":41,"value":805},{"type":28,"tag":130,"props":3750,"children":3751},{"style":143},[3752],{"type":41,"value":167},{"type":28,"tag":130,"props":3754,"children":3755},{"style":170},[3756],{"type":41,"value":882},{"type":28,"tag":130,"props":3758,"children":3759},{"style":143},[3760],{"type":41,"value":178},{"type":28,"tag":29,"props":3762,"children":3763},{},[3764,3765,3771,3773,3778,3780,3786,3788,3794],{"type":41,"value":183},{"type":28,"tag":44,"props":3766,"children":3768},{"className":3767},[],[3769],{"type":41,"value":3770},"BrowserServerLauncherImpl",{"type":41,"value":3772}," class is defined next to the ",{"type":28,"tag":44,"props":3774,"children":3776},{"className":3775},[],[3777],{"type":41,"value":213},{"type":41,"value":3779}," file in ",{"type":28,"tag":44,"props":3781,"children":3783},{"className":3782},[],[3784],{"type":41,"value":3785},"browserServerLauncherImpl.ts",{"type":41,"value":3787},". The main functionality in this class lies in the ",{"type":28,"tag":44,"props":3789,"children":3791},{"className":3790},[],[3792],{"type":41,"value":3793},"launchServer",{"type":41,"value":3795}," function, and is only called when you use the",{"type":28,"tag":119,"props":3797,"children":3799},{"className":304,"code":3798,"language":306,"meta":7,"style":7},"playwrightAPI.chromium.launchServer(serverOptions)\n",[3800],{"type":28,"tag":44,"props":3801,"children":3802},{"__ignoreMap":7},[3803],{"type":28,"tag":130,"props":3804,"children":3805},{"class":132,"line":133},[3806,3811,3815],{"type":28,"tag":130,"props":3807,"children":3808},{"style":143},[3809],{"type":41,"value":3810},"playwrightAPI.chromium.",{"type":28,"tag":130,"props":3812,"children":3813},{"style":159},[3814],{"type":41,"value":3793},{"type":28,"tag":130,"props":3816,"children":3817},{"style":143},[3818],{"type":41,"value":3819},"(serverOptions)\n",{"type":28,"tag":29,"props":3821,"children":3822},{},[3823,3825,3831],{"type":41,"value":3824},"function. This is for launching a server which exposes a websocket for other programs to interact with the playwright API. This is not used if you are just writing a node script which accesses the ",{"type":28,"tag":44,"props":3826,"children":3828},{"className":3827},[],[3829],{"type":41,"value":3830},"'playwright-core'",{"type":41,"value":3832}," library, something like",{"type":28,"tag":119,"props":3834,"children":3836},{"className":304,"code":3835,"language":306,"meta":7,"style":7},"import playwright from 'playwright-core';\n\n(async function () {\n  const browser = await playwright.chromium.launch({headless: false})\n  const page = await browser.newPage()\n  await page.goto(\"https://playwright.dev\")\n  // ... automate page interactions here\n})()\n",[3837],{"type":28,"tag":44,"props":3838,"children":3839},{"__ignoreMap":7},[3840,3865,3872,3893,3939,3974,4005,4013],{"type":28,"tag":130,"props":3841,"children":3842},{"class":132,"line":133},[3843,3847,3852,3856,3861],{"type":28,"tag":130,"props":3844,"children":3845},{"style":153},[3846],{"type":41,"value":1441},{"type":28,"tag":130,"props":3848,"children":3849},{"style":143},[3850],{"type":41,"value":3851}," playwright ",{"type":28,"tag":130,"props":3853,"children":3854},{"style":153},[3855],{"type":41,"value":1451},{"type":28,"tag":130,"props":3857,"children":3858},{"style":170},[3859],{"type":41,"value":3860}," 'playwright-core'",{"type":28,"tag":130,"props":3862,"children":3863},{"style":143},[3864],{"type":41,"value":782},{"type":28,"tag":130,"props":3866,"children":3867},{"class":132,"line":351},[3868],{"type":28,"tag":130,"props":3869,"children":3870},{"emptyLinePlaceholder":441},[3871],{"type":41,"value":444},{"type":28,"tag":130,"props":3873,"children":3874},{"class":132,"line":379},[3875,3879,3884,3888],{"type":28,"tag":130,"props":3876,"children":3877},{"style":143},[3878],{"type":41,"value":167},{"type":28,"tag":130,"props":3880,"children":3881},{"style":153},[3882],{"type":41,"value":3883},"async",{"type":28,"tag":130,"props":3885,"children":3886},{"style":153},[3887],{"type":41,"value":323},{"type":28,"tag":130,"props":3889,"children":3890},{"style":143},[3891],{"type":41,"value":3892}," () {\n",{"type":28,"tag":130,"props":3894,"children":3895},{"class":132,"line":428},[3896,3900,3905,3909,3914,3919,3924,3929,3934],{"type":28,"tag":130,"props":3897,"children":3898},{"style":153},[3899],{"type":41,"value":357},{"type":28,"tag":130,"props":3901,"children":3902},{"style":137},[3903],{"type":41,"value":3904}," browser",{"type":28,"tag":130,"props":3906,"children":3907},{"style":153},[3908],{"type":41,"value":156},{"type":28,"tag":130,"props":3910,"children":3911},{"style":153},[3912],{"type":41,"value":3913}," await",{"type":28,"tag":130,"props":3915,"children":3916},{"style":143},[3917],{"type":41,"value":3918}," playwright.chromium.",{"type":28,"tag":130,"props":3920,"children":3921},{"style":159},[3922],{"type":41,"value":3923},"launch",{"type":28,"tag":130,"props":3925,"children":3926},{"style":143},[3927],{"type":41,"value":3928},"({headless: ",{"type":28,"tag":130,"props":3930,"children":3931},{"style":137},[3932],{"type":41,"value":3933},"false",{"type":28,"tag":130,"props":3935,"children":3936},{"style":143},[3937],{"type":41,"value":3938},"})\n",{"type":28,"tag":130,"props":3940,"children":3941},{"class":132,"line":437},[3942,3946,3951,3955,3959,3964,3969],{"type":28,"tag":130,"props":3943,"children":3944},{"style":153},[3945],{"type":41,"value":357},{"type":28,"tag":130,"props":3947,"children":3948},{"style":137},[3949],{"type":41,"value":3950}," page",{"type":28,"tag":130,"props":3952,"children":3953},{"style":153},[3954],{"type":41,"value":156},{"type":28,"tag":130,"props":3956,"children":3957},{"style":153},[3958],{"type":41,"value":3913},{"type":28,"tag":130,"props":3960,"children":3961},{"style":143},[3962],{"type":41,"value":3963}," browser.",{"type":28,"tag":130,"props":3965,"children":3966},{"style":159},[3967],{"type":41,"value":3968},"newPage",{"type":28,"tag":130,"props":3970,"children":3971},{"style":143},[3972],{"type":41,"value":3973},"()\n",{"type":28,"tag":130,"props":3975,"children":3976},{"class":132,"line":447},[3977,3982,3987,3992,3996,4001],{"type":28,"tag":130,"props":3978,"children":3979},{"style":153},[3980],{"type":41,"value":3981},"  await",{"type":28,"tag":130,"props":3983,"children":3984},{"style":143},[3985],{"type":41,"value":3986}," page.",{"type":28,"tag":130,"props":3988,"children":3989},{"style":159},[3990],{"type":41,"value":3991},"goto",{"type":28,"tag":130,"props":3993,"children":3994},{"style":143},[3995],{"type":41,"value":167},{"type":28,"tag":130,"props":3997,"children":3998},{"style":170},[3999],{"type":41,"value":4000},"\"https://playwright.dev\"",{"type":28,"tag":130,"props":4002,"children":4003},{"style":143},[4004],{"type":41,"value":2864},{"type":28,"tag":130,"props":4006,"children":4007},{"class":132,"line":496},[4008],{"type":28,"tag":130,"props":4009,"children":4010},{"style":550},[4011],{"type":41,"value":4012},"  // ... automate page interactions here\n",{"type":28,"tag":130,"props":4014,"children":4015},{"class":132,"line":515},[4016],{"type":28,"tag":130,"props":4017,"children":4018},{"style":143},[4019],{"type":41,"value":4020},"})()\n",{"type":28,"tag":29,"props":4022,"children":4023},{},[4024,4026,4031],{"type":41,"value":4025},"so for now we skip giving an overview of the ",{"type":28,"tag":44,"props":4027,"children":4029},{"className":4028},[],[4030],{"type":41,"value":3770},{"type":41,"value":4032}," code and defer it to a later post.",{"type":28,"tag":4034,"props":4035,"children":4036},"style",{},[4037],{"type":41,"value":4038},"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":351,"depth":351,"links":4040},[4041],{"id":287,"depth":351,"text":213,"children":4042},[4043,4044],{"id":1208,"depth":379,"text":1211},{"id":3641,"depth":379,"text":3644},"markdown","content:playwright:how-playwright-initializes.md","content","playwright/how-playwright-initializes.md","md",1710460968220]