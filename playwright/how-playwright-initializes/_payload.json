[{"data":1,"prerenderedAt":3932},["Reactive",2],{"blog-post-playwright/how-playwright-initializes":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"title":8,"description":9,"breadcrumbs":10,"image":16,"shortDescription":17,"created":18,"link":4,"body":24,"_type":3927,"_id":3928,"_source":3929,"_file":3930,"_extension":3931},"/playwright/how-playwright-initializes","playwright",false,"","How importing from Playwright works","In this post we dive into how Playwright initializes itself when you import anything from the library. If you look under the hood there is some complex machinery generating the API making it difficult for someone unfamiliar to get started with Playwright's internals.",[11,14],{"name":12,"path":13},"Playwright","/playwright",{"name":15,"path":4},"How Playwright Initializes","img","Importing from playwright is a complex process with many interacting components. Let's look under the hood to discover how playwright-core is structured.",{"string":19,"number":20,"month":21,"day":22,"year":23},"March 13, 2024",1710309600000,"Mar",13,2024,{"type":25,"children":26,"toc":3921},"root",[27,37,90,109,170,230,264,270,281,1184,1191,1241,1320,1337,1392,1397,1427,1451,1516,1549,1753,1811,1918,1954,2164,2206,2248,2265,2555,2600,2785,2803,3249,3324,3403,3471,3528,3534,3546,3649,3680,3704,3716,3904,3915],{"type":28,"tag":29,"props":30,"children":31},"element","p",{},[32],{"type":28,"tag":16,"props":33,"children":36},{"alt":34,"src":35},"Diagram of playwright-core initialization process","/img/playwright/playwright-core_initialization_diagram.jpg",[],{"type":28,"tag":29,"props":38,"children":39},{},[40,43,49,51,56,58,63,65,69,71,76,78,82,84,88],{"type":41,"value":42},"text","Whenever you import playwright, there's a lot happening under the hood because of how the project is structured. When you import from ",{"type":28,"tag":44,"props":45,"children":46},"code",{"className":7},[47],{"type":41,"value":48},"@playwright/test",{"type":41,"value":50}," this actually merges two separate packages in the playwright project. They are ",{"type":28,"tag":44,"props":52,"children":53},{"className":7},[54],{"type":41,"value":55},"packages/playwright-core",{"type":41,"value":57}," and ",{"type":28,"tag":44,"props":59,"children":60},{"className":7},[61],{"type":41,"value":62},"packages/playwright",{"type":41,"value":64},". When you import ",{"type":28,"tag":44,"props":66,"children":67},{"className":7},[68],{"type":41,"value":48},{"type":41,"value":70}," you are importing the export ",{"type":28,"tag":44,"props":72,"children":73},{"className":7},[74],{"type":41,"value":75},"require('playwright/test')",{"type":41,"value":77},", which contains the merging code. Here is where the wrapper code in ",{"type":28,"tag":44,"props":79,"children":80},{"className":7},[81],{"type":41,"value":62},{"type":41,"value":83}," is combined with the browser automation code in ",{"type":28,"tag":44,"props":85,"children":86},{"className":7},[87],{"type":41,"value":55},{"type":41,"value":89},".",{"type":28,"tag":29,"props":91,"children":92},{},[93,95,100,102,107],{"type":41,"value":94},"The import from ",{"type":28,"tag":44,"props":96,"children":97},{"className":7},[98],{"type":41,"value":99},"playwright-core",{"type":41,"value":101}," is much more complex because the export is dynamically generated from a function. Looking at the ",{"type":28,"tag":44,"props":103,"children":104},{"className":7},[105],{"type":41,"value":106},"index.js",{"type":41,"value":108}," file gives an export",{"type":28,"tag":110,"props":111,"children":116},"pre",{"className":112,"code":113,"filename":114,"language":115,"meta":7,"style":7},"language-js shiki shiki-themes github-dark","module.exports = require('./lib/inprocess');\n","packages/playwright-core/index.js","js",[117],{"type":28,"tag":44,"props":118,"children":119},{"__ignoreMap":7},[120],{"type":28,"tag":121,"props":122,"children":125},"span",{"class":123,"line":124},"line",1,[126,132,137,142,148,154,159,165],{"type":28,"tag":121,"props":127,"children":129},{"style":128},"--shiki-default:#79B8FF",[130],{"type":41,"value":131},"module",{"type":28,"tag":121,"props":133,"children":135},{"style":134},"--shiki-default:#E1E4E8",[136],{"type":41,"value":89},{"type":28,"tag":121,"props":138,"children":139},{"style":128},[140],{"type":41,"value":141},"exports",{"type":28,"tag":121,"props":143,"children":145},{"style":144},"--shiki-default:#F97583",[146],{"type":41,"value":147}," =",{"type":28,"tag":121,"props":149,"children":151},{"style":150},"--shiki-default:#B392F0",[152],{"type":41,"value":153}," require",{"type":28,"tag":121,"props":155,"children":156},{"style":134},[157],{"type":41,"value":158},"(",{"type":28,"tag":121,"props":160,"children":162},{"style":161},"--shiki-default:#9ECBFF",[163],{"type":41,"value":164},"'./lib/inprocess'",{"type":28,"tag":121,"props":166,"children":167},{"style":134},[168],{"type":41,"value":169},");\n",{"type":28,"tag":29,"props":171,"children":172},{},[173,175,180,182,187,189,194,196,201,203,208,210,214,216,221,223,228],{"type":41,"value":174},"Note the ",{"type":28,"tag":44,"props":176,"children":177},{"className":7},[178],{"type":41,"value":179},"lib",{"type":41,"value":181}," directory is just the ",{"type":28,"tag":44,"props":183,"children":184},{"className":7},[185],{"type":41,"value":186},"src",{"type":41,"value":188}," directory after playwright runs its build script, and is what's found in the npm package. The ",{"type":28,"tag":44,"props":190,"children":191},{"className":7},[192],{"type":41,"value":193},"inprocess.ts",{"type":41,"value":195}," file just imports from the adjacent ",{"type":28,"tag":44,"props":197,"children":198},{"className":7},[199],{"type":41,"value":200},"inProcessFactory.ts",{"type":41,"value":202}," and executes the function from there, called ",{"type":28,"tag":44,"props":204,"children":205},{"className":7},[206],{"type":41,"value":207},"createInProcessPlaywright",{"type":41,"value":209},". We include the source below in its own section, but note ",{"type":28,"tag":44,"props":211,"children":212},{"className":7},[213],{"type":41,"value":207},{"type":41,"value":215}," is required to be called because it dynamically intiailizes the interface between the client library, defined in ",{"type":28,"tag":44,"props":217,"children":218},{"className":7},[219],{"type":41,"value":220},"src/client",{"type":41,"value":222},", and the server library, defined in ",{"type":28,"tag":44,"props":224,"children":225},{"className":7},[226],{"type":41,"value":227},"src/server",{"type":41,"value":229},". The server library is responsible for dispatching browser automation actions over a browser automation protocol, such as the Chrome Devtools Protocol, abbreviated as CDP, while the client library gives a public API for playwright users to interact with the server library.",{"type":28,"tag":29,"props":231,"children":232},{},[233,235,244,246,250,252,256,258,262],{"type":41,"value":234},"There is the separation of logic here, between client and server, because it allows for implementations of the client library in multiple languages. For example, if you look in the ",{"type":28,"tag":236,"props":237,"children":241},"a",{"href":238,"rel":239},"https://github.com/microsoft/playwright-python",[240],"nofollow",[242],{"type":41,"value":243},"playwright-python",{"type":41,"value":245}," source code, you will find a very similar library to the ",{"type":28,"tag":44,"props":247,"children":248},{"className":7},[249],{"type":41,"value":220},{"type":41,"value":251}," library found in the ",{"type":28,"tag":44,"props":253,"children":254},{"className":7},[255],{"type":41,"value":99},{"type":41,"value":257}," package. We will mention some of the common design patterns used in the playwright client libraries which are also used in the ",{"type":28,"tag":44,"props":259,"children":260},{"className":7},[261],{"type":41,"value":99},{"type":41,"value":263}," client library below.",{"type":28,"tag":265,"props":266,"children":268},"h2",{"id":267},"inprocessfactoryts",[269],{"type":41,"value":200},{"type":28,"tag":29,"props":271,"children":272},{},[273,275,279],{"type":41,"value":274},"This file contains only one function, the ",{"type":28,"tag":44,"props":276,"children":277},{"className":7},[278],{"type":41,"value":207},{"type":41,"value":280}," function, which we include here:",{"type":28,"tag":110,"props":282,"children":286},{"className":283,"code":284,"language":285,"meta":7,"style":7},"language-ts shiki shiki-themes github-dark","export function createInProcessPlaywright(): PlaywrightAPI {\n  const playwright = createPlaywright({\n    sdkLanguage: (process.env.PW_LANG_NAME as Language | undefined) || 'javascript'\n  });\n\n  const clientConnection = new Connection(undefined, undefined);\n  clientConnection.useRawBuffers();\n  const dispatcherConnection = new DispatcherConnection(true /* local */);\n\n  // Dispatch synchronously at first.\n  dispatcherConnection.onmessage = message => clientConnection.dispatch(message);\n  clientConnection.onmessage = message => dispatcherConnection.dispatch(message);\n\n  const rootScope = new RootDispatcher(dispatcherConnection);\n\n  // Initialize Playwright channel.\n  new PlaywrightDispatcher(rootScope, playwright);\n  const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright') as PlaywrightAPI;\n  playwrightAPI.chromium._serverLauncher = new BrowserServerLauncherImpl('chromium');\n  playwrightAPI.firefox._serverLauncher = new BrowserServerLauncherImpl('firefox');\n  playwrightAPI.webkit._serverLauncher = new BrowserServerLauncherImpl('webkit');\n  playwrightAPI._android._serverLauncher = new AndroidServerLauncherImpl();\n\n  // Switch to async dispatch after we got Playwright object.\n  dispatcherConnection.onmessage = message => setImmediate(() => clientConnection.dispatch(message));\n  clientConnection.onmessage = message => setImmediate(() => dispatcherConnection.dispatch(message));\n\n  clientConnection.toImpl = (x: any) => x\n    ? dispatcherConnection._dispatchers.get(x._guid)!._object\n    : dispatcherConnection._dispatchers.get('');\n  (playwrightAPI as any)._toImpl = clientConnection.toImpl;\n  return playwrightAPI;\n}\n","ts",[287],{"type":28,"tag":44,"props":288,"children":289},{"__ignoreMap":7},[290,328,356,405,414,424,473,492,537,545,554,598,635,642,673,681,690,709,762,798,832,866,892,900,909,961,1009,1017,1066,1100,1130,1161,1175],{"type":28,"tag":121,"props":291,"children":292},{"class":123,"line":124},[293,298,303,308,313,318,323],{"type":28,"tag":121,"props":294,"children":295},{"style":144},[296],{"type":41,"value":297},"export",{"type":28,"tag":121,"props":299,"children":300},{"style":144},[301],{"type":41,"value":302}," function",{"type":28,"tag":121,"props":304,"children":305},{"style":150},[306],{"type":41,"value":307}," createInProcessPlaywright",{"type":28,"tag":121,"props":309,"children":310},{"style":134},[311],{"type":41,"value":312},"()",{"type":28,"tag":121,"props":314,"children":315},{"style":144},[316],{"type":41,"value":317},":",{"type":28,"tag":121,"props":319,"children":320},{"style":150},[321],{"type":41,"value":322}," PlaywrightAPI",{"type":28,"tag":121,"props":324,"children":325},{"style":134},[326],{"type":41,"value":327}," {\n",{"type":28,"tag":121,"props":329,"children":331},{"class":123,"line":330},2,[332,337,342,346,351],{"type":28,"tag":121,"props":333,"children":334},{"style":144},[335],{"type":41,"value":336},"  const",{"type":28,"tag":121,"props":338,"children":339},{"style":128},[340],{"type":41,"value":341}," playwright",{"type":28,"tag":121,"props":343,"children":344},{"style":144},[345],{"type":41,"value":147},{"type":28,"tag":121,"props":347,"children":348},{"style":150},[349],{"type":41,"value":350}," createPlaywright",{"type":28,"tag":121,"props":352,"children":353},{"style":134},[354],{"type":41,"value":355},"({\n",{"type":28,"tag":121,"props":357,"children":359},{"class":123,"line":358},3,[360,365,370,375,380,385,390,395,400],{"type":28,"tag":121,"props":361,"children":362},{"style":134},[363],{"type":41,"value":364},"    sdkLanguage: (process.env.",{"type":28,"tag":121,"props":366,"children":367},{"style":128},[368],{"type":41,"value":369},"PW_LANG_NAME",{"type":28,"tag":121,"props":371,"children":372},{"style":144},[373],{"type":41,"value":374}," as",{"type":28,"tag":121,"props":376,"children":377},{"style":150},[378],{"type":41,"value":379}," Language",{"type":28,"tag":121,"props":381,"children":382},{"style":144},[383],{"type":41,"value":384}," |",{"type":28,"tag":121,"props":386,"children":387},{"style":128},[388],{"type":41,"value":389}," undefined",{"type":28,"tag":121,"props":391,"children":392},{"style":134},[393],{"type":41,"value":394},") ",{"type":28,"tag":121,"props":396,"children":397},{"style":144},[398],{"type":41,"value":399},"||",{"type":28,"tag":121,"props":401,"children":402},{"style":161},[403],{"type":41,"value":404}," 'javascript'\n",{"type":28,"tag":121,"props":406,"children":408},{"class":123,"line":407},4,[409],{"type":28,"tag":121,"props":410,"children":411},{"style":134},[412],{"type":41,"value":413},"  });\n",{"type":28,"tag":121,"props":415,"children":417},{"class":123,"line":416},5,[418],{"type":28,"tag":121,"props":419,"children":421},{"emptyLinePlaceholder":420},true,[422],{"type":41,"value":423},"\n",{"type":28,"tag":121,"props":425,"children":427},{"class":123,"line":426},6,[428,432,437,441,446,451,455,460,465,469],{"type":28,"tag":121,"props":429,"children":430},{"style":144},[431],{"type":41,"value":336},{"type":28,"tag":121,"props":433,"children":434},{"style":128},[435],{"type":41,"value":436}," clientConnection",{"type":28,"tag":121,"props":438,"children":439},{"style":144},[440],{"type":41,"value":147},{"type":28,"tag":121,"props":442,"children":443},{"style":144},[444],{"type":41,"value":445}," new",{"type":28,"tag":121,"props":447,"children":448},{"style":150},[449],{"type":41,"value":450}," Connection",{"type":28,"tag":121,"props":452,"children":453},{"style":134},[454],{"type":41,"value":158},{"type":28,"tag":121,"props":456,"children":457},{"style":128},[458],{"type":41,"value":459},"undefined",{"type":28,"tag":121,"props":461,"children":462},{"style":134},[463],{"type":41,"value":464},", ",{"type":28,"tag":121,"props":466,"children":467},{"style":128},[468],{"type":41,"value":459},{"type":28,"tag":121,"props":470,"children":471},{"style":134},[472],{"type":41,"value":169},{"type":28,"tag":121,"props":474,"children":476},{"class":123,"line":475},7,[477,482,487],{"type":28,"tag":121,"props":478,"children":479},{"style":134},[480],{"type":41,"value":481},"  clientConnection.",{"type":28,"tag":121,"props":483,"children":484},{"style":150},[485],{"type":41,"value":486},"useRawBuffers",{"type":28,"tag":121,"props":488,"children":489},{"style":134},[490],{"type":41,"value":491},"();\n",{"type":28,"tag":121,"props":493,"children":495},{"class":123,"line":494},8,[496,500,505,509,513,518,522,527,533],{"type":28,"tag":121,"props":497,"children":498},{"style":144},[499],{"type":41,"value":336},{"type":28,"tag":121,"props":501,"children":502},{"style":128},[503],{"type":41,"value":504}," dispatcherConnection",{"type":28,"tag":121,"props":506,"children":507},{"style":144},[508],{"type":41,"value":147},{"type":28,"tag":121,"props":510,"children":511},{"style":144},[512],{"type":41,"value":445},{"type":28,"tag":121,"props":514,"children":515},{"style":150},[516],{"type":41,"value":517}," DispatcherConnection",{"type":28,"tag":121,"props":519,"children":520},{"style":134},[521],{"type":41,"value":158},{"type":28,"tag":121,"props":523,"children":524},{"style":128},[525],{"type":41,"value":526},"true",{"type":28,"tag":121,"props":528,"children":530},{"style":529},"--shiki-default:#6A737D",[531],{"type":41,"value":532}," /* local */",{"type":28,"tag":121,"props":534,"children":535},{"style":134},[536],{"type":41,"value":169},{"type":28,"tag":121,"props":538,"children":540},{"class":123,"line":539},9,[541],{"type":28,"tag":121,"props":542,"children":543},{"emptyLinePlaceholder":420},[544],{"type":41,"value":423},{"type":28,"tag":121,"props":546,"children":548},{"class":123,"line":547},10,[549],{"type":28,"tag":121,"props":550,"children":551},{"style":529},[552],{"type":41,"value":553},"  // Dispatch synchronously at first.\n",{"type":28,"tag":121,"props":555,"children":557},{"class":123,"line":556},11,[558,563,568,572,578,583,588,593],{"type":28,"tag":121,"props":559,"children":560},{"style":134},[561],{"type":41,"value":562},"  dispatcherConnection.",{"type":28,"tag":121,"props":564,"children":565},{"style":150},[566],{"type":41,"value":567},"onmessage",{"type":28,"tag":121,"props":569,"children":570},{"style":144},[571],{"type":41,"value":147},{"type":28,"tag":121,"props":573,"children":575},{"style":574},"--shiki-default:#FFAB70",[576],{"type":41,"value":577}," message",{"type":28,"tag":121,"props":579,"children":580},{"style":144},[581],{"type":41,"value":582}," =>",{"type":28,"tag":121,"props":584,"children":585},{"style":134},[586],{"type":41,"value":587}," clientConnection.",{"type":28,"tag":121,"props":589,"children":590},{"style":150},[591],{"type":41,"value":592},"dispatch",{"type":28,"tag":121,"props":594,"children":595},{"style":134},[596],{"type":41,"value":597},"(message);\n",{"type":28,"tag":121,"props":599,"children":601},{"class":123,"line":600},12,[602,606,610,614,618,622,627,631],{"type":28,"tag":121,"props":603,"children":604},{"style":134},[605],{"type":41,"value":481},{"type":28,"tag":121,"props":607,"children":608},{"style":150},[609],{"type":41,"value":567},{"type":28,"tag":121,"props":611,"children":612},{"style":144},[613],{"type":41,"value":147},{"type":28,"tag":121,"props":615,"children":616},{"style":574},[617],{"type":41,"value":577},{"type":28,"tag":121,"props":619,"children":620},{"style":144},[621],{"type":41,"value":582},{"type":28,"tag":121,"props":623,"children":624},{"style":134},[625],{"type":41,"value":626}," dispatcherConnection.",{"type":28,"tag":121,"props":628,"children":629},{"style":150},[630],{"type":41,"value":592},{"type":28,"tag":121,"props":632,"children":633},{"style":134},[634],{"type":41,"value":597},{"type":28,"tag":121,"props":636,"children":637},{"class":123,"line":22},[638],{"type":28,"tag":121,"props":639,"children":640},{"emptyLinePlaceholder":420},[641],{"type":41,"value":423},{"type":28,"tag":121,"props":643,"children":645},{"class":123,"line":644},14,[646,650,655,659,663,668],{"type":28,"tag":121,"props":647,"children":648},{"style":144},[649],{"type":41,"value":336},{"type":28,"tag":121,"props":651,"children":652},{"style":128},[653],{"type":41,"value":654}," rootScope",{"type":28,"tag":121,"props":656,"children":657},{"style":144},[658],{"type":41,"value":147},{"type":28,"tag":121,"props":660,"children":661},{"style":144},[662],{"type":41,"value":445},{"type":28,"tag":121,"props":664,"children":665},{"style":150},[666],{"type":41,"value":667}," RootDispatcher",{"type":28,"tag":121,"props":669,"children":670},{"style":134},[671],{"type":41,"value":672},"(dispatcherConnection);\n",{"type":28,"tag":121,"props":674,"children":676},{"class":123,"line":675},15,[677],{"type":28,"tag":121,"props":678,"children":679},{"emptyLinePlaceholder":420},[680],{"type":41,"value":423},{"type":28,"tag":121,"props":682,"children":684},{"class":123,"line":683},16,[685],{"type":28,"tag":121,"props":686,"children":687},{"style":529},[688],{"type":41,"value":689},"  // Initialize Playwright channel.\n",{"type":28,"tag":121,"props":691,"children":693},{"class":123,"line":692},17,[694,699,704],{"type":28,"tag":121,"props":695,"children":696},{"style":144},[697],{"type":41,"value":698},"  new",{"type":28,"tag":121,"props":700,"children":701},{"style":150},[702],{"type":41,"value":703}," PlaywrightDispatcher",{"type":28,"tag":121,"props":705,"children":706},{"style":134},[707],{"type":41,"value":708},"(rootScope, playwright);\n",{"type":28,"tag":121,"props":710,"children":712},{"class":123,"line":711},18,[713,717,722,726,730,735,739,744,748,753,757],{"type":28,"tag":121,"props":714,"children":715},{"style":144},[716],{"type":41,"value":336},{"type":28,"tag":121,"props":718,"children":719},{"style":128},[720],{"type":41,"value":721}," playwrightAPI",{"type":28,"tag":121,"props":723,"children":724},{"style":144},[725],{"type":41,"value":147},{"type":28,"tag":121,"props":727,"children":728},{"style":134},[729],{"type":41,"value":587},{"type":28,"tag":121,"props":731,"children":732},{"style":150},[733],{"type":41,"value":734},"getObjectWithKnownName",{"type":28,"tag":121,"props":736,"children":737},{"style":134},[738],{"type":41,"value":158},{"type":28,"tag":121,"props":740,"children":741},{"style":161},[742],{"type":41,"value":743},"'Playwright'",{"type":28,"tag":121,"props":745,"children":746},{"style":134},[747],{"type":41,"value":394},{"type":28,"tag":121,"props":749,"children":750},{"style":144},[751],{"type":41,"value":752},"as",{"type":28,"tag":121,"props":754,"children":755},{"style":150},[756],{"type":41,"value":322},{"type":28,"tag":121,"props":758,"children":759},{"style":134},[760],{"type":41,"value":761},";\n",{"type":28,"tag":121,"props":763,"children":765},{"class":123,"line":764},19,[766,771,776,780,785,789,794],{"type":28,"tag":121,"props":767,"children":768},{"style":134},[769],{"type":41,"value":770},"  playwrightAPI.chromium._serverLauncher ",{"type":28,"tag":121,"props":772,"children":773},{"style":144},[774],{"type":41,"value":775},"=",{"type":28,"tag":121,"props":777,"children":778},{"style":144},[779],{"type":41,"value":445},{"type":28,"tag":121,"props":781,"children":782},{"style":150},[783],{"type":41,"value":784}," BrowserServerLauncherImpl",{"type":28,"tag":121,"props":786,"children":787},{"style":134},[788],{"type":41,"value":158},{"type":28,"tag":121,"props":790,"children":791},{"style":161},[792],{"type":41,"value":793},"'chromium'",{"type":28,"tag":121,"props":795,"children":796},{"style":134},[797],{"type":41,"value":169},{"type":28,"tag":121,"props":799,"children":801},{"class":123,"line":800},20,[802,807,811,815,819,823,828],{"type":28,"tag":121,"props":803,"children":804},{"style":134},[805],{"type":41,"value":806},"  playwrightAPI.firefox._serverLauncher ",{"type":28,"tag":121,"props":808,"children":809},{"style":144},[810],{"type":41,"value":775},{"type":28,"tag":121,"props":812,"children":813},{"style":144},[814],{"type":41,"value":445},{"type":28,"tag":121,"props":816,"children":817},{"style":150},[818],{"type":41,"value":784},{"type":28,"tag":121,"props":820,"children":821},{"style":134},[822],{"type":41,"value":158},{"type":28,"tag":121,"props":824,"children":825},{"style":161},[826],{"type":41,"value":827},"'firefox'",{"type":28,"tag":121,"props":829,"children":830},{"style":134},[831],{"type":41,"value":169},{"type":28,"tag":121,"props":833,"children":835},{"class":123,"line":834},21,[836,841,845,849,853,857,862],{"type":28,"tag":121,"props":837,"children":838},{"style":134},[839],{"type":41,"value":840},"  playwrightAPI.webkit._serverLauncher ",{"type":28,"tag":121,"props":842,"children":843},{"style":144},[844],{"type":41,"value":775},{"type":28,"tag":121,"props":846,"children":847},{"style":144},[848],{"type":41,"value":445},{"type":28,"tag":121,"props":850,"children":851},{"style":150},[852],{"type":41,"value":784},{"type":28,"tag":121,"props":854,"children":855},{"style":134},[856],{"type":41,"value":158},{"type":28,"tag":121,"props":858,"children":859},{"style":161},[860],{"type":41,"value":861},"'webkit'",{"type":28,"tag":121,"props":863,"children":864},{"style":134},[865],{"type":41,"value":169},{"type":28,"tag":121,"props":867,"children":869},{"class":123,"line":868},22,[870,875,879,883,888],{"type":28,"tag":121,"props":871,"children":872},{"style":134},[873],{"type":41,"value":874},"  playwrightAPI._android._serverLauncher ",{"type":28,"tag":121,"props":876,"children":877},{"style":144},[878],{"type":41,"value":775},{"type":28,"tag":121,"props":880,"children":881},{"style":144},[882],{"type":41,"value":445},{"type":28,"tag":121,"props":884,"children":885},{"style":150},[886],{"type":41,"value":887}," AndroidServerLauncherImpl",{"type":28,"tag":121,"props":889,"children":890},{"style":134},[891],{"type":41,"value":491},{"type":28,"tag":121,"props":893,"children":895},{"class":123,"line":894},23,[896],{"type":28,"tag":121,"props":897,"children":898},{"emptyLinePlaceholder":420},[899],{"type":41,"value":423},{"type":28,"tag":121,"props":901,"children":903},{"class":123,"line":902},24,[904],{"type":28,"tag":121,"props":905,"children":906},{"style":529},[907],{"type":41,"value":908},"  // Switch to async dispatch after we got Playwright object.\n",{"type":28,"tag":121,"props":910,"children":912},{"class":123,"line":911},25,[913,917,921,925,929,933,938,943,948,952,956],{"type":28,"tag":121,"props":914,"children":915},{"style":134},[916],{"type":41,"value":562},{"type":28,"tag":121,"props":918,"children":919},{"style":150},[920],{"type":41,"value":567},{"type":28,"tag":121,"props":922,"children":923},{"style":144},[924],{"type":41,"value":147},{"type":28,"tag":121,"props":926,"children":927},{"style":574},[928],{"type":41,"value":577},{"type":28,"tag":121,"props":930,"children":931},{"style":144},[932],{"type":41,"value":582},{"type":28,"tag":121,"props":934,"children":935},{"style":150},[936],{"type":41,"value":937}," setImmediate",{"type":28,"tag":121,"props":939,"children":940},{"style":134},[941],{"type":41,"value":942},"(() ",{"type":28,"tag":121,"props":944,"children":945},{"style":144},[946],{"type":41,"value":947},"=>",{"type":28,"tag":121,"props":949,"children":950},{"style":134},[951],{"type":41,"value":587},{"type":28,"tag":121,"props":953,"children":954},{"style":150},[955],{"type":41,"value":592},{"type":28,"tag":121,"props":957,"children":958},{"style":134},[959],{"type":41,"value":960},"(message));\n",{"type":28,"tag":121,"props":962,"children":964},{"class":123,"line":963},26,[965,969,973,977,981,985,989,993,997,1001,1005],{"type":28,"tag":121,"props":966,"children":967},{"style":134},[968],{"type":41,"value":481},{"type":28,"tag":121,"props":970,"children":971},{"style":150},[972],{"type":41,"value":567},{"type":28,"tag":121,"props":974,"children":975},{"style":144},[976],{"type":41,"value":147},{"type":28,"tag":121,"props":978,"children":979},{"style":574},[980],{"type":41,"value":577},{"type":28,"tag":121,"props":982,"children":983},{"style":144},[984],{"type":41,"value":582},{"type":28,"tag":121,"props":986,"children":987},{"style":150},[988],{"type":41,"value":937},{"type":28,"tag":121,"props":990,"children":991},{"style":134},[992],{"type":41,"value":942},{"type":28,"tag":121,"props":994,"children":995},{"style":144},[996],{"type":41,"value":947},{"type":28,"tag":121,"props":998,"children":999},{"style":134},[1000],{"type":41,"value":626},{"type":28,"tag":121,"props":1002,"children":1003},{"style":150},[1004],{"type":41,"value":592},{"type":28,"tag":121,"props":1006,"children":1007},{"style":134},[1008],{"type":41,"value":960},{"type":28,"tag":121,"props":1010,"children":1012},{"class":123,"line":1011},27,[1013],{"type":28,"tag":121,"props":1014,"children":1015},{"emptyLinePlaceholder":420},[1016],{"type":41,"value":423},{"type":28,"tag":121,"props":1018,"children":1020},{"class":123,"line":1019},28,[1021,1025,1030,1034,1039,1044,1048,1053,1057,1061],{"type":28,"tag":121,"props":1022,"children":1023},{"style":134},[1024],{"type":41,"value":481},{"type":28,"tag":121,"props":1026,"children":1027},{"style":150},[1028],{"type":41,"value":1029},"toImpl",{"type":28,"tag":121,"props":1031,"children":1032},{"style":144},[1033],{"type":41,"value":147},{"type":28,"tag":121,"props":1035,"children":1036},{"style":134},[1037],{"type":41,"value":1038}," (",{"type":28,"tag":121,"props":1040,"children":1041},{"style":574},[1042],{"type":41,"value":1043},"x",{"type":28,"tag":121,"props":1045,"children":1046},{"style":144},[1047],{"type":41,"value":317},{"type":28,"tag":121,"props":1049,"children":1050},{"style":128},[1051],{"type":41,"value":1052}," any",{"type":28,"tag":121,"props":1054,"children":1055},{"style":134},[1056],{"type":41,"value":394},{"type":28,"tag":121,"props":1058,"children":1059},{"style":144},[1060],{"type":41,"value":947},{"type":28,"tag":121,"props":1062,"children":1063},{"style":134},[1064],{"type":41,"value":1065}," x\n",{"type":28,"tag":121,"props":1067,"children":1069},{"class":123,"line":1068},29,[1070,1075,1080,1085,1090,1095],{"type":28,"tag":121,"props":1071,"children":1072},{"style":144},[1073],{"type":41,"value":1074},"    ?",{"type":28,"tag":121,"props":1076,"children":1077},{"style":134},[1078],{"type":41,"value":1079}," dispatcherConnection._dispatchers.",{"type":28,"tag":121,"props":1081,"children":1082},{"style":150},[1083],{"type":41,"value":1084},"get",{"type":28,"tag":121,"props":1086,"children":1087},{"style":134},[1088],{"type":41,"value":1089},"(x._guid)",{"type":28,"tag":121,"props":1091,"children":1092},{"style":144},[1093],{"type":41,"value":1094},"!",{"type":28,"tag":121,"props":1096,"children":1097},{"style":134},[1098],{"type":41,"value":1099},"._object\n",{"type":28,"tag":121,"props":1101,"children":1103},{"class":123,"line":1102},30,[1104,1109,1113,1117,1121,1126],{"type":28,"tag":121,"props":1105,"children":1106},{"style":144},[1107],{"type":41,"value":1108},"    :",{"type":28,"tag":121,"props":1110,"children":1111},{"style":134},[1112],{"type":41,"value":1079},{"type":28,"tag":121,"props":1114,"children":1115},{"style":150},[1116],{"type":41,"value":1084},{"type":28,"tag":121,"props":1118,"children":1119},{"style":134},[1120],{"type":41,"value":158},{"type":28,"tag":121,"props":1122,"children":1123},{"style":161},[1124],{"type":41,"value":1125},"''",{"type":28,"tag":121,"props":1127,"children":1128},{"style":134},[1129],{"type":41,"value":169},{"type":28,"tag":121,"props":1131,"children":1133},{"class":123,"line":1132},31,[1134,1139,1143,1147,1152,1156],{"type":28,"tag":121,"props":1135,"children":1136},{"style":134},[1137],{"type":41,"value":1138},"  (playwrightAPI ",{"type":28,"tag":121,"props":1140,"children":1141},{"style":144},[1142],{"type":41,"value":752},{"type":28,"tag":121,"props":1144,"children":1145},{"style":128},[1146],{"type":41,"value":1052},{"type":28,"tag":121,"props":1148,"children":1149},{"style":134},[1150],{"type":41,"value":1151},")._toImpl ",{"type":28,"tag":121,"props":1153,"children":1154},{"style":144},[1155],{"type":41,"value":775},{"type":28,"tag":121,"props":1157,"children":1158},{"style":134},[1159],{"type":41,"value":1160}," clientConnection.toImpl;\n",{"type":28,"tag":121,"props":1162,"children":1164},{"class":123,"line":1163},32,[1165,1170],{"type":28,"tag":121,"props":1166,"children":1167},{"style":144},[1168],{"type":41,"value":1169},"  return",{"type":28,"tag":121,"props":1171,"children":1172},{"style":134},[1173],{"type":41,"value":1174}," playwrightAPI;\n",{"type":28,"tag":121,"props":1176,"children":1178},{"class":123,"line":1177},33,[1179],{"type":28,"tag":121,"props":1180,"children":1181},{"style":134},[1182],{"type":41,"value":1183},"}\n",{"type":28,"tag":1185,"props":1186,"children":1188},"h3",{"id":1187},"cross-communication-between-client-and-server",[1189],{"type":41,"value":1190},"Cross communication between client and server",{"type":28,"tag":29,"props":1192,"children":1193},{},[1194,1196,1201,1203,1208,1210,1214,1216,1221,1222,1227,1229,1233,1235,1239],{"type":41,"value":1195},"If you scan through the script, noting the imports for anything with ",{"type":28,"tag":44,"props":1197,"children":1198},{"className":7},[1199],{"type":41,"value":1200},"Dispatcher",{"type":41,"value":1202}," in its name, and ",{"type":28,"tag":44,"props":1204,"children":1205},{"className":7},[1206],{"type":41,"value":1207},"createPlaywright",{"type":41,"value":1209},", comes from the ",{"type":28,"tag":44,"props":1211,"children":1212},{"className":7},[1213],{"type":41,"value":227},{"type":41,"value":1215}," directory, but the imports for ",{"type":28,"tag":44,"props":1217,"children":1218},{"className":7},[1219],{"type":41,"value":1220},"Connection",{"type":41,"value":57},{"type":28,"tag":44,"props":1223,"children":1224},{"className":7},[1225],{"type":41,"value":1226},"PlaywrightAPI",{"type":41,"value":1228}," come from the ",{"type":28,"tag":44,"props":1230,"children":1231},{"className":7},[1232],{"type":41,"value":220},{"type":41,"value":1234}," directory, you'll find there's cross-communication between these two packages. The interface between these two parts of the core library is through the ",{"type":28,"tag":44,"props":1236,"children":1237},{"className":7},[1238],{"type":41,"value":567},{"type":41,"value":1240}," property for each connection, set as",{"type":28,"tag":110,"props":1242,"children":1244},{"className":283,"code":1243,"language":285,"meta":7,"style":7},"dispatcherConnection.onmessage = message => clientConnection.dispatch(message);\nclientConnection.onmessage = message => dispatcherConnection.dispatch(message);\n",[1245],{"type":28,"tag":44,"props":1246,"children":1247},{"__ignoreMap":7},[1248,1284],{"type":28,"tag":121,"props":1249,"children":1250},{"class":123,"line":124},[1251,1256,1260,1264,1268,1272,1276,1280],{"type":28,"tag":121,"props":1252,"children":1253},{"style":134},[1254],{"type":41,"value":1255},"dispatcherConnection.",{"type":28,"tag":121,"props":1257,"children":1258},{"style":150},[1259],{"type":41,"value":567},{"type":28,"tag":121,"props":1261,"children":1262},{"style":144},[1263],{"type":41,"value":147},{"type":28,"tag":121,"props":1265,"children":1266},{"style":574},[1267],{"type":41,"value":577},{"type":28,"tag":121,"props":1269,"children":1270},{"style":144},[1271],{"type":41,"value":582},{"type":28,"tag":121,"props":1273,"children":1274},{"style":134},[1275],{"type":41,"value":587},{"type":28,"tag":121,"props":1277,"children":1278},{"style":150},[1279],{"type":41,"value":592},{"type":28,"tag":121,"props":1281,"children":1282},{"style":134},[1283],{"type":41,"value":597},{"type":28,"tag":121,"props":1285,"children":1286},{"class":123,"line":330},[1287,1292,1296,1300,1304,1308,1312,1316],{"type":28,"tag":121,"props":1288,"children":1289},{"style":134},[1290],{"type":41,"value":1291},"clientConnection.",{"type":28,"tag":121,"props":1293,"children":1294},{"style":150},[1295],{"type":41,"value":567},{"type":28,"tag":121,"props":1297,"children":1298},{"style":144},[1299],{"type":41,"value":147},{"type":28,"tag":121,"props":1301,"children":1302},{"style":574},[1303],{"type":41,"value":577},{"type":28,"tag":121,"props":1305,"children":1306},{"style":144},[1307],{"type":41,"value":582},{"type":28,"tag":121,"props":1309,"children":1310},{"style":134},[1311],{"type":41,"value":626},{"type":28,"tag":121,"props":1313,"children":1314},{"style":150},[1315],{"type":41,"value":592},{"type":28,"tag":121,"props":1317,"children":1318},{"style":134},[1319],{"type":41,"value":597},{"type":28,"tag":29,"props":1321,"children":1322},{},[1323,1325,1329,1331,1336],{"type":41,"value":1324},"Also, the ",{"type":28,"tag":44,"props":1326,"children":1327},{"className":7},[1328],{"type":41,"value":1226},{"type":41,"value":1330}," instance is creating dynamically from the ",{"type":28,"tag":44,"props":1332,"children":1333},{"className":7},[1334],{"type":41,"value":1335},"clientConection",{"type":41,"value":374},{"type":28,"tag":110,"props":1338,"children":1340},{"className":283,"code":1339,"language":285,"meta":7,"style":7},"const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright') as PlaywrightAPI;\n",[1341],{"type":28,"tag":44,"props":1342,"children":1343},{"__ignoreMap":7},[1344],{"type":28,"tag":121,"props":1345,"children":1346},{"class":123,"line":124},[1347,1352,1356,1360,1364,1368,1372,1376,1380,1384,1388],{"type":28,"tag":121,"props":1348,"children":1349},{"style":144},[1350],{"type":41,"value":1351},"const",{"type":28,"tag":121,"props":1353,"children":1354},{"style":128},[1355],{"type":41,"value":721},{"type":28,"tag":121,"props":1357,"children":1358},{"style":144},[1359],{"type":41,"value":147},{"type":28,"tag":121,"props":1361,"children":1362},{"style":134},[1363],{"type":41,"value":587},{"type":28,"tag":121,"props":1365,"children":1366},{"style":150},[1367],{"type":41,"value":734},{"type":28,"tag":121,"props":1369,"children":1370},{"style":134},[1371],{"type":41,"value":158},{"type":28,"tag":121,"props":1373,"children":1374},{"style":161},[1375],{"type":41,"value":743},{"type":28,"tag":121,"props":1377,"children":1378},{"style":134},[1379],{"type":41,"value":394},{"type":28,"tag":121,"props":1381,"children":1382},{"style":144},[1383],{"type":41,"value":752},{"type":28,"tag":121,"props":1385,"children":1386},{"style":150},[1387],{"type":41,"value":322},{"type":28,"tag":121,"props":1389,"children":1390},{"style":134},[1391],{"type":41,"value":761},{"type":28,"tag":29,"props":1393,"children":1394},{},[1395],{"type":41,"value":1396},"which is the client API you will use if importing a browser, e.g.",{"type":28,"tag":110,"props":1398,"children":1400},{"className":283,"code":1399,"language":285,"meta":7,"style":7},"import { chromium } from 'playwright-core'\n",[1401],{"type":28,"tag":44,"props":1402,"children":1403},{"__ignoreMap":7},[1404],{"type":28,"tag":121,"props":1405,"children":1406},{"class":123,"line":124},[1407,1412,1417,1422],{"type":28,"tag":121,"props":1408,"children":1409},{"style":144},[1410],{"type":41,"value":1411},"import",{"type":28,"tag":121,"props":1413,"children":1414},{"style":134},[1415],{"type":41,"value":1416}," { chromium } ",{"type":28,"tag":121,"props":1418,"children":1419},{"style":144},[1420],{"type":41,"value":1421},"from",{"type":28,"tag":121,"props":1423,"children":1424},{"style":161},[1425],{"type":41,"value":1426}," 'playwright-core'\n",{"type":28,"tag":29,"props":1428,"children":1429},{},[1430,1432,1437,1439,1443,1445,1450],{"type":41,"value":1431},"so on first site is not clear what kind of code execution is actually happening here since you might expect to just be importing from the ",{"type":28,"tag":44,"props":1433,"children":1434},{"className":7},[1435],{"type":41,"value":1436},"client",{"type":41,"value":1438}," library in ",{"type":28,"tag":44,"props":1440,"children":1441},{"className":7},[1442],{"type":41,"value":99},{"type":41,"value":1444},". This mystery is answered by tracing the logic of the two lines of code between the onmessage variables being set, and the creation of the ",{"type":28,"tag":44,"props":1446,"children":1447},{"className":7},[1448],{"type":41,"value":1449},"playwrightAPI",{"type":41,"value":317},{"type":28,"tag":110,"props":1452,"children":1454},{"className":283,"code":1453,"language":285,"meta":7,"style":7},"const rootScope = new RootDispatcher(dispatcherConnection);\n\n// Initialize Playwright channel.\nnew PlaywrightDispatcher(rootScope, playwright);\n",[1455],{"type":28,"tag":44,"props":1456,"children":1457},{"__ignoreMap":7},[1458,1485,1492,1500],{"type":28,"tag":121,"props":1459,"children":1460},{"class":123,"line":124},[1461,1465,1469,1473,1477,1481],{"type":28,"tag":121,"props":1462,"children":1463},{"style":144},[1464],{"type":41,"value":1351},{"type":28,"tag":121,"props":1466,"children":1467},{"style":128},[1468],{"type":41,"value":654},{"type":28,"tag":121,"props":1470,"children":1471},{"style":144},[1472],{"type":41,"value":147},{"type":28,"tag":121,"props":1474,"children":1475},{"style":144},[1476],{"type":41,"value":445},{"type":28,"tag":121,"props":1478,"children":1479},{"style":150},[1480],{"type":41,"value":667},{"type":28,"tag":121,"props":1482,"children":1483},{"style":134},[1484],{"type":41,"value":672},{"type":28,"tag":121,"props":1486,"children":1487},{"class":123,"line":330},[1488],{"type":28,"tag":121,"props":1489,"children":1490},{"emptyLinePlaceholder":420},[1491],{"type":41,"value":423},{"type":28,"tag":121,"props":1493,"children":1494},{"class":123,"line":358},[1495],{"type":28,"tag":121,"props":1496,"children":1497},{"style":529},[1498],{"type":41,"value":1499},"// Initialize Playwright channel.\n",{"type":28,"tag":121,"props":1501,"children":1502},{"class":123,"line":407},[1503,1508,1512],{"type":28,"tag":121,"props":1504,"children":1505},{"style":144},[1506],{"type":41,"value":1507},"new",{"type":28,"tag":121,"props":1509,"children":1510},{"style":150},[1511],{"type":41,"value":703},{"type":28,"tag":121,"props":1513,"children":1514},{"style":134},[1515],{"type":41,"value":708},{"type":28,"tag":29,"props":1517,"children":1518},{},[1519,1521,1526,1528,1533,1535,1540,1542,1547],{"type":41,"value":1520},"Here the rootScope acts as a wrapper around the dispatcherConnection which every subsequent dispatcher uses under the hood. This is because the ",{"type":28,"tag":44,"props":1522,"children":1523},{"className":7},[1524],{"type":41,"value":1525},"PlaywrightDispatcher",{"type":41,"value":1527}," passes in the ",{"type":28,"tag":44,"props":1529,"children":1530},{"className":7},[1531],{"type":41,"value":1532},"rootScope",{"type":41,"value":1534}," as ",{"type":28,"tag":44,"props":1536,"children":1537},{"className":7},[1538],{"type":41,"value":1539},"scope",{"type":41,"value":1541}," in its constructor when calling ",{"type":28,"tag":44,"props":1543,"children":1544},{"className":7},[1545],{"type":41,"value":1546},"super",{"type":41,"value":1548},". Here I include a simplified version of the constructor:",{"type":28,"tag":110,"props":1550,"children":1552},{"className":283,"code":1551,"language":285,"meta":7,"style":7},"// server/dispatchers/playwrightDispatcher.ts\nconstructor(scope: RootDispatcher, playwright: Playwright) {\n  const android = new AndroidDispatcher(scope, playwright.android);\n  // parameter names in the base Dispatcher class are\n  // parent, object, type, initializer\n  super(scope, playwright, 'Playwright', {\n    chromium: new BrowserTypeDispatcher(scope, playwright.chromium),\n    firefox: new BrowserTypeDispatcher(scope, playwright.firefox),\n    webkit: new BrowserTypeDispatcher(scope, playwright.webkit),\n    android,\n    electron: new ElectronDispatcher(scope, playwright.electron),\n  });\n}\n",[1553],{"type":28,"tag":44,"props":1554,"children":1555},{"__ignoreMap":7},[1556,1564,1577,1607,1615,1623,1645,1667,1688,1709,1717,1739,1746],{"type":28,"tag":121,"props":1557,"children":1558},{"class":123,"line":124},[1559],{"type":28,"tag":121,"props":1560,"children":1561},{"style":529},[1562],{"type":41,"value":1563},"// server/dispatchers/playwrightDispatcher.ts\n",{"type":28,"tag":121,"props":1565,"children":1566},{"class":123,"line":330},[1567,1572],{"type":28,"tag":121,"props":1568,"children":1569},{"style":150},[1570],{"type":41,"value":1571},"constructor",{"type":28,"tag":121,"props":1573,"children":1574},{"style":134},[1575],{"type":41,"value":1576},"(scope: RootDispatcher, playwright: Playwright) {\n",{"type":28,"tag":121,"props":1578,"children":1579},{"class":123,"line":358},[1580,1584,1589,1593,1597,1602],{"type":28,"tag":121,"props":1581,"children":1582},{"style":144},[1583],{"type":41,"value":336},{"type":28,"tag":121,"props":1585,"children":1586},{"style":128},[1587],{"type":41,"value":1588}," android",{"type":28,"tag":121,"props":1590,"children":1591},{"style":144},[1592],{"type":41,"value":147},{"type":28,"tag":121,"props":1594,"children":1595},{"style":144},[1596],{"type":41,"value":445},{"type":28,"tag":121,"props":1598,"children":1599},{"style":150},[1600],{"type":41,"value":1601}," AndroidDispatcher",{"type":28,"tag":121,"props":1603,"children":1604},{"style":134},[1605],{"type":41,"value":1606},"(scope, playwright.android);\n",{"type":28,"tag":121,"props":1608,"children":1609},{"class":123,"line":407},[1610],{"type":28,"tag":121,"props":1611,"children":1612},{"style":529},[1613],{"type":41,"value":1614},"  // parameter names in the base Dispatcher class are\n",{"type":28,"tag":121,"props":1616,"children":1617},{"class":123,"line":416},[1618],{"type":28,"tag":121,"props":1619,"children":1620},{"style":529},[1621],{"type":41,"value":1622},"  // parent, object, type, initializer\n",{"type":28,"tag":121,"props":1624,"children":1625},{"class":123,"line":426},[1626,1631,1636,1640],{"type":28,"tag":121,"props":1627,"children":1628},{"style":128},[1629],{"type":41,"value":1630},"  super",{"type":28,"tag":121,"props":1632,"children":1633},{"style":134},[1634],{"type":41,"value":1635},"(scope, playwright, ",{"type":28,"tag":121,"props":1637,"children":1638},{"style":161},[1639],{"type":41,"value":743},{"type":28,"tag":121,"props":1641,"children":1642},{"style":134},[1643],{"type":41,"value":1644},", {\n",{"type":28,"tag":121,"props":1646,"children":1647},{"class":123,"line":475},[1648,1653,1657,1662],{"type":28,"tag":121,"props":1649,"children":1650},{"style":134},[1651],{"type":41,"value":1652},"    chromium: ",{"type":28,"tag":121,"props":1654,"children":1655},{"style":144},[1656],{"type":41,"value":1507},{"type":28,"tag":121,"props":1658,"children":1659},{"style":150},[1660],{"type":41,"value":1661}," BrowserTypeDispatcher",{"type":28,"tag":121,"props":1663,"children":1664},{"style":134},[1665],{"type":41,"value":1666},"(scope, playwright.chromium),\n",{"type":28,"tag":121,"props":1668,"children":1669},{"class":123,"line":494},[1670,1675,1679,1683],{"type":28,"tag":121,"props":1671,"children":1672},{"style":134},[1673],{"type":41,"value":1674},"    firefox: ",{"type":28,"tag":121,"props":1676,"children":1677},{"style":144},[1678],{"type":41,"value":1507},{"type":28,"tag":121,"props":1680,"children":1681},{"style":150},[1682],{"type":41,"value":1661},{"type":28,"tag":121,"props":1684,"children":1685},{"style":134},[1686],{"type":41,"value":1687},"(scope, playwright.firefox),\n",{"type":28,"tag":121,"props":1689,"children":1690},{"class":123,"line":539},[1691,1696,1700,1704],{"type":28,"tag":121,"props":1692,"children":1693},{"style":134},[1694],{"type":41,"value":1695},"    webkit: ",{"type":28,"tag":121,"props":1697,"children":1698},{"style":144},[1699],{"type":41,"value":1507},{"type":28,"tag":121,"props":1701,"children":1702},{"style":150},[1703],{"type":41,"value":1661},{"type":28,"tag":121,"props":1705,"children":1706},{"style":134},[1707],{"type":41,"value":1708},"(scope, playwright.webkit),\n",{"type":28,"tag":121,"props":1710,"children":1711},{"class":123,"line":547},[1712],{"type":28,"tag":121,"props":1713,"children":1714},{"style":134},[1715],{"type":41,"value":1716},"    android,\n",{"type":28,"tag":121,"props":1718,"children":1719},{"class":123,"line":556},[1720,1725,1729,1734],{"type":28,"tag":121,"props":1721,"children":1722},{"style":134},[1723],{"type":41,"value":1724},"    electron: ",{"type":28,"tag":121,"props":1726,"children":1727},{"style":144},[1728],{"type":41,"value":1507},{"type":28,"tag":121,"props":1730,"children":1731},{"style":150},[1732],{"type":41,"value":1733}," ElectronDispatcher",{"type":28,"tag":121,"props":1735,"children":1736},{"style":134},[1737],{"type":41,"value":1738},"(scope, playwright.electron),\n",{"type":28,"tag":121,"props":1740,"children":1741},{"class":123,"line":600},[1742],{"type":28,"tag":121,"props":1743,"children":1744},{"style":134},[1745],{"type":41,"value":413},{"type":28,"tag":121,"props":1747,"children":1748},{"class":123,"line":22},[1749],{"type":28,"tag":121,"props":1750,"children":1751},{"style":134},[1752],{"type":41,"value":1183},{"type":28,"tag":29,"props":1754,"children":1755},{},[1756,1758,1762,1764,1768,1770,1774,1776,1781,1783,1788,1790,1795,1797,1802,1804,1809],{"type":41,"value":1757},"Notice the ",{"type":28,"tag":44,"props":1759,"children":1760},{"className":7},[1761],{"type":41,"value":1546},{"type":41,"value":1763}," call has parameters for each of the driver types (chromium, firefox, etc.), in its initializers object. And each of the values have the scope the ",{"type":28,"tag":44,"props":1765,"children":1766},{"className":7},[1767],{"type":41,"value":1532},{"type":41,"value":1769},". Every call to the server will run through the connection in the ",{"type":28,"tag":44,"props":1771,"children":1772},{"className":7},[1773],{"type":41,"value":1532},{"type":41,"value":1775},", which then can be traced through calls in each of the dispatcher classes. For example, ",{"type":28,"tag":44,"props":1777,"children":1778},{"className":7},[1779],{"type":41,"value":1780},"BrowserTypeDispatcher",{"type":41,"value":1782}," will launch a ",{"type":28,"tag":44,"props":1784,"children":1785},{"className":7},[1786],{"type":41,"value":1787},"BrowserDispatcher",{"type":41,"value":1789},", which is responsible for creating a ",{"type":28,"tag":44,"props":1791,"children":1792},{"className":7},[1793],{"type":41,"value":1794},"BrowserContextDispatcher",{"type":41,"value":1796},", which can create a ",{"type":28,"tag":44,"props":1798,"children":1799},{"className":7},[1800],{"type":41,"value":1801},"PageDispatcher",{"type":41,"value":1803},", etc. The whole hierarchy of dispatchers directly interacting with the automated browser is contained within these few dispatcher initializations. So now we can trace all calls back to the original ",{"type":28,"tag":44,"props":1805,"children":1806},{"className":7},[1807],{"type":41,"value":1808},"dispatcherConnection",{"type":41,"value":1810}," defined in the factory method with confidence!",{"type":28,"tag":29,"props":1812,"children":1813},{},[1814,1816,1820,1822,1826,1828,1832,1833,1838,1840,1845,1847,1851,1853,1858,1860,1864,1866,1871,1873,1877,1879,1884,1885,1890,1891,1896,1898,1903,1905,1909,1911,1916],{"type":41,"value":1815},"The other important bit to note is where ",{"type":28,"tag":44,"props":1817,"children":1818},{"className":7},[1819],{"type":41,"value":567},{"type":41,"value":1821}," is called within the ",{"type":28,"tag":44,"props":1823,"children":1824},{"className":7},[1825],{"type":41,"value":1808},{"type":41,"value":1827},". The two main wrappers around this method are ",{"type":28,"tag":44,"props":1829,"children":1830},{"className":7},[1831],{"type":41,"value":592},{"type":41,"value":57},{"type":28,"tag":44,"props":1834,"children":1835},{"className":7},[1836],{"type":41,"value":1837},"_sendMessageToClient",{"type":41,"value":1839}," in ",{"type":28,"tag":44,"props":1841,"children":1842},{"className":7},[1843],{"type":41,"value":1844},"DispatcherConnection",{"type":41,"value":1846},". The ",{"type":28,"tag":44,"props":1848,"children":1849},{"className":7},[1850],{"type":41,"value":592},{"type":41,"value":1852}," function is called on the client side, from the ",{"type":28,"tag":44,"props":1854,"children":1855},{"className":7},[1856],{"type":41,"value":1857},"clientConnection.onmessage",{"type":41,"value":1859}," function, so you can interpret this as the main interface the client interacts with the server, where the dispatcher finds the corresponding dispatcher, calls the action, and responds back to the listener connected via ",{"type":28,"tag":44,"props":1861,"children":1862},{"className":7},[1863],{"type":41,"value":567},{"type":41,"value":1865},", which here is the ",{"type":28,"tag":44,"props":1867,"children":1868},{"className":7},[1869],{"type":41,"value":1870},"clientConnection",{"type":41,"value":1872},". The other wrapper, ",{"type":28,"tag":44,"props":1874,"children":1875},{"className":7},[1876],{"type":41,"value":1837},{"type":41,"value":1878},", is called from the ",{"type":28,"tag":44,"props":1880,"children":1881},{"className":7},[1882],{"type":41,"value":1883},"sendEvent",{"type":41,"value":464},{"type":28,"tag":44,"props":1886,"children":1887},{"className":7},[1888],{"type":41,"value":1889},"sendCreate",{"type":41,"value":464},{"type":28,"tag":44,"props":1892,"children":1893},{"className":7},[1894],{"type":41,"value":1895},"sendAdopt",{"type":41,"value":1897},", and ",{"type":28,"tag":44,"props":1899,"children":1900},{"className":7},[1901],{"type":41,"value":1902},"sendDestroy",{"type":41,"value":1904}," methods defined within the dispatcher. Calls to these functions are spread throughout the ",{"type":28,"tag":44,"props":1906,"children":1907},{"className":7},[1908],{"type":41,"value":1200},{"type":41,"value":1910}," subclasses, which call these functions from their internal ",{"type":28,"tag":44,"props":1912,"children":1913},{"className":7},[1914],{"type":41,"value":1915},"_connection",{"type":41,"value":1917}," variable.",{"type":28,"tag":29,"props":1919,"children":1920},{},[1921,1923,1927,1929,1933,1935,1939,1941,1945,1947,1952],{"type":41,"value":1922},"The ",{"type":28,"tag":44,"props":1924,"children":1925},{"className":7},[1926],{"type":41,"value":1889},{"type":41,"value":1928}," function is special because it is only called from within the ",{"type":28,"tag":44,"props":1930,"children":1931},{"className":7},[1932],{"type":41,"value":1200},{"type":41,"value":1934}," constructor, hence the constructor of every subclass. This tells the client connection to create a corresponding client-side class which handles messaging to this dispatcher. Moreover, looking into the ",{"type":28,"tag":44,"props":1936,"children":1937},{"className":7},[1938],{"type":41,"value":1889},{"type":41,"value":1940}," implementation, internally it calls ",{"type":28,"tag":44,"props":1942,"children":1943},{"className":7},[1944],{"type":41,"value":1837},{"type":41,"value":1946}," with the ",{"type":28,"tag":44,"props":1948,"children":1949},{"className":7},[1950],{"type":41,"value":1951},"__create__",{"type":41,"value":1953}," parameter:",{"type":28,"tag":110,"props":1955,"children":1957},{"className":283,"code":1956,"language":285,"meta":7,"style":7},"// server/dispatchers/dispatcher.ts\nsendCreate(parent: DispatcherScope, type: string, guid: string, initializer: any, sdkObject?: SdkObject) {\n  const validator = findValidator(type, '', 'Initializer');\n  initializer = validator(initializer, '', { tChannelImpl: this._tChannelImplToWire.bind(this), binary: this._isLocal ? 'buffer' : 'toBase64' });\n  this._sendMessageToClient(parent._guid, type, '__create__', { type, initializer, guid }, sdkObject);\n}\n",[1958],{"type":28,"tag":44,"props":1959,"children":1960},{"__ignoreMap":7},[1961,1969,1991,2034,2126,2157],{"type":28,"tag":121,"props":1962,"children":1963},{"class":123,"line":124},[1964],{"type":28,"tag":121,"props":1965,"children":1966},{"style":529},[1967],{"type":41,"value":1968},"// server/dispatchers/dispatcher.ts\n",{"type":28,"tag":121,"props":1970,"children":1971},{"class":123,"line":330},[1972,1976,1981,1986],{"type":28,"tag":121,"props":1973,"children":1974},{"style":150},[1975],{"type":41,"value":1889},{"type":28,"tag":121,"props":1977,"children":1978},{"style":134},[1979],{"type":41,"value":1980},"(parent: DispatcherScope, type: string, guid: string, initializer: any, sdkObject",{"type":28,"tag":121,"props":1982,"children":1983},{"style":144},[1984],{"type":41,"value":1985},"?:",{"type":28,"tag":121,"props":1987,"children":1988},{"style":134},[1989],{"type":41,"value":1990}," SdkObject) {\n",{"type":28,"tag":121,"props":1992,"children":1993},{"class":123,"line":358},[1994,1998,2003,2007,2012,2017,2021,2025,2030],{"type":28,"tag":121,"props":1995,"children":1996},{"style":144},[1997],{"type":41,"value":336},{"type":28,"tag":121,"props":1999,"children":2000},{"style":128},[2001],{"type":41,"value":2002}," validator",{"type":28,"tag":121,"props":2004,"children":2005},{"style":144},[2006],{"type":41,"value":147},{"type":28,"tag":121,"props":2008,"children":2009},{"style":150},[2010],{"type":41,"value":2011}," findValidator",{"type":28,"tag":121,"props":2013,"children":2014},{"style":134},[2015],{"type":41,"value":2016},"(type, ",{"type":28,"tag":121,"props":2018,"children":2019},{"style":161},[2020],{"type":41,"value":1125},{"type":28,"tag":121,"props":2022,"children":2023},{"style":134},[2024],{"type":41,"value":464},{"type":28,"tag":121,"props":2026,"children":2027},{"style":161},[2028],{"type":41,"value":2029},"'Initializer'",{"type":28,"tag":121,"props":2031,"children":2032},{"style":134},[2033],{"type":41,"value":169},{"type":28,"tag":121,"props":2035,"children":2036},{"class":123,"line":407},[2037,2042,2046,2050,2055,2059,2064,2069,2074,2079,2083,2087,2092,2096,2101,2106,2111,2116,2121],{"type":28,"tag":121,"props":2038,"children":2039},{"style":134},[2040],{"type":41,"value":2041},"  initializer ",{"type":28,"tag":121,"props":2043,"children":2044},{"style":144},[2045],{"type":41,"value":775},{"type":28,"tag":121,"props":2047,"children":2048},{"style":150},[2049],{"type":41,"value":2002},{"type":28,"tag":121,"props":2051,"children":2052},{"style":134},[2053],{"type":41,"value":2054},"(initializer, ",{"type":28,"tag":121,"props":2056,"children":2057},{"style":161},[2058],{"type":41,"value":1125},{"type":28,"tag":121,"props":2060,"children":2061},{"style":134},[2062],{"type":41,"value":2063},", { tChannelImpl: ",{"type":28,"tag":121,"props":2065,"children":2066},{"style":128},[2067],{"type":41,"value":2068},"this",{"type":28,"tag":121,"props":2070,"children":2071},{"style":134},[2072],{"type":41,"value":2073},"._tChannelImplToWire.",{"type":28,"tag":121,"props":2075,"children":2076},{"style":150},[2077],{"type":41,"value":2078},"bind",{"type":28,"tag":121,"props":2080,"children":2081},{"style":134},[2082],{"type":41,"value":158},{"type":28,"tag":121,"props":2084,"children":2085},{"style":128},[2086],{"type":41,"value":2068},{"type":28,"tag":121,"props":2088,"children":2089},{"style":134},[2090],{"type":41,"value":2091},"), binary: ",{"type":28,"tag":121,"props":2093,"children":2094},{"style":128},[2095],{"type":41,"value":2068},{"type":28,"tag":121,"props":2097,"children":2098},{"style":134},[2099],{"type":41,"value":2100},"._isLocal ",{"type":28,"tag":121,"props":2102,"children":2103},{"style":144},[2104],{"type":41,"value":2105},"?",{"type":28,"tag":121,"props":2107,"children":2108},{"style":161},[2109],{"type":41,"value":2110}," 'buffer'",{"type":28,"tag":121,"props":2112,"children":2113},{"style":144},[2114],{"type":41,"value":2115}," :",{"type":28,"tag":121,"props":2117,"children":2118},{"style":161},[2119],{"type":41,"value":2120}," 'toBase64'",{"type":28,"tag":121,"props":2122,"children":2123},{"style":134},[2124],{"type":41,"value":2125}," });\n",{"type":28,"tag":121,"props":2127,"children":2128},{"class":123,"line":416},[2129,2134,2138,2142,2147,2152],{"type":28,"tag":121,"props":2130,"children":2131},{"style":128},[2132],{"type":41,"value":2133},"  this",{"type":28,"tag":121,"props":2135,"children":2136},{"style":134},[2137],{"type":41,"value":89},{"type":28,"tag":121,"props":2139,"children":2140},{"style":150},[2141],{"type":41,"value":1837},{"type":28,"tag":121,"props":2143,"children":2144},{"style":134},[2145],{"type":41,"value":2146},"(parent._guid, type, ",{"type":28,"tag":121,"props":2148,"children":2149},{"style":161},[2150],{"type":41,"value":2151},"'__create__'",{"type":28,"tag":121,"props":2153,"children":2154},{"style":134},[2155],{"type":41,"value":2156},", { type, initializer, guid }, sdkObject);\n",{"type":28,"tag":121,"props":2158,"children":2159},{"class":123,"line":426},[2160],{"type":28,"tag":121,"props":2161,"children":2162},{"style":134},[2163],{"type":41,"value":1183},{"type":28,"tag":29,"props":2165,"children":2166},{},[2167,2169,2173,2175,2179,2181,2186,2188,2192,2194,2198,2200,2204],{"type":41,"value":2168},"so if we search through the ",{"type":28,"tag":44,"props":2170,"children":2171},{"className":7},[2172],{"type":41,"value":1220},{"type":41,"value":2174}," class on the client side, sure enough in its ",{"type":28,"tag":44,"props":2176,"children":2177},{"className":7},[2178],{"type":41,"value":592},{"type":41,"value":2180}," function it has a call to ",{"type":28,"tag":44,"props":2182,"children":2183},{"className":7},[2184],{"type":41,"value":2185},"_createRemoteObject",{"type":41,"value":2187}," for the associated method ",{"type":28,"tag":44,"props":2189,"children":2190},{"className":7},[2191],{"type":41,"value":1951},{"type":41,"value":2193},". This ",{"type":28,"tag":44,"props":2195,"children":2196},{"className":7},[2197],{"type":41,"value":2185},{"type":41,"value":2199}," is what initializes the client-side ",{"type":28,"tag":44,"props":2201,"children":2202},{"className":7},[2203],{"type":41,"value":12},{"type":41,"value":2205}," instance, and is why we call",{"type":28,"tag":110,"props":2207,"children":2209},{"className":283,"code":2208,"language":285,"meta":7,"style":7},"const playwrightAPI = clientConnection.getObjectWithKnownName('Playwright');\n",[2210],{"type":28,"tag":44,"props":2211,"children":2212},{"__ignoreMap":7},[2213],{"type":28,"tag":121,"props":2214,"children":2215},{"class":123,"line":124},[2216,2220,2224,2228,2232,2236,2240,2244],{"type":28,"tag":121,"props":2217,"children":2218},{"style":144},[2219],{"type":41,"value":1351},{"type":28,"tag":121,"props":2221,"children":2222},{"style":128},[2223],{"type":41,"value":721},{"type":28,"tag":121,"props":2225,"children":2226},{"style":144},[2227],{"type":41,"value":147},{"type":28,"tag":121,"props":2229,"children":2230},{"style":134},[2231],{"type":41,"value":587},{"type":28,"tag":121,"props":2233,"children":2234},{"style":150},[2235],{"type":41,"value":734},{"type":28,"tag":121,"props":2237,"children":2238},{"style":134},[2239],{"type":41,"value":158},{"type":28,"tag":121,"props":2241,"children":2242},{"style":161},[2243],{"type":41,"value":743},{"type":28,"tag":121,"props":2245,"children":2246},{"style":134},[2247],{"type":41,"value":169},{"type":28,"tag":29,"props":2249,"children":2250},{},[2251,2253,2257,2259,2263],{"type":41,"value":2252},"to set the playwright API. But let's dive a little deeper as to what's happening with the message from the ",{"type":28,"tag":44,"props":2254,"children":2255},{"className":7},[2256],{"type":41,"value":1808},{"type":41,"value":2258}," over to the ",{"type":28,"tag":44,"props":2260,"children":2261},{"className":7},[2262],{"type":41,"value":1870},{"type":41,"value":2264},". For the Playwright create message, it looks like",{"type":28,"tag":110,"props":2266,"children":2268},{"className":283,"code":2267,"language":285,"meta":7,"style":7},"{\n  guid: '',\n  method: '__create__',\n  params: {\n    type: 'Playwright',\n    initializer: {\n      chromium: { guid: 'browser-type@024d5a494527ece580841844a9a933a6' },\n      firefox: { guid: 'browser-type@fae8f48651c02682ad3b276f0a046d63' },\n      webkit: { guid: 'browser-type@ed1c30ab794ec863fe5b9b208c3635e1' },\n      android: { guid: 'android@832582c466c24c6933d3a5587059e1be' },\n      electron: { guid: 'electron@3829a7608477101154e15c1e25bca9ca' },\n    },\n    guid: 'Playwright'\n  }\n}\n",[2269],{"type":28,"tag":44,"props":2270,"children":2271},{"__ignoreMap":7},[2272,2280,2302,2322,2335,2355,2367,2399,2428,2457,2486,2515,2523,2540,2548],{"type":28,"tag":121,"props":2273,"children":2274},{"class":123,"line":124},[2275],{"type":28,"tag":121,"props":2276,"children":2277},{"style":134},[2278],{"type":41,"value":2279},"{\n",{"type":28,"tag":121,"props":2281,"children":2282},{"class":123,"line":330},[2283,2288,2293,2297],{"type":28,"tag":121,"props":2284,"children":2285},{"style":150},[2286],{"type":41,"value":2287},"  guid",{"type":28,"tag":121,"props":2289,"children":2290},{"style":134},[2291],{"type":41,"value":2292},": ",{"type":28,"tag":121,"props":2294,"children":2295},{"style":161},[2296],{"type":41,"value":1125},{"type":28,"tag":121,"props":2298,"children":2299},{"style":134},[2300],{"type":41,"value":2301},",\n",{"type":28,"tag":121,"props":2303,"children":2304},{"class":123,"line":358},[2305,2310,2314,2318],{"type":28,"tag":121,"props":2306,"children":2307},{"style":150},[2308],{"type":41,"value":2309},"  method",{"type":28,"tag":121,"props":2311,"children":2312},{"style":134},[2313],{"type":41,"value":2292},{"type":28,"tag":121,"props":2315,"children":2316},{"style":161},[2317],{"type":41,"value":2151},{"type":28,"tag":121,"props":2319,"children":2320},{"style":134},[2321],{"type":41,"value":2301},{"type":28,"tag":121,"props":2323,"children":2324},{"class":123,"line":407},[2325,2330],{"type":28,"tag":121,"props":2326,"children":2327},{"style":150},[2328],{"type":41,"value":2329},"  params",{"type":28,"tag":121,"props":2331,"children":2332},{"style":134},[2333],{"type":41,"value":2334},": {\n",{"type":28,"tag":121,"props":2336,"children":2337},{"class":123,"line":416},[2338,2343,2347,2351],{"type":28,"tag":121,"props":2339,"children":2340},{"style":150},[2341],{"type":41,"value":2342},"    type",{"type":28,"tag":121,"props":2344,"children":2345},{"style":134},[2346],{"type":41,"value":2292},{"type":28,"tag":121,"props":2348,"children":2349},{"style":161},[2350],{"type":41,"value":743},{"type":28,"tag":121,"props":2352,"children":2353},{"style":134},[2354],{"type":41,"value":2301},{"type":28,"tag":121,"props":2356,"children":2357},{"class":123,"line":426},[2358,2363],{"type":28,"tag":121,"props":2359,"children":2360},{"style":150},[2361],{"type":41,"value":2362},"    initializer",{"type":28,"tag":121,"props":2364,"children":2365},{"style":134},[2366],{"type":41,"value":2334},{"type":28,"tag":121,"props":2368,"children":2369},{"class":123,"line":475},[2370,2375,2380,2385,2389,2394],{"type":28,"tag":121,"props":2371,"children":2372},{"style":150},[2373],{"type":41,"value":2374},"      chromium",{"type":28,"tag":121,"props":2376,"children":2377},{"style":134},[2378],{"type":41,"value":2379},": { ",{"type":28,"tag":121,"props":2381,"children":2382},{"style":150},[2383],{"type":41,"value":2384},"guid",{"type":28,"tag":121,"props":2386,"children":2387},{"style":134},[2388],{"type":41,"value":2292},{"type":28,"tag":121,"props":2390,"children":2391},{"style":161},[2392],{"type":41,"value":2393},"'browser-type@024d5a494527ece580841844a9a933a6'",{"type":28,"tag":121,"props":2395,"children":2396},{"style":134},[2397],{"type":41,"value":2398}," },\n",{"type":28,"tag":121,"props":2400,"children":2401},{"class":123,"line":494},[2402,2407,2411,2415,2419,2424],{"type":28,"tag":121,"props":2403,"children":2404},{"style":150},[2405],{"type":41,"value":2406},"      firefox",{"type":28,"tag":121,"props":2408,"children":2409},{"style":134},[2410],{"type":41,"value":2379},{"type":28,"tag":121,"props":2412,"children":2413},{"style":150},[2414],{"type":41,"value":2384},{"type":28,"tag":121,"props":2416,"children":2417},{"style":134},[2418],{"type":41,"value":2292},{"type":28,"tag":121,"props":2420,"children":2421},{"style":161},[2422],{"type":41,"value":2423},"'browser-type@fae8f48651c02682ad3b276f0a046d63'",{"type":28,"tag":121,"props":2425,"children":2426},{"style":134},[2427],{"type":41,"value":2398},{"type":28,"tag":121,"props":2429,"children":2430},{"class":123,"line":539},[2431,2436,2440,2444,2448,2453],{"type":28,"tag":121,"props":2432,"children":2433},{"style":150},[2434],{"type":41,"value":2435},"      webkit",{"type":28,"tag":121,"props":2437,"children":2438},{"style":134},[2439],{"type":41,"value":2379},{"type":28,"tag":121,"props":2441,"children":2442},{"style":150},[2443],{"type":41,"value":2384},{"type":28,"tag":121,"props":2445,"children":2446},{"style":134},[2447],{"type":41,"value":2292},{"type":28,"tag":121,"props":2449,"children":2450},{"style":161},[2451],{"type":41,"value":2452},"'browser-type@ed1c30ab794ec863fe5b9b208c3635e1'",{"type":28,"tag":121,"props":2454,"children":2455},{"style":134},[2456],{"type":41,"value":2398},{"type":28,"tag":121,"props":2458,"children":2459},{"class":123,"line":547},[2460,2465,2469,2473,2477,2482],{"type":28,"tag":121,"props":2461,"children":2462},{"style":150},[2463],{"type":41,"value":2464},"      android",{"type":28,"tag":121,"props":2466,"children":2467},{"style":134},[2468],{"type":41,"value":2379},{"type":28,"tag":121,"props":2470,"children":2471},{"style":150},[2472],{"type":41,"value":2384},{"type":28,"tag":121,"props":2474,"children":2475},{"style":134},[2476],{"type":41,"value":2292},{"type":28,"tag":121,"props":2478,"children":2479},{"style":161},[2480],{"type":41,"value":2481},"'android@832582c466c24c6933d3a5587059e1be'",{"type":28,"tag":121,"props":2483,"children":2484},{"style":134},[2485],{"type":41,"value":2398},{"type":28,"tag":121,"props":2487,"children":2488},{"class":123,"line":556},[2489,2494,2498,2502,2506,2511],{"type":28,"tag":121,"props":2490,"children":2491},{"style":150},[2492],{"type":41,"value":2493},"      electron",{"type":28,"tag":121,"props":2495,"children":2496},{"style":134},[2497],{"type":41,"value":2379},{"type":28,"tag":121,"props":2499,"children":2500},{"style":150},[2501],{"type":41,"value":2384},{"type":28,"tag":121,"props":2503,"children":2504},{"style":134},[2505],{"type":41,"value":2292},{"type":28,"tag":121,"props":2507,"children":2508},{"style":161},[2509],{"type":41,"value":2510},"'electron@3829a7608477101154e15c1e25bca9ca'",{"type":28,"tag":121,"props":2512,"children":2513},{"style":134},[2514],{"type":41,"value":2398},{"type":28,"tag":121,"props":2516,"children":2517},{"class":123,"line":600},[2518],{"type":28,"tag":121,"props":2519,"children":2520},{"style":134},[2521],{"type":41,"value":2522},"    },\n",{"type":28,"tag":121,"props":2524,"children":2525},{"class":123,"line":22},[2526,2531,2535],{"type":28,"tag":121,"props":2527,"children":2528},{"style":150},[2529],{"type":41,"value":2530},"    guid",{"type":28,"tag":121,"props":2532,"children":2533},{"style":134},[2534],{"type":41,"value":2292},{"type":28,"tag":121,"props":2536,"children":2537},{"style":161},[2538],{"type":41,"value":2539},"'Playwright'\n",{"type":28,"tag":121,"props":2541,"children":2542},{"class":123,"line":644},[2543],{"type":28,"tag":121,"props":2544,"children":2545},{"style":134},[2546],{"type":41,"value":2547},"  }\n",{"type":28,"tag":121,"props":2549,"children":2550},{"class":123,"line":675},[2551],{"type":28,"tag":121,"props":2552,"children":2553},{"style":134},[2554],{"type":41,"value":1183},{"type":28,"tag":29,"props":2556,"children":2557},{},[2558,2560,2564,2566,2571,2573,2577,2579,2584,2586,2591,2593,2598],{"type":41,"value":2559},"note before this there are messages for each of the device types, and the ",{"type":28,"tag":44,"props":2561,"children":2562},{"className":7},[2563],{"type":41,"value":1870},{"type":41,"value":2565}," constructs corresponding objects which provide a public API for these dispatchers within the server. These API's are provided by subclasses of the ",{"type":28,"tag":44,"props":2567,"children":2568},{"className":7},[2569],{"type":41,"value":2570},"ChannelOwner",{"type":41,"value":2572}," class, which is a concept for a later section. For now, let's trace what happens in the ",{"type":28,"tag":44,"props":2574,"children":2575},{"className":7},[2576],{"type":41,"value":1870},{"type":41,"value":2578}," for the ",{"type":28,"tag":44,"props":2580,"children":2581},{"className":7},[2582],{"type":41,"value":2583},"type: 'Playwright'",{"type":41,"value":2585}," message. As mentioned before, the message is put through the ",{"type":28,"tag":44,"props":2587,"children":2588},{"className":7},[2589],{"type":41,"value":2590},"clientConnection.dispatch",{"type":41,"value":2592}," function which then calls the ",{"type":28,"tag":44,"props":2594,"children":2595},{"className":7},[2596],{"type":41,"value":2597},"clientConnection._createRemoteObject",{"type":41,"value":2599}," function with the following parameters",{"type":28,"tag":110,"props":2601,"children":2603},{"className":283,"code":2602,"language":285,"meta":7,"style":7},"this._createRemoteObject(\n  '', // parentGuid - corresponds to Root, the root ChannelOwner\n  'Playwright', // type\n  'Playwright', // guid\n  { // initializer\n    chromium: { guid: 'browser-type@024d5a494527ece580841844a9a933a6' },\n    firefox: { guid: 'browser-type@fae8f48651c02682ad3b276f0a046d63' },\n    webkit: { guid: 'browser-type@ed1c30ab794ec863fe5b9b208c3635e1' },\n    android: { guid: 'android@832582c466c24c6933d3a5587059e1be' },\n    electron: { guid: 'electron@3829a7608477101154e15c1e25bca9ca' },\n  }\n)\n",[2604],{"type":28,"tag":44,"props":2605,"children":2606},{"__ignoreMap":7},[2607,2627,2644,2661,2677,2690,2706,2722,2738,2754,2770,2777],{"type":28,"tag":121,"props":2608,"children":2609},{"class":123,"line":124},[2610,2614,2618,2622],{"type":28,"tag":121,"props":2611,"children":2612},{"style":128},[2613],{"type":41,"value":2068},{"type":28,"tag":121,"props":2615,"children":2616},{"style":134},[2617],{"type":41,"value":89},{"type":28,"tag":121,"props":2619,"children":2620},{"style":150},[2621],{"type":41,"value":2185},{"type":28,"tag":121,"props":2623,"children":2624},{"style":134},[2625],{"type":41,"value":2626},"(\n",{"type":28,"tag":121,"props":2628,"children":2629},{"class":123,"line":330},[2630,2635,2639],{"type":28,"tag":121,"props":2631,"children":2632},{"style":161},[2633],{"type":41,"value":2634},"  ''",{"type":28,"tag":121,"props":2636,"children":2637},{"style":134},[2638],{"type":41,"value":464},{"type":28,"tag":121,"props":2640,"children":2641},{"style":529},[2642],{"type":41,"value":2643},"// parentGuid - corresponds to Root, the root ChannelOwner\n",{"type":28,"tag":121,"props":2645,"children":2646},{"class":123,"line":358},[2647,2652,2656],{"type":28,"tag":121,"props":2648,"children":2649},{"style":161},[2650],{"type":41,"value":2651},"  'Playwright'",{"type":28,"tag":121,"props":2653,"children":2654},{"style":134},[2655],{"type":41,"value":464},{"type":28,"tag":121,"props":2657,"children":2658},{"style":529},[2659],{"type":41,"value":2660},"// type\n",{"type":28,"tag":121,"props":2662,"children":2663},{"class":123,"line":407},[2664,2668,2672],{"type":28,"tag":121,"props":2665,"children":2666},{"style":161},[2667],{"type":41,"value":2651},{"type":28,"tag":121,"props":2669,"children":2670},{"style":134},[2671],{"type":41,"value":464},{"type":28,"tag":121,"props":2673,"children":2674},{"style":529},[2675],{"type":41,"value":2676},"// guid\n",{"type":28,"tag":121,"props":2678,"children":2679},{"class":123,"line":416},[2680,2685],{"type":28,"tag":121,"props":2681,"children":2682},{"style":134},[2683],{"type":41,"value":2684},"  { ",{"type":28,"tag":121,"props":2686,"children":2687},{"style":529},[2688],{"type":41,"value":2689},"// initializer\n",{"type":28,"tag":121,"props":2691,"children":2692},{"class":123,"line":426},[2693,2698,2702],{"type":28,"tag":121,"props":2694,"children":2695},{"style":134},[2696],{"type":41,"value":2697},"    chromium: { guid: ",{"type":28,"tag":121,"props":2699,"children":2700},{"style":161},[2701],{"type":41,"value":2393},{"type":28,"tag":121,"props":2703,"children":2704},{"style":134},[2705],{"type":41,"value":2398},{"type":28,"tag":121,"props":2707,"children":2708},{"class":123,"line":475},[2709,2714,2718],{"type":28,"tag":121,"props":2710,"children":2711},{"style":134},[2712],{"type":41,"value":2713},"    firefox: { guid: ",{"type":28,"tag":121,"props":2715,"children":2716},{"style":161},[2717],{"type":41,"value":2423},{"type":28,"tag":121,"props":2719,"children":2720},{"style":134},[2721],{"type":41,"value":2398},{"type":28,"tag":121,"props":2723,"children":2724},{"class":123,"line":494},[2725,2730,2734],{"type":28,"tag":121,"props":2726,"children":2727},{"style":134},[2728],{"type":41,"value":2729},"    webkit: { guid: ",{"type":28,"tag":121,"props":2731,"children":2732},{"style":161},[2733],{"type":41,"value":2452},{"type":28,"tag":121,"props":2735,"children":2736},{"style":134},[2737],{"type":41,"value":2398},{"type":28,"tag":121,"props":2739,"children":2740},{"class":123,"line":539},[2741,2746,2750],{"type":28,"tag":121,"props":2742,"children":2743},{"style":134},[2744],{"type":41,"value":2745},"    android: { guid: ",{"type":28,"tag":121,"props":2747,"children":2748},{"style":161},[2749],{"type":41,"value":2481},{"type":28,"tag":121,"props":2751,"children":2752},{"style":134},[2753],{"type":41,"value":2398},{"type":28,"tag":121,"props":2755,"children":2756},{"class":123,"line":547},[2757,2762,2766],{"type":28,"tag":121,"props":2758,"children":2759},{"style":134},[2760],{"type":41,"value":2761},"    electron: { guid: ",{"type":28,"tag":121,"props":2763,"children":2764},{"style":161},[2765],{"type":41,"value":2510},{"type":28,"tag":121,"props":2767,"children":2768},{"style":134},[2769],{"type":41,"value":2398},{"type":28,"tag":121,"props":2771,"children":2772},{"class":123,"line":556},[2773],{"type":28,"tag":121,"props":2774,"children":2775},{"style":134},[2776],{"type":41,"value":2547},{"type":28,"tag":121,"props":2778,"children":2779},{"class":123,"line":600},[2780],{"type":28,"tag":121,"props":2781,"children":2782},{"style":134},[2783],{"type":41,"value":2784},")\n",{"type":28,"tag":29,"props":2786,"children":2787},{},[2788,2790,2794,2796,2801],{"type":41,"value":2789},"in the ",{"type":28,"tag":44,"props":2791,"children":2792},{"className":7},[2793],{"type":41,"value":2597},{"type":41,"value":2795}," function, there is a transformation of the data and then a large ",{"type":28,"tag":44,"props":2797,"children":2798},{"className":7},[2799],{"type":41,"value":2800},"switch-case",{"type":41,"value":2802}," function instantiating the corresponding client class.",{"type":28,"tag":110,"props":2804,"children":2806},{"className":283,"code":2805,"language":285,"meta":7,"style":7},"_createRemoteObject(parentGuid: string, type: string, guid: string, initializer: any) {\n  const parent = this._objects.get(parentGuid); // here the parentGuid is ''\n  if (!parent)\n    throw new Error(`Cannot find parent object ${parentGuid} to create ${guid}`);\n  let result: ChannelOwner\u003Cany>;\n  const validator = findValidator(type, '', 'Initializer');\n  initializer = validator(\n    initializer,\n    '',\n    {\n      tChannelImpl: this._tChannelImplFromWire.bind(this),\n      binary: this._rawBuffers ? 'buffer' : 'fromBase64'\n    }\n  );\n  switch (type) {\n    // ...\n    case 'Playwright':\n      result = new Playwright(parent, type, guid, initializer);\n      break;\n    // ...\n  }\n  return result;\n}\n",[2807],{"type":28,"tag":44,"props":2808,"children":2809},{"__ignoreMap":7},[2810,2822,2862,2883,2932,2969,3008,3027,3035,3047,3055,3089,3123,3131,3139,3152,3160,3178,3204,3216,3223,3230,3242],{"type":28,"tag":121,"props":2811,"children":2812},{"class":123,"line":124},[2813,2817],{"type":28,"tag":121,"props":2814,"children":2815},{"style":150},[2816],{"type":41,"value":2185},{"type":28,"tag":121,"props":2818,"children":2819},{"style":134},[2820],{"type":41,"value":2821},"(parentGuid: string, type: string, guid: string, initializer: any) {\n",{"type":28,"tag":121,"props":2823,"children":2824},{"class":123,"line":330},[2825,2829,2834,2838,2843,2848,2852,2857],{"type":28,"tag":121,"props":2826,"children":2827},{"style":144},[2828],{"type":41,"value":336},{"type":28,"tag":121,"props":2830,"children":2831},{"style":128},[2832],{"type":41,"value":2833}," parent",{"type":28,"tag":121,"props":2835,"children":2836},{"style":144},[2837],{"type":41,"value":147},{"type":28,"tag":121,"props":2839,"children":2840},{"style":128},[2841],{"type":41,"value":2842}," this",{"type":28,"tag":121,"props":2844,"children":2845},{"style":134},[2846],{"type":41,"value":2847},"._objects.",{"type":28,"tag":121,"props":2849,"children":2850},{"style":150},[2851],{"type":41,"value":1084},{"type":28,"tag":121,"props":2853,"children":2854},{"style":134},[2855],{"type":41,"value":2856},"(parentGuid); ",{"type":28,"tag":121,"props":2858,"children":2859},{"style":529},[2860],{"type":41,"value":2861},"// here the parentGuid is ''\n",{"type":28,"tag":121,"props":2863,"children":2864},{"class":123,"line":358},[2865,2870,2874,2878],{"type":28,"tag":121,"props":2866,"children":2867},{"style":144},[2868],{"type":41,"value":2869},"  if",{"type":28,"tag":121,"props":2871,"children":2872},{"style":134},[2873],{"type":41,"value":1038},{"type":28,"tag":121,"props":2875,"children":2876},{"style":144},[2877],{"type":41,"value":1094},{"type":28,"tag":121,"props":2879,"children":2880},{"style":134},[2881],{"type":41,"value":2882},"parent)\n",{"type":28,"tag":121,"props":2884,"children":2885},{"class":123,"line":407},[2886,2891,2895,2900,2904,2909,2914,2919,2923,2928],{"type":28,"tag":121,"props":2887,"children":2888},{"style":144},[2889],{"type":41,"value":2890},"    throw",{"type":28,"tag":121,"props":2892,"children":2893},{"style":144},[2894],{"type":41,"value":445},{"type":28,"tag":121,"props":2896,"children":2897},{"style":150},[2898],{"type":41,"value":2899}," Error",{"type":28,"tag":121,"props":2901,"children":2902},{"style":134},[2903],{"type":41,"value":158},{"type":28,"tag":121,"props":2905,"children":2906},{"style":161},[2907],{"type":41,"value":2908},"`Cannot find parent object ${",{"type":28,"tag":121,"props":2910,"children":2911},{"style":134},[2912],{"type":41,"value":2913},"parentGuid",{"type":28,"tag":121,"props":2915,"children":2916},{"style":161},[2917],{"type":41,"value":2918},"} to create ${",{"type":28,"tag":121,"props":2920,"children":2921},{"style":134},[2922],{"type":41,"value":2384},{"type":28,"tag":121,"props":2924,"children":2925},{"style":161},[2926],{"type":41,"value":2927},"}`",{"type":28,"tag":121,"props":2929,"children":2930},{"style":134},[2931],{"type":41,"value":169},{"type":28,"tag":121,"props":2933,"children":2934},{"class":123,"line":416},[2935,2940,2945,2949,2954,2959,2964],{"type":28,"tag":121,"props":2936,"children":2937},{"style":144},[2938],{"type":41,"value":2939},"  let",{"type":28,"tag":121,"props":2941,"children":2942},{"style":134},[2943],{"type":41,"value":2944}," result",{"type":28,"tag":121,"props":2946,"children":2947},{"style":144},[2948],{"type":41,"value":317},{"type":28,"tag":121,"props":2950,"children":2951},{"style":150},[2952],{"type":41,"value":2953}," ChannelOwner",{"type":28,"tag":121,"props":2955,"children":2956},{"style":134},[2957],{"type":41,"value":2958},"\u003C",{"type":28,"tag":121,"props":2960,"children":2961},{"style":128},[2962],{"type":41,"value":2963},"any",{"type":28,"tag":121,"props":2965,"children":2966},{"style":134},[2967],{"type":41,"value":2968},">;\n",{"type":28,"tag":121,"props":2970,"children":2971},{"class":123,"line":426},[2972,2976,2980,2984,2988,2992,2996,3000,3004],{"type":28,"tag":121,"props":2973,"children":2974},{"style":144},[2975],{"type":41,"value":336},{"type":28,"tag":121,"props":2977,"children":2978},{"style":128},[2979],{"type":41,"value":2002},{"type":28,"tag":121,"props":2981,"children":2982},{"style":144},[2983],{"type":41,"value":147},{"type":28,"tag":121,"props":2985,"children":2986},{"style":150},[2987],{"type":41,"value":2011},{"type":28,"tag":121,"props":2989,"children":2990},{"style":134},[2991],{"type":41,"value":2016},{"type":28,"tag":121,"props":2993,"children":2994},{"style":161},[2995],{"type":41,"value":1125},{"type":28,"tag":121,"props":2997,"children":2998},{"style":134},[2999],{"type":41,"value":464},{"type":28,"tag":121,"props":3001,"children":3002},{"style":161},[3003],{"type":41,"value":2029},{"type":28,"tag":121,"props":3005,"children":3006},{"style":134},[3007],{"type":41,"value":169},{"type":28,"tag":121,"props":3009,"children":3010},{"class":123,"line":475},[3011,3015,3019,3023],{"type":28,"tag":121,"props":3012,"children":3013},{"style":134},[3014],{"type":41,"value":2041},{"type":28,"tag":121,"props":3016,"children":3017},{"style":144},[3018],{"type":41,"value":775},{"type":28,"tag":121,"props":3020,"children":3021},{"style":150},[3022],{"type":41,"value":2002},{"type":28,"tag":121,"props":3024,"children":3025},{"style":134},[3026],{"type":41,"value":2626},{"type":28,"tag":121,"props":3028,"children":3029},{"class":123,"line":494},[3030],{"type":28,"tag":121,"props":3031,"children":3032},{"style":134},[3033],{"type":41,"value":3034},"    initializer,\n",{"type":28,"tag":121,"props":3036,"children":3037},{"class":123,"line":539},[3038,3043],{"type":28,"tag":121,"props":3039,"children":3040},{"style":161},[3041],{"type":41,"value":3042},"    ''",{"type":28,"tag":121,"props":3044,"children":3045},{"style":134},[3046],{"type":41,"value":2301},{"type":28,"tag":121,"props":3048,"children":3049},{"class":123,"line":547},[3050],{"type":28,"tag":121,"props":3051,"children":3052},{"style":134},[3053],{"type":41,"value":3054},"    {\n",{"type":28,"tag":121,"props":3056,"children":3057},{"class":123,"line":556},[3058,3063,3067,3072,3076,3080,3084],{"type":28,"tag":121,"props":3059,"children":3060},{"style":134},[3061],{"type":41,"value":3062},"      tChannelImpl: ",{"type":28,"tag":121,"props":3064,"children":3065},{"style":128},[3066],{"type":41,"value":2068},{"type":28,"tag":121,"props":3068,"children":3069},{"style":134},[3070],{"type":41,"value":3071},"._tChannelImplFromWire.",{"type":28,"tag":121,"props":3073,"children":3074},{"style":150},[3075],{"type":41,"value":2078},{"type":28,"tag":121,"props":3077,"children":3078},{"style":134},[3079],{"type":41,"value":158},{"type":28,"tag":121,"props":3081,"children":3082},{"style":128},[3083],{"type":41,"value":2068},{"type":28,"tag":121,"props":3085,"children":3086},{"style":134},[3087],{"type":41,"value":3088},"),\n",{"type":28,"tag":121,"props":3090,"children":3091},{"class":123,"line":600},[3092,3097,3101,3106,3110,3114,3118],{"type":28,"tag":121,"props":3093,"children":3094},{"style":134},[3095],{"type":41,"value":3096},"      binary: ",{"type":28,"tag":121,"props":3098,"children":3099},{"style":128},[3100],{"type":41,"value":2068},{"type":28,"tag":121,"props":3102,"children":3103},{"style":134},[3104],{"type":41,"value":3105},"._rawBuffers ",{"type":28,"tag":121,"props":3107,"children":3108},{"style":144},[3109],{"type":41,"value":2105},{"type":28,"tag":121,"props":3111,"children":3112},{"style":161},[3113],{"type":41,"value":2110},{"type":28,"tag":121,"props":3115,"children":3116},{"style":144},[3117],{"type":41,"value":2115},{"type":28,"tag":121,"props":3119,"children":3120},{"style":161},[3121],{"type":41,"value":3122}," 'fromBase64'\n",{"type":28,"tag":121,"props":3124,"children":3125},{"class":123,"line":22},[3126],{"type":28,"tag":121,"props":3127,"children":3128},{"style":134},[3129],{"type":41,"value":3130},"    }\n",{"type":28,"tag":121,"props":3132,"children":3133},{"class":123,"line":644},[3134],{"type":28,"tag":121,"props":3135,"children":3136},{"style":134},[3137],{"type":41,"value":3138},"  );\n",{"type":28,"tag":121,"props":3140,"children":3141},{"class":123,"line":675},[3142,3147],{"type":28,"tag":121,"props":3143,"children":3144},{"style":144},[3145],{"type":41,"value":3146},"  switch",{"type":28,"tag":121,"props":3148,"children":3149},{"style":134},[3150],{"type":41,"value":3151}," (type) {\n",{"type":28,"tag":121,"props":3153,"children":3154},{"class":123,"line":683},[3155],{"type":28,"tag":121,"props":3156,"children":3157},{"style":529},[3158],{"type":41,"value":3159},"    // ...\n",{"type":28,"tag":121,"props":3161,"children":3162},{"class":123,"line":692},[3163,3168,3173],{"type":28,"tag":121,"props":3164,"children":3165},{"style":144},[3166],{"type":41,"value":3167},"    case",{"type":28,"tag":121,"props":3169,"children":3170},{"style":161},[3171],{"type":41,"value":3172}," 'Playwright'",{"type":28,"tag":121,"props":3174,"children":3175},{"style":134},[3176],{"type":41,"value":3177},":\n",{"type":28,"tag":121,"props":3179,"children":3180},{"class":123,"line":711},[3181,3186,3190,3194,3199],{"type":28,"tag":121,"props":3182,"children":3183},{"style":134},[3184],{"type":41,"value":3185},"      result ",{"type":28,"tag":121,"props":3187,"children":3188},{"style":144},[3189],{"type":41,"value":775},{"type":28,"tag":121,"props":3191,"children":3192},{"style":144},[3193],{"type":41,"value":445},{"type":28,"tag":121,"props":3195,"children":3196},{"style":150},[3197],{"type":41,"value":3198}," Playwright",{"type":28,"tag":121,"props":3200,"children":3201},{"style":134},[3202],{"type":41,"value":3203},"(parent, type, guid, initializer);\n",{"type":28,"tag":121,"props":3205,"children":3206},{"class":123,"line":764},[3207,3212],{"type":28,"tag":121,"props":3208,"children":3209},{"style":144},[3210],{"type":41,"value":3211},"      break",{"type":28,"tag":121,"props":3213,"children":3214},{"style":134},[3215],{"type":41,"value":761},{"type":28,"tag":121,"props":3217,"children":3218},{"class":123,"line":800},[3219],{"type":28,"tag":121,"props":3220,"children":3221},{"style":529},[3222],{"type":41,"value":3159},{"type":28,"tag":121,"props":3224,"children":3225},{"class":123,"line":834},[3226],{"type":28,"tag":121,"props":3227,"children":3228},{"style":134},[3229],{"type":41,"value":2547},{"type":28,"tag":121,"props":3231,"children":3232},{"class":123,"line":868},[3233,3237],{"type":28,"tag":121,"props":3234,"children":3235},{"style":144},[3236],{"type":41,"value":1169},{"type":28,"tag":121,"props":3238,"children":3239},{"style":134},[3240],{"type":41,"value":3241}," result;\n",{"type":28,"tag":121,"props":3243,"children":3244},{"class":123,"line":894},[3245],{"type":28,"tag":121,"props":3246,"children":3247},{"style":134},[3248],{"type":41,"value":1183},{"type":28,"tag":29,"props":3250,"children":3251},{},[3252,3254,3259,3261,3266,3268,3273,3275,3279,3281,3285,3287,3291,3293,3297,3299,3304,3306,3310,3312,3316,3318,3323],{"type":41,"value":3253},"The parameter ",{"type":28,"tag":44,"props":3255,"children":3256},{"className":7},[3257],{"type":41,"value":3258},"tChannelImpl: _tChannelImplFromWire",{"type":41,"value":3260}," in the ",{"type":28,"tag":44,"props":3262,"children":3263},{"className":7},[3264],{"type":41,"value":3265},"validator",{"type":41,"value":3267}," function is responsible for taking the initializer object above, which contains a guid for each browser, and convert it to the corresponding object stored in the ",{"type":28,"tag":44,"props":3269,"children":3270},{"className":7},[3271],{"type":41,"value":3272},"_objects",{"type":41,"value":3274}," variable in the ",{"type":28,"tag":44,"props":3276,"children":3277},{"className":7},[3278],{"type":41,"value":1220},{"type":41,"value":3280}," class. If you look at the type definition in ",{"type":28,"tag":44,"props":3282,"children":3283},{"className":7},[3284],{"type":41,"value":1220},{"type":41,"value":3286}," the ",{"type":28,"tag":44,"props":3288,"children":3289},{"className":7},[3290],{"type":41,"value":3272},{"type":41,"value":3292}," variable is a map returning one of the ",{"type":28,"tag":44,"props":3294,"children":3295},{"className":7},[3296],{"type":41,"value":2570},{"type":41,"value":3298}," subclasses. So in the result above for the ",{"type":28,"tag":44,"props":3300,"children":3301},{"className":7},[3302],{"type":41,"value":3303},"case: 'Playwright'",{"type":41,"value":3305},", it returns a ",{"type":28,"tag":44,"props":3307,"children":3308},{"className":7},[3309],{"type":41,"value":12},{"type":41,"value":3311}," instance, which is a subclass of ",{"type":28,"tag":44,"props":3313,"children":3314},{"className":7},[3315],{"type":41,"value":2570},{"type":41,"value":3317},", defined in ",{"type":28,"tag":44,"props":3319,"children":3320},{"className":7},[3321],{"type":41,"value":3322},"client/playwright.ts",{"type":41,"value":89},{"type":28,"tag":110,"props":3325,"children":3327},{"className":283,"code":3326,"language":285,"meta":7,"style":7},"class Connection extends EventEmitter {\n  _objects: Map\u003CString, ChannelOwner>\n}\n",[3328],{"type":28,"tag":44,"props":3329,"children":3330},{"__ignoreMap":7},[3331,3357,3396],{"type":28,"tag":121,"props":3332,"children":3333},{"class":123,"line":124},[3334,3339,3343,3348,3353],{"type":28,"tag":121,"props":3335,"children":3336},{"style":144},[3337],{"type":41,"value":3338},"class",{"type":28,"tag":121,"props":3340,"children":3341},{"style":150},[3342],{"type":41,"value":450},{"type":28,"tag":121,"props":3344,"children":3345},{"style":144},[3346],{"type":41,"value":3347}," extends",{"type":28,"tag":121,"props":3349,"children":3350},{"style":150},[3351],{"type":41,"value":3352}," EventEmitter",{"type":28,"tag":121,"props":3354,"children":3355},{"style":134},[3356],{"type":41,"value":327},{"type":28,"tag":121,"props":3358,"children":3359},{"class":123,"line":330},[3360,3365,3369,3374,3378,3383,3387,3391],{"type":28,"tag":121,"props":3361,"children":3362},{"style":574},[3363],{"type":41,"value":3364},"  _objects",{"type":28,"tag":121,"props":3366,"children":3367},{"style":144},[3368],{"type":41,"value":317},{"type":28,"tag":121,"props":3370,"children":3371},{"style":150},[3372],{"type":41,"value":3373}," Map",{"type":28,"tag":121,"props":3375,"children":3376},{"style":134},[3377],{"type":41,"value":2958},{"type":28,"tag":121,"props":3379,"children":3380},{"style":150},[3381],{"type":41,"value":3382},"String",{"type":28,"tag":121,"props":3384,"children":3385},{"style":134},[3386],{"type":41,"value":464},{"type":28,"tag":121,"props":3388,"children":3389},{"style":150},[3390],{"type":41,"value":2570},{"type":28,"tag":121,"props":3392,"children":3393},{"style":134},[3394],{"type":41,"value":3395},">\n",{"type":28,"tag":121,"props":3397,"children":3398},{"class":123,"line":358},[3399],{"type":28,"tag":121,"props":3400,"children":3401},{"style":134},[3402],{"type":41,"value":1183},{"type":28,"tag":29,"props":3404,"children":3405},{},[3406,3407,3412,3414,3419,3421,3425,3427,3431,3433,3437,3439,3444,3446,3451,3452,3456,3458,3463,3465,3469],{"type":41,"value":1922},{"type":28,"tag":44,"props":3408,"children":3409},{"className":7},[3410],{"type":41,"value":3411},"_tChannelImplFromWire",{"type":41,"value":3413}," function is responsible for turning the ",{"type":28,"tag":44,"props":3415,"children":3416},{"className":7},[3417],{"type":41,"value":3418},"initializer",{"type":41,"value":3420}," parameter in the constructor for ",{"type":28,"tag":44,"props":3422,"children":3423},{"className":7},[3424],{"type":41,"value":12},{"type":41,"value":3426}," into the ",{"type":28,"tag":44,"props":3428,"children":3429},{"className":7},[3430],{"type":41,"value":2570},{"type":41,"value":3432}," subclasses for each of the drivers (chrome, firefox, etc.). Note before the ",{"type":28,"tag":44,"props":3434,"children":3435},{"className":7},[3436],{"type":41,"value":12},{"type":41,"value":3438}," message was sent over to the client, there were messages for each of the ",{"type":28,"tag":44,"props":3440,"children":3441},{"className":7},[3442],{"type":41,"value":3443},"BrowserType",{"type":41,"value":3445}," objects with name ",{"type":28,"tag":44,"props":3447,"children":3448},{"className":7},[3449],{"type":41,"value":3450},"'chrome'",{"type":41,"value":464},{"type":28,"tag":44,"props":3453,"children":3454},{"className":7},[3455],{"type":41,"value":827},{"type":41,"value":3457},", etc. If you inspect this object manually, you will find many ",{"type":28,"tag":44,"props":3459,"children":3460},{"className":7},[3461],{"type":41,"value":3462},"EventEmitter",{"type":41,"value":3464}," objects in the ",{"type":28,"tag":44,"props":3466,"children":3467},{"className":7},[3468],{"type":41,"value":3418},{"type":41,"value":3470}," object.",{"type":28,"tag":29,"props":3472,"children":3473},{},[3474,3476,3481,3483,3488,3490,3495,3497,3501,3503,3508,3510,3514,3516,3520,3522,3526],{"type":41,"value":3475},"The other main point to note is the ",{"type":28,"tag":44,"props":3477,"children":3478},{"className":7},[3479],{"type":41,"value":3480},"Root",{"type":41,"value":3482}," design pattern is used on the client side as well. The ",{"type":28,"tag":44,"props":3484,"children":3485},{"className":7},[3486],{"type":41,"value":3487},"parent",{"type":41,"value":3489}," corresponding to the ",{"type":28,"tag":44,"props":3491,"children":3492},{"className":7},[3493],{"type":41,"value":3494},"guid=''",{"type":41,"value":3496}," is an instance of the ",{"type":28,"tag":44,"props":3498,"children":3499},{"className":7},[3500],{"type":41,"value":3480},{"type":41,"value":3502}," class, defined in ",{"type":28,"tag":44,"props":3504,"children":3505},{"className":7},[3506],{"type":41,"value":3507},"client/connection.ts",{"type":41,"value":3509},". All this class acts as is a wrapper around the ",{"type":28,"tag":44,"props":3511,"children":3512},{"className":7},[3513],{"type":41,"value":1870},{"type":41,"value":3515},", giving every subclass of ",{"type":28,"tag":44,"props":3517,"children":3518},{"className":7},[3519],{"type":41,"value":2570},{"type":41,"value":3521}," access to the ",{"type":28,"tag":44,"props":3523,"children":3524},{"className":7},[3525],{"type":41,"value":1870},{"type":41,"value":3527}," to send messages over to the Playwright server.",{"type":28,"tag":1185,"props":3529,"children":3531},{"id":3530},"launching-the-browser-instance",[3532],{"type":41,"value":3533},"Launching the browser instance",{"type":28,"tag":29,"props":3535,"children":3536},{},[3537,3539,3544],{"type":41,"value":3538},"The final bit of code to consider is the ",{"type":28,"tag":44,"props":3540,"children":3541},{"className":7},[3542],{"type":41,"value":3543},"_serverLauncher",{"type":41,"value":3545}," variables being set in each of the drivers. This is written as",{"type":28,"tag":110,"props":3547,"children":3549},{"className":283,"code":3548,"language":285,"meta":7,"style":7},"playwrightAPI.chromium._serverLauncher = new BrowserServerLauncherImpl('chromium');\nplaywrightAPI.firefox._serverLauncher = new BrowserServerLauncherImpl('firefox');\nplaywrightAPI.webkit._serverLauncher = new BrowserServerLauncherImpl('webkit');\n",[3550],{"type":28,"tag":44,"props":3551,"children":3552},{"__ignoreMap":7},[3553,3585,3617],{"type":28,"tag":121,"props":3554,"children":3555},{"class":123,"line":124},[3556,3561,3565,3569,3573,3577,3581],{"type":28,"tag":121,"props":3557,"children":3558},{"style":134},[3559],{"type":41,"value":3560},"playwrightAPI.chromium._serverLauncher ",{"type":28,"tag":121,"props":3562,"children":3563},{"style":144},[3564],{"type":41,"value":775},{"type":28,"tag":121,"props":3566,"children":3567},{"style":144},[3568],{"type":41,"value":445},{"type":28,"tag":121,"props":3570,"children":3571},{"style":150},[3572],{"type":41,"value":784},{"type":28,"tag":121,"props":3574,"children":3575},{"style":134},[3576],{"type":41,"value":158},{"type":28,"tag":121,"props":3578,"children":3579},{"style":161},[3580],{"type":41,"value":793},{"type":28,"tag":121,"props":3582,"children":3583},{"style":134},[3584],{"type":41,"value":169},{"type":28,"tag":121,"props":3586,"children":3587},{"class":123,"line":330},[3588,3593,3597,3601,3605,3609,3613],{"type":28,"tag":121,"props":3589,"children":3590},{"style":134},[3591],{"type":41,"value":3592},"playwrightAPI.firefox._serverLauncher ",{"type":28,"tag":121,"props":3594,"children":3595},{"style":144},[3596],{"type":41,"value":775},{"type":28,"tag":121,"props":3598,"children":3599},{"style":144},[3600],{"type":41,"value":445},{"type":28,"tag":121,"props":3602,"children":3603},{"style":150},[3604],{"type":41,"value":784},{"type":28,"tag":121,"props":3606,"children":3607},{"style":134},[3608],{"type":41,"value":158},{"type":28,"tag":121,"props":3610,"children":3611},{"style":161},[3612],{"type":41,"value":827},{"type":28,"tag":121,"props":3614,"children":3615},{"style":134},[3616],{"type":41,"value":169},{"type":28,"tag":121,"props":3618,"children":3619},{"class":123,"line":358},[3620,3625,3629,3633,3637,3641,3645],{"type":28,"tag":121,"props":3621,"children":3622},{"style":134},[3623],{"type":41,"value":3624},"playwrightAPI.webkit._serverLauncher ",{"type":28,"tag":121,"props":3626,"children":3627},{"style":144},[3628],{"type":41,"value":775},{"type":28,"tag":121,"props":3630,"children":3631},{"style":144},[3632],{"type":41,"value":445},{"type":28,"tag":121,"props":3634,"children":3635},{"style":150},[3636],{"type":41,"value":784},{"type":28,"tag":121,"props":3638,"children":3639},{"style":134},[3640],{"type":41,"value":158},{"type":28,"tag":121,"props":3642,"children":3643},{"style":161},[3644],{"type":41,"value":861},{"type":28,"tag":121,"props":3646,"children":3647},{"style":134},[3648],{"type":41,"value":169},{"type":28,"tag":29,"props":3650,"children":3651},{},[3652,3653,3658,3660,3664,3666,3671,3673,3678],{"type":41,"value":174},{"type":28,"tag":44,"props":3654,"children":3655},{"className":7},[3656],{"type":41,"value":3657},"BrowserServerLauncherImpl",{"type":41,"value":3659}," class is defined next to the ",{"type":28,"tag":44,"props":3661,"children":3662},{"className":7},[3663],{"type":41,"value":200},{"type":41,"value":3665}," file in ",{"type":28,"tag":44,"props":3667,"children":3668},{"className":7},[3669],{"type":41,"value":3670},"browserServerLauncherImpl.ts",{"type":41,"value":3672},". The main functionality in this class lies in the ",{"type":28,"tag":44,"props":3674,"children":3675},{"className":7},[3676],{"type":41,"value":3677},"launchServer",{"type":41,"value":3679}," function, and is only called when you use the",{"type":28,"tag":110,"props":3681,"children":3683},{"className":283,"code":3682,"language":285,"meta":7,"style":7},"playwrightAPI.chromium.launchServer(serverOptions)\n",[3684],{"type":28,"tag":44,"props":3685,"children":3686},{"__ignoreMap":7},[3687],{"type":28,"tag":121,"props":3688,"children":3689},{"class":123,"line":124},[3690,3695,3699],{"type":28,"tag":121,"props":3691,"children":3692},{"style":134},[3693],{"type":41,"value":3694},"playwrightAPI.chromium.",{"type":28,"tag":121,"props":3696,"children":3697},{"style":150},[3698],{"type":41,"value":3677},{"type":28,"tag":121,"props":3700,"children":3701},{"style":134},[3702],{"type":41,"value":3703},"(serverOptions)\n",{"type":28,"tag":29,"props":3705,"children":3706},{},[3707,3709,3714],{"type":41,"value":3708},"function. This is for launching a server which exposes a websocket for other programs to interact with the playwright API. This is not used if you are just writing a node script which accesses the ",{"type":28,"tag":44,"props":3710,"children":3711},{"className":7},[3712],{"type":41,"value":3713},"'playwright-core'",{"type":41,"value":3715}," library, something like",{"type":28,"tag":110,"props":3717,"children":3719},{"className":283,"code":3718,"language":285,"meta":7,"style":7},"import playwright from 'playwright-core';\n\n(async function () {\n  const browser = await playwright.chromium.launch({headless: false})\n  const page = await browser.newPage()\n  await page.goto(\"https://playwright.dev\")\n  // ... automate page interactions here\n})()\n",[3720],{"type":28,"tag":44,"props":3721,"children":3722},{"__ignoreMap":7},[3723,3748,3755,3776,3822,3857,3888,3896],{"type":28,"tag":121,"props":3724,"children":3725},{"class":123,"line":124},[3726,3730,3735,3739,3744],{"type":28,"tag":121,"props":3727,"children":3728},{"style":144},[3729],{"type":41,"value":1411},{"type":28,"tag":121,"props":3731,"children":3732},{"style":134},[3733],{"type":41,"value":3734}," playwright ",{"type":28,"tag":121,"props":3736,"children":3737},{"style":144},[3738],{"type":41,"value":1421},{"type":28,"tag":121,"props":3740,"children":3741},{"style":161},[3742],{"type":41,"value":3743}," 'playwright-core'",{"type":28,"tag":121,"props":3745,"children":3746},{"style":134},[3747],{"type":41,"value":761},{"type":28,"tag":121,"props":3749,"children":3750},{"class":123,"line":330},[3751],{"type":28,"tag":121,"props":3752,"children":3753},{"emptyLinePlaceholder":420},[3754],{"type":41,"value":423},{"type":28,"tag":121,"props":3756,"children":3757},{"class":123,"line":358},[3758,3762,3767,3771],{"type":28,"tag":121,"props":3759,"children":3760},{"style":134},[3761],{"type":41,"value":158},{"type":28,"tag":121,"props":3763,"children":3764},{"style":144},[3765],{"type":41,"value":3766},"async",{"type":28,"tag":121,"props":3768,"children":3769},{"style":144},[3770],{"type":41,"value":302},{"type":28,"tag":121,"props":3772,"children":3773},{"style":134},[3774],{"type":41,"value":3775}," () {\n",{"type":28,"tag":121,"props":3777,"children":3778},{"class":123,"line":407},[3779,3783,3788,3792,3797,3802,3807,3812,3817],{"type":28,"tag":121,"props":3780,"children":3781},{"style":144},[3782],{"type":41,"value":336},{"type":28,"tag":121,"props":3784,"children":3785},{"style":128},[3786],{"type":41,"value":3787}," browser",{"type":28,"tag":121,"props":3789,"children":3790},{"style":144},[3791],{"type":41,"value":147},{"type":28,"tag":121,"props":3793,"children":3794},{"style":144},[3795],{"type":41,"value":3796}," await",{"type":28,"tag":121,"props":3798,"children":3799},{"style":134},[3800],{"type":41,"value":3801}," playwright.chromium.",{"type":28,"tag":121,"props":3803,"children":3804},{"style":150},[3805],{"type":41,"value":3806},"launch",{"type":28,"tag":121,"props":3808,"children":3809},{"style":134},[3810],{"type":41,"value":3811},"({headless: ",{"type":28,"tag":121,"props":3813,"children":3814},{"style":128},[3815],{"type":41,"value":3816},"false",{"type":28,"tag":121,"props":3818,"children":3819},{"style":134},[3820],{"type":41,"value":3821},"})\n",{"type":28,"tag":121,"props":3823,"children":3824},{"class":123,"line":416},[3825,3829,3834,3838,3842,3847,3852],{"type":28,"tag":121,"props":3826,"children":3827},{"style":144},[3828],{"type":41,"value":336},{"type":28,"tag":121,"props":3830,"children":3831},{"style":128},[3832],{"type":41,"value":3833}," page",{"type":28,"tag":121,"props":3835,"children":3836},{"style":144},[3837],{"type":41,"value":147},{"type":28,"tag":121,"props":3839,"children":3840},{"style":144},[3841],{"type":41,"value":3796},{"type":28,"tag":121,"props":3843,"children":3844},{"style":134},[3845],{"type":41,"value":3846}," browser.",{"type":28,"tag":121,"props":3848,"children":3849},{"style":150},[3850],{"type":41,"value":3851},"newPage",{"type":28,"tag":121,"props":3853,"children":3854},{"style":134},[3855],{"type":41,"value":3856},"()\n",{"type":28,"tag":121,"props":3858,"children":3859},{"class":123,"line":426},[3860,3865,3870,3875,3879,3884],{"type":28,"tag":121,"props":3861,"children":3862},{"style":144},[3863],{"type":41,"value":3864},"  await",{"type":28,"tag":121,"props":3866,"children":3867},{"style":134},[3868],{"type":41,"value":3869}," page.",{"type":28,"tag":121,"props":3871,"children":3872},{"style":150},[3873],{"type":41,"value":3874},"goto",{"type":28,"tag":121,"props":3876,"children":3877},{"style":134},[3878],{"type":41,"value":158},{"type":28,"tag":121,"props":3880,"children":3881},{"style":161},[3882],{"type":41,"value":3883},"\"https://playwright.dev\"",{"type":28,"tag":121,"props":3885,"children":3886},{"style":134},[3887],{"type":41,"value":2784},{"type":28,"tag":121,"props":3889,"children":3890},{"class":123,"line":475},[3891],{"type":28,"tag":121,"props":3892,"children":3893},{"style":529},[3894],{"type":41,"value":3895},"  // ... automate page interactions here\n",{"type":28,"tag":121,"props":3897,"children":3898},{"class":123,"line":494},[3899],{"type":28,"tag":121,"props":3900,"children":3901},{"style":134},[3902],{"type":41,"value":3903},"})()\n",{"type":28,"tag":29,"props":3905,"children":3906},{},[3907,3909,3913],{"type":41,"value":3908},"so for now we skip giving an overview of the ",{"type":28,"tag":44,"props":3910,"children":3911},{"className":7},[3912],{"type":41,"value":3657},{"type":41,"value":3914}," code and defer it to a later post.",{"type":28,"tag":3916,"props":3917,"children":3918},"style",{},[3919],{"type":41,"value":3920},"html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}",{"title":7,"searchDepth":330,"depth":330,"links":3922},[3923],{"id":267,"depth":330,"text":200,"children":3924},[3925,3926],{"id":1187,"depth":358,"text":1190},{"id":3530,"depth":358,"text":3533},"markdown","content:playwright:how-playwright-initializes.md","content","playwright/how-playwright-initializes.md","md",1710365535682]